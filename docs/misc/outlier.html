<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.35">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2024-11-20">
<title>Outliers and discrepancies – Representation Study</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../misc/indiv.html" rel="next">
<link href="../nb/overview.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-383d4a065b21370043bc4709e21900a7.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-22ab91ee63bfb1fa4abd865bfe32346b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link href="../site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="../site_libs/tabwid-1.1.3/tabwid.js"></script><link rel="stylesheet" href="../assets/style_qt.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Representation Study</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tegorman13/Representation_Study"> <i class="bi bi-github" role="img" aria-label="github">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../background/bg.html"> 
<span class="menu-text">Study Info</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../nb/analysis.html"> 
<span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../paper.html" aria-current="page"> 
<span class="menu-text">Paper</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../nb/study1.html"><strong>Analysis</strong></a></li><li class="breadcrumb-item"><a href="../misc/outlier.html">Outliers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Paper</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../paper.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-text-fill" role="img">
</i> 
 <span class="menu-text">Manuscript</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mpa/mpa_abstract.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-text-fill" role="img">
</i> 
 <span class="menu-text">MPA</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Analysis</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nb/study1.html" class="sidebar-item-text sidebar-link"><i class="bi bi-laptop" role="img">
</i> 
 <span class="menu-text">Study 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nb/study2.html" class="sidebar-item-text sidebar-link"><i class="bi bi-laptop" role="img">
</i> 
 <span class="menu-text">Study 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nb/results.html" class="sidebar-item-text sidebar-link"><i class="bi bi-bar-chart-fill" role="img">
</i> 
 <span class="menu-text">Results</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nb/overview.html" class="sidebar-item-text sidebar-link"><i class="bi bi-signpost-split-fill" role="img">
</i> 
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../misc/outlier.html" class="sidebar-item-text sidebar-link active"><i class="bi bi-graph-down" role="img">
</i> 
 <span class="menu-text">Outliers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../misc/indiv.html" class="sidebar-item-text sidebar-link"><i class="bi bi-bar-chart-steps" role="img">
</i> 
 <span class="menu-text">Response Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../misc/discrep.html" class="sidebar-item-text sidebar-link"><i class="bi bi-columns-gap" role="img">
</i> 
 <span class="menu-text">Discrep_Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../misc/ordinal.html" class="sidebar-item-text sidebar-link"><i class="bi bi-grid-3x2-gap-fill" role="img">
</i> 
 <span class="menu-text">Ordinal Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mpa/mpa_analysis.html" class="sidebar-item-text sidebar-link"><i class="bi bi-clipboard" role="img">
</i> 
 <span class="menu-text">MPA</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Background</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/study_stim.html" class="sidebar-item-text sidebar-link"><i class="bi bi-pencil" role="img">
</i> 
 <span class="menu-text">Design and Stimulii</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/study_info.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark" role="img">
</i> 
 <span class="menu-text">study 2 full info</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/initial_slides.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-slides-fill" role="img">
</i> 
 <span class="menu-text">MPA_Slides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/study1_info.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-post" role="img">
</i> 
 <span class="menu-text">study 1 codebook</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background/study2_info.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-post" role="img">
</i> 
 <span class="menu-text">study 2 codebook</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#task-data-checks" id="toc-task-data-checks" class="nav-link active" data-scroll-target="#task-data-checks">Task data checks</a></li>
  <li><a href="#wells-family-15-r-and-smith-family-10-e-percentage---5.257-for-texas-water-heating" id="toc-wells-family-15-r-and-smith-family-10-e-percentage---5.257-for-texas-water-heating" class="nav-link" data-scroll-target="#wells-family-15-r-and-smith-family-10-e-percentage---5.257-for-texas-water-heating">Wells Family 15 R and Smith Family 10 E Percentage - 5.257 for Texas water heating</a></li>
  <li>
<a href="#inspects-counts-for-each-distinct-value-of-prior-year-family-use-and-state-average" id="toc-inspects-counts-for-each-distinct-value-of-prior-year-family-use-and-state-average" class="nav-link" data-scroll-target="#inspects-counts-for-each-distinct-value-of-prior-year-family-use-and-state-average">Inspects counts for each distinct value of prior year family use, and state average</a>
  <ul class="collapse">
<li><a href="#alternate-discrep-frequency-tables" id="toc-alternate-discrep-frequency-tables" class="nav-link" data-scroll-target="#alternate-discrep-frequency-tables">Alternate discrep frequency tables</a></li>
  </ul>
</li>
  <li><a href="#just-refclass-percentage-and-state-2-texas-have-the-issues-with-family-water-heating-5.26" id="toc-just-refclass-percentage-and-state-2-texas-have-the-issues-with-family-water-heating-5.26" class="nav-link" data-scroll-target="#just-refclass-percentage-and-state-2-texas-have-the-issues-with-family-water-heating-5.26">Just refClass Percentage and state 2 Texas have the issues with family water heating = 5.26</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/tegorman13/Representation_Study/blob/main/misc/outlier.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="outliers_gfm.md"><i class="bi bi-file-code"></i>Github (GFM)</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../nb/study1.html"><strong>Analysis</strong></a></li><li class="breadcrumb-item"><a href="../misc/outlier.html">Outliers</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Outliers and discrepancies</h1>
</div>



<div class="quarto-title-meta column-body">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 20, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trinker/pacman">pacman</a></span><span class="op">)</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">dplyr</span>,<span class="va">purrr</span>,<span class="va">tidyr</span>,<span class="va">here</span>, <span class="va">haven</span>,<span class="va">tibble</span>,<span class="va">ggplot2</span>,<span class="va">gt</span>,<span class="va">ggh4x</span>,<span class="va">lme4</span>,<span class="va">flextable</span>,<span class="va">ggdist</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/s1_processed.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/s2_processed.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1_agg</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span><span class="st">"Total kWh"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span>,<span class="va">refClass</span>,<span class="va">state</span>,<span class="va">block</span>,<span class="va">plan</span>,<span class="va">calc</span>,<span class="va">edu</span>,<span class="va">pct_goal</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_kWh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,orig_kWh<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>, </span>
<span>            pct_change <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">orig_kWh</span><span class="op">-</span><span class="va">total_kWh</span><span class="op">)</span><span class="op">/</span><span class="va">orig_kWh</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>            n_change <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">!=</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            state_p_dif<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">state_p_dif</span><span class="op">)</span>,</span>
<span>            state_f_dif<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">state_f_dif</span><span class="op">)</span>,</span>
<span>            n_less_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">less_avg</span><span class="op">)</span>,</span>
<span>            duration<span class="op">=</span><span class="fu">first</span><span class="op">(</span><span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>matched_goal <span class="op">=</span> <span class="op">(</span><span class="va">pct_change</span> <span class="op">==</span> <span class="va">pct_goal</span><span class="op">)</span>, </span>
<span>             error <span class="op">=</span> <span class="va">pct_change</span> <span class="op">-</span> <span class="va">pct_goal</span>,</span>
<span>            abs_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">error</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># s1_agg |&gt; filter(matched_goal==FALSE, abs_error&lt;.02) |&gt; pull(abs_error)</span></span>
<span></span>
<span></span>
<span><span class="va">s1_agg4</span> <span class="op">&lt;-</span> <span class="va">s1_agg</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">matched_goal</span><span class="op">)</span>,n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, pct<span class="op">=</span><span class="va">mg</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">s1_agg2</span> <span class="op">&lt;-</span> <span class="va">s1_agg</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span>,<span class="va">refClass</span>,<span class="va">state</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">matched_goal</span><span class="op">)</span>,n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, pct<span class="op">=</span><span class="va">mg</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">outliers</span> <span class="op">&lt;-</span> <span class="va">s1_agg</span> <span class="op">|&gt;</span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>change_mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pct_change</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,change_sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">pct_change</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                     z_score<span class="op">=</span><span class="op">(</span><span class="va">pct_change</span><span class="op">-</span><span class="va">change_mean</span><span class="op">)</span><span class="op">/</span><span class="va">change_sd</span>,</span>
<span>                                     is_outlier<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">z_score</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">3.0</span><span class="op">)</span></span>
<span><span class="va">outlier_id</span> <span class="op">&lt;-</span> <span class="va">outliers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">is_outlier</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pull</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># quick summary of s1$Duration_in_seconds variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">s1</span><span class="op">$</span><span class="va">Duration__in_seconds_</span><span class="op">)</span></span>
<span>  <span class="co">#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span>  <span class="co">#   176     846    1184    1659    1688   47914 </span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Duration__in_seconds_</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Duration__in_seconds_</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">refClass</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">|&gt;</span>  <span class="fu">mutate</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">id</span>,x<span class="op">=</span><span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.6</span>,position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>w<span class="op">=</span><span class="fl">0</span>, h<span class="op">=</span><span class="fl">0.17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggh4x</span><span class="fu">::</span><span class="fu"><a href="https://teunbrand.github.io/ggh4x/reference/facet_nested_wrap.html">facet_nested_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">refClass</span>,axes<span class="op">=</span><span class="st">"all"</span>,scales<span class="op">=</span><span class="st">"free"</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="va">s1_agg</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">duration</span><span class="op">&lt;</span><span class="fl">10000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">duration</span>,y<span class="op">=</span><span class="va">abs_error</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">refClass</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s1_agg</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">refClass</span><span class="op">)</span> <span class="op">+</span> <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span><span class="op">==</span><span class="st">"s2_10"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">s2_long</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>shape<span class="op">=</span><span class="va">plan</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">state_avg</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">family</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">id</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">rounded</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>,<span class="va">family</span>,<span class="va">rounded</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># counts for each distinct value</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span>,<span class="va">plan</span><span class="op">==</span><span class="st">"plan1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>,<span class="va">family</span>,<span class="va">rounded</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size<span class="op">=</span><span class="va">n</span>,alpha<span class="op">=</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="va">n</span><span class="op">)</span>,vjust<span class="op">=</span><span class="fl">1</span>,size<span class="op">=</span><span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">rounded</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">plan</span><span class="op">==</span><span class="st">"plan1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>,<span class="va">family</span>,<span class="va">rounded</span>,<span class="va">state</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size<span class="op">=</span><span class="va">n</span>,alpha<span class="op">=</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="va">n</span><span class="op">)</span>,vjust<span class="op">=</span><span class="fl">1</span>,size<span class="op">=</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">state</span><span class="op">~</span><span class="va">rounded</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># bar plot version of the above</span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>,<span class="va">family</span>,<span class="va">rounded</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">family</span>,fill<span class="op">=</span><span class="va">rounded</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">rounded</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"TOTAL"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">rounded</span>, <span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    distinct_families <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    color_flag <span class="op">=</span> <span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Continue grouping for plotting</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">family</span>, <span class="va">rounded</span>, <span class="va">state</span>,<span class="va">color_flag</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">appliance</span>, y <span class="op">=</span> <span class="va">family</span>,color <span class="op">=</span> <span class="va">color_flag</span>,fill<span class="op">=</span><span class="va">color_flag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="va">color_flag</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">rounded</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Family Value"</span>,</span>
<span>    size <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"TOTAL"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">rounded</span>, <span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    distinct_families <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>    color_flag <span class="op">=</span> <span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Continue grouping for plotting</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">rounded</span>, <span class="va">state</span>,<span class="va">color_flag</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">appliance</span>, y <span class="op">=</span> <span class="va">state_avg</span>,color <span class="op">=</span> <span class="va">color_flag</span>,fill<span class="op">=</span><span class="va">color_flag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="va">color_flag</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">rounded</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Family Value"</span>,</span>
<span>    size <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    distinct_families <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    color_flag <span class="op">=</span> <span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Continue grouping for plotting</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">family</span>, <span class="va">state</span>,<span class="va">color_flag</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">color_flag</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">appliance</span>, y <span class="op">=</span> <span class="va">family</span>,color <span class="op">=</span> <span class="va">color_flag</span>,fill<span class="op">=</span><span class="va">color_flag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="co">#geom_point(aes(alpha = .1, color = color_flag), position = position_jitter(width = 0.15)) +</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.75</span>,height<span class="op">=</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">refClass</span><span class="op">~</span><span class="va">state</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Family Value"</span>,</span>
<span>    size <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="task-data-checks" class="level2"><h2 class="anchored" data-anchor-id="task-data-checks">Task data checks</h2>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for every combination of state, appliance, and refClass, calculate the number of distinct values of family, and of state_avg</span></span>
<span><span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_distinct_family<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            n_distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span>            distinct_family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,</span>
<span>            distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span><span class="op">&gt;</span><span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 7
# Groups:   state, appliance [10]
   state appliance       refClass   n_distinct_family n_distinct_state_avg
   &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;                  &lt;int&gt;                &lt;int&gt;
 1 CAL   Water Heating   USD                        2                    2
 2 COL   Heating         kWh                        3                    2
 3 COL   Refrigerator    kWh                        2                    1
 4 COL   Total kWh       kWh                        2                    1
 5 COL   Water Heating   USD                        1                    2
 6 MASS  Water Heating   USD                        2                    1
 7 TEX   Heating         USD                        2                    1
 8 TEX   Other Appliance USD                        2                    1
 9 TEX   Total kWh       kWh                        1                    2
10 TEX   Water Heating   Percentage                 2                    1
11 TEX   Water Heating   USD                        3                    2
# ℹ 2 more variables: distinct_family &lt;chr&gt;, distinct_state_avg &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span>,<span class="va">rounded</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_distinct_family<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            n_distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span>            distinct_family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,</span>
<span>            distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span><span class="op">&gt;</span><span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 8
# Groups:   state, appliance, refClass [7]
  state        appliance refClass rounded n_distinct_family n_distinct_state_avg
  &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;               &lt;int&gt;                &lt;int&gt;
1 California   HEAT      kWh      Not Ro…                 2                    1
2 Colorado     WATER     Percent… Not Ro…                 1                    2
3 Massachuset… AC        Percent… Rounded                 2                    1
4 Massachuset… AC        USD      Rounded                 2                    1
5 Texas        HEAT      Percent… Not Ro…                 2                    1
6 Texas        HEAT      kWh      Not Ro…                 2                    1
7 Texas        WATER     Percent… Not Ro…                 2                    1
# ℹ 2 more variables: distinct_family &lt;chr&gt;, distinct_state_avg &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n_distinct_family<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            n_distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span>            distinct_family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,</span>
<span>            distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span>,<span class="va">family</span>,<span class="va">state_avg</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">calc</span>,<span class="op">-</span><span class="va">edu</span>,<span class="op">-</span><span class="va">modality</span>,<span class="op">-</span><span class="va">id2</span>,<span class="op">-</span><span class="va">Duration__in_seconds_</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span><span class="op">&gt;</span><span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 20
# Groups:   state, appliance, refClass, family, state_avg [1]
      id state1   state2 refClass   state appliance family state_avg plan  value
   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl+lbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1     1 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1   700
 2     1 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4500
 3     2 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  4396
 4     2 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4396
 5     3 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  4468
 6     3 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4400
 7     4 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  1000
 8     4 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  1000
 9     5 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  3756
10     5 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  2987
11     6 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  5200
12     6 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4530
13     7 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  4257
14     7 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  3396
15     8 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  5100
16     8 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4500
17     9 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  5217
18     9 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4346
19    10 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  4468
20    10 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4468
# ℹ 10 more variables: block &lt;dbl&gt;, pct_goal &lt;dbl&gt;, change &lt;dbl&gt;,
#   state_p_dif &lt;dbl&gt;, state_f_dif &lt;dbl&gt;, less_avg &lt;lgl&gt;,
#   n_distinct_family &lt;int&gt;, n_distinct_state_avg &lt;int&gt;, distinct_family &lt;chr&gt;,
#   distinct_state_avg &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s1</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n_distinct_family <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>           n_distinct_state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>           distinct_family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span>,</span>
<span>           distinct_state_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">family</span>, <span class="va">state_avg</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>           family_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">state_avg</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">family</span>, <span class="va">state_avg</span>, <span class="va">family_count</span>, <span class="va">state_avg_count</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 7
# Groups:   state, appliance, refClass, state_avg [10]
   state appliance     refClass family state_avg family_count state_avg_count
   &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt; &lt;dbl+lbl&gt;        &lt;int&gt;           &lt;int&gt;
 1 CAL   Water Heating USD        5061  4601               82              82
 2 CAL   Water Heating USD        5124  4534                2               2
 3 COL   Heating       kWh         340   587                2               2
 4 COL   Heating       kWh       18052 16411               72              74
 5 COL   Heating       kWh       11441 16411                2              74
 6 COL   Refrigerator  kWh        5600  1142                2              76
 7 COL   Refrigerator  kWh        1370  1142               74              76
 8 COL   Total kWh     kWh        1500 30535                2              76
 9 COL   Total kWh     kWh       39768 30535               74              76
10 COL   Water Heating USD       11667  4000                2               2
11 COL   Water Heating USD       11667  5832               94              94
12 MASS  Water Heating USD           1  5070                2              92
13 MASS  Water Heating USD       10543  5070               90              92
14 TEX   Heating       USD           1  5099                2             104
15 TEX   Heating       USD        6118  5099              102             104</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">problematic_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"R_1kFwgoKAmNTwCs3"</span><span class="op">)</span> <span class="co"># Add other IDs as needed</span></span>
<span></span>
<span><span class="va">raw_subset</span> <span class="op">&lt;-</span>  <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ResponseId</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">problematic_ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ResponseId</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P1"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P2"</span><span class="op">)</span>, </span>
<span>         <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P3"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P4"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">raw_subset</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 593
  ResponseId     P1TEX01 P1TEX02 P1TEX03 P1TEX04 P1TEX05 P1TEX06 P1TEX07 P1TEX08
  &lt;chr&gt;          &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 R_1kFwgoKAmNT… NA      NA      NA      NA      NA      NA           NA      NA
# ℹ 584 more variables: P1TEX09 &lt;dbl&gt;, P1TEX10 &lt;dbl&gt;, P1TEX11 &lt;dbl&gt;,
#   P1TEX12 &lt;dbl&gt;, P1TEX13 &lt;dbl&gt;, P1TEX14 &lt;dbl&gt;, P1TEX15 &lt;dbl&gt;, P1TEX16 &lt;dbl&gt;,
#   P1TEX17 &lt;dbl&gt;, P1TEX18 &lt;dbl&gt;, P1TEX19 &lt;dbl&gt;, P1TEX20 &lt;dbl&gt;, P1TEX21 &lt;dbl&gt;,
#   P1TEX22 &lt;dbl&gt;, P1TEX23 &lt;dbl&gt;, P1TEX24 &lt;dbl&gt;, P1TEX25 &lt;dbl&gt;, P1TEX26 &lt;dbl&gt;,
#   P1TEX27 &lt;dbl&gt;, P1TEX28 &lt;dbl&gt;, P1TEX29 &lt;dbl&gt;, P1TEX30 &lt;dbl&gt;,
#   P1TEX31 &lt;dbl+lbl&gt;, P1TEX32 &lt;chr&gt;, P1TEX33 &lt;dbl+lbl&gt;, P1TEX34 &lt;dbl+lbl&gt;,
#   P1TEX35 &lt;dbl+lbl&gt;, P1TEX36 &lt;dbl+lbl&gt;, P1TEX37 &lt;dbl+lbl&gt;, …</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"Texas"</span>,<span class="va">appliance</span><span class="op">==</span><span class="st">"HEAT"</span>, <span class="va">rounded</span><span class="op">==</span><span class="st">"Not Rounded"</span>,<span class="va">refClass</span><span class="op">==</span><span class="st">"kWh"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">family</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 16
# Groups:   id, block [18]
   id     block refClass appliance pct_goal rounded     state calc   edu     pct
   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;  &lt;fct&gt; &lt;dbl&gt;
 1 s2_10      1 kWh      HEAT      10%      Not Rounded Texas No Ca… Coll…  0.1 
 2 s2_10      1 kWh      HEAT      10%      Not Rounded Texas No Ca… Coll…  0.1 
 3 s2_100     2 kWh      HEAT      15%      Not Rounded Texas Calcu… High…  0.15
 4 s2_100     2 kWh      HEAT      15%      Not Rounded Texas Calcu… High…  0.15
 5 s2_101     2 kWh      HEAT      15%      Not Rounded Texas Calcu… Some…  0.15
 6 s2_101     2 kWh      HEAT      15%      Not Rounded Texas Calcu… Some…  0.15
 7 s2_137     1 kWh      HEAT      10%      Not Rounded Texas Calcu… Some…  0.1 
 8 s2_137     1 kWh      HEAT      10%      Not Rounded Texas Calcu… Some…  0.1 
 9 s2_138     1 kWh      HEAT      10%      Not Rounded Texas Calcu… Grad…  0.1 
10 s2_138     1 kWh      HEAT      10%      Not Rounded Texas Calcu… Grad…  0.1 
# ℹ 26 more rows
# ℹ 6 more variables: family &lt;dbl&gt;, state_avg &lt;dbl&gt;, plan &lt;fct&gt;, value &lt;dbl&gt;,
#   change &lt;dbl&gt;, state_dif &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span><span class="op">==</span><span class="st">"s2_10"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="co"># no effort</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 16
# Groups:   id, block [2]
   id    block refClass appliance pct_goal rounded     state   calc  edu     pct
   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt;
 1 s2_10     1 kWh      AC        10%      Not Rounded Texas   No C… Coll…  0.1 
 2 s2_10     1 kWh      AC        10%      Not Rounded Texas   No C… Coll…  0.1 
 3 s2_10     1 kWh      HEAT      10%      Not Rounded Texas   No C… Coll…  0.1 
 4 s2_10     1 kWh      HEAT      10%      Not Rounded Texas   No C… Coll…  0.1 
 5 s2_10     1 kWh      WATER     10%      Not Rounded Texas   No C… Coll…  0.1 
 6 s2_10     1 kWh      WATER     10%      Not Rounded Texas   No C… Coll…  0.1 
 7 s2_10     1 kWh      REFRIG    10%      Not Rounded Texas   No C… Coll…  0.1 
 8 s2_10     1 kWh      REFRIG    10%      Not Rounded Texas   No C… Coll…  0.1 
 9 s2_10     1 kWh      OTHER     10%      Not Rounded Texas   No C… Coll…  0.1 
10 s2_10     1 kWh      OTHER     10%      Not Rounded Texas   No C… Coll…  0.1 
11 s2_10     1 kWh      TOTAL     10%      Not Rounded Texas   No C… Coll…  0.1 
12 s2_10     1 kWh      TOTAL     10%      Not Rounded Texas   No C… Coll…  0.1 
13 s2_10     2 kWh      AC        15%      Rounded     Massac… No C… Coll…  0.15
14 s2_10     2 kWh      AC        15%      Rounded     Massac… No C… Coll…  0.15
15 s2_10     2 kWh      HEAT      15%      Rounded     Massac… No C… Coll…  0.15
16 s2_10     2 kWh      HEAT      15%      Rounded     Massac… No C… Coll…  0.15
17 s2_10     2 kWh      WATER     15%      Rounded     Massac… No C… Coll…  0.15
18 s2_10     2 kWh      WATER     15%      Rounded     Massac… No C… Coll…  0.15
19 s2_10     2 kWh      REFRIG    15%      Rounded     Massac… No C… Coll…  0.15
20 s2_10     2 kWh      REFRIG    15%      Rounded     Massac… No C… Coll…  0.15
# ℹ 6 more variables: family &lt;dbl&gt;, state_avg &lt;dbl&gt;, plan &lt;fct&gt;, value &lt;dbl&gt;,
#   change &lt;dbl&gt;, state_dif &lt;dbl&gt;</code></pre>
</div>
</div>
<p>r$&gt; s1 |&gt; filter(family==34265) |&gt; select(id,state1,state2,refClass,id2,state,appliance,family,state_avg,plan,value,block,pct_goal) # A tibble: 2 × 13 # Groups: id [1] id state1 state2 refClass id2 state appliance family state_avg plan value block pct_goal <int><chr><chr><chr><chr><chr><chr><dbl> &lt;dbl+lbl&gt; <fct><dbl><dbl><dbl> 1 16 Texas Massachusetts USD R_3gNKA8IQr0uOSh3 TEX Water Heating 34265 4396 plan1 5486 1 0.15 2 16 Texas Massachusetts USD R_3gNKA8IQr0uOSh3 TEX Water Heating 34265 4396 plan2 6414 1 0.15</dbl></dbl></dbl></fct></dbl></chr></chr></chr></chr></chr></chr></int></p>
<p>s1 |&gt; filter(state_avg==29046) # A tibble: 2 × 21 # Groups: id [1] id state1 state2 refClass calc edu modality state id2 Duration_<em>in_seconds</em> appliance family state_avg plan value block <int><chr><chr><chr><chr><fct><chr><chr><chr><dbl><chr><dbl> &lt;dbl+lbl&gt; <fct><dbl><dbl> 1 12 Colorado Texas kWh Used… Grad… A TEX R_ab… 644 Total kWh 29046 29046 plan1 29046 2 2 12 Colorado Texas kWh Used… Grad… A TEX R_ab… 644 Total kWh 29046 29046 plan2 29046 2 ℹ 5 more variables: pct_goal <dbl>, change <dbl>, state_p_dif <dbl>, state_f_dif <dbl>, less_avg <lgl></lgl></dbl></dbl></dbl></dbl></dbl></dbl></fct></dbl></chr></dbl></chr></chr></chr></fct></chr></chr></chr></chr></int></p>
<p>s2_long |&gt; group_by(state,appliance,refClass,rounded) |&gt; mutate(state_avg=as.numeric(state_avg)) |&gt; summarise(n_distinct_family=n_distinct(family), n_distinct_state_avg=n_distinct(state_avg), # paste a string of each distinct value, separated by a comma distinct_family=paste(unique(family),collapse=“,”), distinct_state_avg=paste(unique(state_avg),collapse=“,”)) |&gt; filter(n_distinct_family&gt;1 | n_distinct_state_avg&gt;1) # A tibble: 8 × 8 # Groups: state, appliance, refClass [8] state appliance refClass rounded n_distinct_family n_distinct_state_avg distinct_family distinct_state_avg <chr><chr><chr><chr><int><int><chr><chr><br>
1 California HEAT kWh Not Rounded 2 1 3000,6157 5597<br>
2 Colorado HEAT USD Rounded 1 2 18000 16411,NA<br>
3 Colorado WATER Percentage Not Rounded 1 2 11667 1142,5832<br>
4 Massachusetts AC Percentage Rounded 2 1 0,1 322<br>
5 Massachusetts AC USD Rounded 2 1 0,1 322<br>
6 Texas HEAT Percentage Not Rounded 2 1 6118,5 5099<br>
7 Texas HEAT kWh Not Rounded 2 1 8539,6118 5099<br>
8 Texas WATER Percentage Not Rounded 2 1 5.257,5257 4396</chr></chr></int></int></chr></chr></chr></chr></p>
<p>r$&gt; s2_long |&gt; filter(family==3000,state==“California”,appliance==“HEAT”) # A tibble: 2 × 16 # Groups: id, block [1] id block refClass appliance pct_goal rounded state calc edu pct family state_avg plan value change state_dif <chr><dbl><chr><chr><chr><chr><chr><chr><fct><dbl><dbl><dbl><fct><dbl><dbl><dbl> 1 s2_11 1 kWh HEAT 10% Not Rounded California No Calculator Some college 0.1 3000 5597 plan1 4000 1000 -1597 2 s2_11 1 kWh HEAT 10% Not Rounded California No Calculator Some college 0.1 3000 5597 plan2 5000 2000 -597</dbl></dbl></dbl></fct></dbl></dbl></dbl></fct></chr></chr></chr></chr></chr></chr></dbl></chr></p>
<p>s2_long |&gt; filter(family==1) id block refClass appliance pct_goal rounded state calc edu pct family state_avg plan value change state_dif <chr><dbl><chr><chr><chr><chr><chr><chr><fct><dbl><dbl><dbl><fct><dbl><dbl><dbl> 1 s2_8 1 Percentage AC 15% Rounded Massachusetts Calculator College degree 0.15 1 322 plan1 1 0 -321 2 s2_8 1 Percentage AC 15% Rounded Massachusetts Calculator College degree 0.15 1 322 plan2 1 0 -321 3 s2_9 2 USD AC 10% Rounded Massachusetts No Calculator College degree 0.1 1 322 plan1 1 0 -321 4 s2_9 2 USD AC 10% Rounded Massachusetts No Calculator College degree 0.1 1 322 plan2 1 0 -321</dbl></dbl></dbl></fct></dbl></dbl></dbl></fct></chr></chr></chr></chr></chr></chr></dbl></chr></p>
</section><section id="wells-family-15-r-and-smith-family-10-e-percentage---5.257-for-texas-water-heating" class="level2"><h2 class="anchored" data-anchor-id="wells-family-15-r-and-smith-family-10-e-percentage---5.257-for-texas-water-heating">Wells Family 15 R and Smith Family 10 E Percentage - 5.257 for Texas water heating</h2>
<p>s2_long |&gt; filter(family==5.257) # A tibble: 8 × 16 # Groups: id, block [4] id block refClass appliance pct_goal rounded state calc edu pct family state_avg plan value change state_dif <chr><dbl><chr><chr><chr><chr><chr><chr><fct><dbl><dbl><dbl><fct><dbl><dbl><dbl> 1 s2_1 2 Percentage WATER 10% Not Rounded Texas Calculator Some college 0.1 5.26 4396 plan1 5000 4995. 604 2 s2_1 2 Percentage WATER 10% Not Rounded Texas Calculator Some college 0.1 5.26 4396 plan2 5000 4995. 604 3 s2_2 2 Percentage WATER 10% Not Rounded Texas No Calculator Graduate degree 0.1 5.26 4396 plan1 4396 4391. 0 4 s2_2 2 Percentage WATER 10% Not Rounded Texas No Calculator Graduate degree 0.1 5.26 4396 plan2 5257 5252. 861 5 s2_3 2 Percentage WATER 10% Not Rounded Texas Calculator Graduate degree 0.1 5.26 4396 plan1 3527 3522. -869 6 s2_3 2 Percentage WATER 10% Not Rounded Texas Calculator Graduate degree 0.1 5.26 4396 plan2 3027 3022. -1369 7 s2_4 2 Percentage WATER 10% Not Rounded Texas Calculator Graduate degree 0.1 5.26 4396 plan1 4800 4795. 404 8 s2_4 2 Percentage WATER 10% Not Rounded Texas Calculator Graduate degree 0.1 5.26 4396 plan2 5000 4995. 604</dbl></dbl></dbl></fct></dbl></dbl></dbl></fct></chr></chr></chr></chr></chr></chr></dbl></chr></p>
</section><section id="inspects-counts-for-each-distinct-value-of-prior-year-family-use-and-state-average" class="level2"><h2 class="anchored" data-anchor-id="inspects-counts-for-each-distinct-value-of-prior-year-family-use-and-state-average">Inspects counts for each distinct value of prior year family use, and state average</h2>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/">flextable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">correct_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">state</span>, <span class="op">~</span><span class="va">appliance</span>, <span class="op">~</span><span class="va">family</span>, <span class="op">~</span><span class="va">state_avg</span>,</span>
<span>  <span class="co"># Texas values</span></span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Cooling"</span>, <span class="fl">6573</span>, <span class="fl">4249</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Heating"</span>, <span class="fl">6118</span>, <span class="fl">5099</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span>, <span class="fl">5257</span>, <span class="fl">4396</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">2639</span>, <span class="fl">1318</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">8459</span>, <span class="fl">7883</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Total kWh"</span>, <span class="fl">29046</span>, <span class="fl">22945</span>,</span>
<span>  </span>
<span>  <span class="co"># California values</span></span>
<span>  <span class="st">"California"</span>, <span class="st">"Cooling"</span>, <span class="fl">2581</span>, <span class="fl">1289</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Heating"</span>, <span class="fl">6157</span>, <span class="fl">5597</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Water Heating"</span>, <span class="fl">5061</span>, <span class="fl">4601</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1266</span>, <span class="fl">1055</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7608</span>, <span class="fl">6916</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Total kWh"</span>, <span class="fl">22673</span>, <span class="fl">19458</span>,</span>
<span>  </span>
<span>  <span class="co"># Colorado values</span></span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Cooling"</span>, <span class="fl">697</span>, <span class="fl">498</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Heating"</span>, <span class="fl">18052</span>, <span class="fl">16411</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Water Heating"</span>, <span class="fl">11667</span>, <span class="fl">5832</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1370</span>, <span class="fl">1142</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7882</span>, <span class="fl">6652</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Total kWh"</span>, <span class="fl">39768</span>, <span class="fl">30535</span>,</span>
<span>  </span>
<span>  <span class="co"># Massachusetts values</span></span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Cooling"</span>, <span class="fl">419</span>, <span class="fl">322</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Heating"</span>, <span class="fl">26751</span>, <span class="fl">19108</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Water Heating"</span>, <span class="fl">10543</span>, <span class="fl">5070</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1230</span>, <span class="fl">1025</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7350</span>, <span class="fl">6682</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Total kWh"</span>, <span class="fl">46293</span>, <span class="fl">32207</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># First, create a lookup table of correct values</span></span>
<span><span class="va">correct_lookup</span> <span class="op">&lt;-</span> <span class="va">correct_values</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">family</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">state</span> <span class="op">==</span> <span class="st">"Texas"</span> <span class="op">~</span> <span class="st">"TEX"</span>,</span>
<span>    <span class="va">state</span> <span class="op">==</span> <span class="st">"California"</span> <span class="op">~</span> <span class="st">"CAL"</span>,</span>
<span>    <span class="va">state</span> <span class="op">==</span> <span class="st">"Colorado"</span> <span class="op">~</span> <span class="st">"COL"</span>,</span>
<span>    <span class="va">state</span> <span class="op">==</span> <span class="st">"Massachusetts"</span> <span class="op">~</span> <span class="st">"MASS"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">state</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modify the main table</span></span>
<span><span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    distinct_families <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    color_flag <span class="op">=</span> <span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">color_flag</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">family</span>, <span class="va">state</span>, <span class="va">color_flag</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">color_flag</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Join with correct values to create is_correct flag</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">correct_lookup</span>, </span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"appliance"</span><span class="op">)</span>,</span>
<span>            suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_correct"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>is_correct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span> <span class="op">-</span> <span class="va">family_correct</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">family_correct</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Reorganize and format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="va">family</span>, <span class="va">n</span>, <span class="va">is_correct</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Swapped order here</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">family</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/add_header_lines.html">add_header_lines</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"Family prior year use per utility counts (green=most frequent)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bold.html">bold</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">"header"</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Merge cells</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/merge_v.html">merge_v</a></span><span class="op">(</span>j <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/merge_v.html">merge_v</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"appliance"</span>, <span class="st">"refClass"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Conditional formatting for both family and count</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">is_correct</span> <span class="op">==</span> <span class="cn">TRUE</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">is_correct</span> <span class="op">==</span> <span class="cn">FALSE</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">is_correct</span> <span class="op">==</span> <span class="cn">TRUE</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"#e6ffe6"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">is_correct</span> <span class="op">==</span> <span class="cn">FALSE</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"#ffe6e6"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style improvements</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/theme_vanilla.html">theme_vanilla</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/align.html">align</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_outer.html">border_outer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_inner.html">border_inner</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/padding.html">padding</a></span><span class="op">(</span>padding <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Add section borders</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/hline.html">hline</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">state</span> <span class="op">!=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">state</span>, default <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        border <span class="op">=</span> <span class="fu">officer</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray40"</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/colformat_double.html">colformat_double</a></span><span class="op">(</span>j <span class="op">=</span> <span class="st">"family"</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span></span>
<span>    state <span class="op">=</span> <span class="st">"State"</span>,</span>
<span>    appliance <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"Family"</span>,</span>
<span>    refClass <span class="op">=</span> <span class="st">"Reference Class"</span>,</span>
<span>    n <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>    is_correct <span class="op">=</span> <span class="st">"Correct Value"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-6db2b27e{}.cl-6daea166{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6daea18e{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6daea18f{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 100, 0, 1.00);background-color:transparent;}.cl-6daea198{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(139, 0, 0, 1.00);background-color:transparent;}.cl-6db056d2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6db056d3{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6db056dc{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:4pt;padding-top:4pt;padding-left:4pt;padding-right:4pt;line-height: 1;background-color:transparent;}.cl-6db056dd{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:4pt;padding-top:4pt;padding-left:4pt;padding-right:4pt;line-height: 1;background-color:transparent;}.cl-6db06960{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db0696a{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db0696b{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06974{width:0.843in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06975{width:0.726in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db0697e{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db0697f{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06980{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06981{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06988{width:0.843in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06989{width:0.726in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db0698a{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06992{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06993{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06994{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db0699c{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db0699d{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db0699e{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069a6{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069a7{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069b0{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069b1{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069b2{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069ba{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069bb{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069c4{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069c5{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069c6{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069c7{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069ce{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069cf{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069d0{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069d8{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069d9{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069da{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069e2{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069e3{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069e4{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069ec{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069f6{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069f7{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db069f8{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a00{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a01{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a02{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a0a{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a14{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a15{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a1e{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a1f{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a20{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a28{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a29{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a32{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a33{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db06a34{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-6db2b27e">
<thead>
<tr style="overflow-wrap:break-word;"><th colspan="6" class="cl-6db06960"><p class="cl-6db056d2"><span class="cl-6daea166">Family prior year use per utility counts (green=most frequent)</span></p></th></tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-6db0697f"><p class="cl-6db056d2"><span class="cl-6daea166">State</span></p></th>
<th class="cl-6db06980"><p class="cl-6db056d2"><span class="cl-6daea166">Reference Class</span></p></th>
<th class="cl-6db06981"><p class="cl-6db056d2"><span class="cl-6daea166">Appliance</span></p></th>
<th class="cl-6db06988"><p class="cl-6db056d3"><span class="cl-6daea166">Family</span></p></th>
<th class="cl-6db06989"><p class="cl-6db056d3"><span class="cl-6daea166">Count</span></p></th>
<th class="cl-6db0698a"><p class="cl-6db056d3"><span class="cl-6daea166">Correct Value</span></p></th>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-6db06992"><p class="cl-6db056dc"><span class="cl-6daea18e">CAL</span></p></td>
<td rowspan="2" class="cl-6db06993"><p class="cl-6db056dc"><span class="cl-6daea18e">USD</span></p></td>
<td rowspan="2" class="cl-6db06994"><p class="cl-6db056dc"><span class="cl-6daea18e">Water Heating</span></p></td>
<td class="cl-6db0699c"><p class="cl-6db056dd"><span class="cl-6daea18f">5,061.0</span></p></td>
<td class="cl-6db0699d"><p class="cl-6db056dd"><span class="cl-6daea18f">41</span></p></td>
<td class="cl-6db0699e"><p class="cl-6db056dd"><span class="cl-6daea18e">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db069b1"><p class="cl-6db056dd"><span class="cl-6daea198">5,124.0</span></p></td>
<td class="cl-6db069b2"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db069ba"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="5" class="cl-6db069bb"><p class="cl-6db056dc"><span class="cl-6daea18e">COL</span></p></td>
<td rowspan="5" class="cl-6db069c4"><p class="cl-6db056dc"><span class="cl-6daea18e">kWh</span></p></td>
<td rowspan="3" class="cl-6db069c5"><p class="cl-6db056dc"><span class="cl-6daea18e">Heating</span></p></td>
<td class="cl-6db069c6"><p class="cl-6db056dd"><span class="cl-6daea198">340.0</span></p></td>
<td class="cl-6db069c7"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db069ce"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db069d9"><p class="cl-6db056dd"><span class="cl-6daea198">11,441.0</span></p></td>
<td class="cl-6db069da"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db069e2"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db069e3"><p class="cl-6db056dd"><span class="cl-6daea18f">18,052.0</span></p></td>
<td class="cl-6db069e4"><p class="cl-6db056dd"><span class="cl-6daea18f">36</span></p></td>
<td class="cl-6db069ba"><p class="cl-6db056dd"><span class="cl-6daea18e">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-6db069f7"><p class="cl-6db056dc"><span class="cl-6daea18e">Refrigerator</span></p></td>
<td class="cl-6db069f8"><p class="cl-6db056dd"><span class="cl-6daea18f">1,370.0</span></p></td>
<td class="cl-6db06a00"><p class="cl-6db056dd"><span class="cl-6daea18f">37</span></p></td>
<td class="cl-6db06a01"><p class="cl-6db056dd"><span class="cl-6daea18e">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db06a02"><p class="cl-6db056dd"><span class="cl-6daea198">5,600.0</span></p></td>
<td class="cl-6db06a0a"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db06a01"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-6db069bb"><p class="cl-6db056dc"><span class="cl-6daea18e">MASS</span></p></td>
<td rowspan="6" class="cl-6db069c4"><p class="cl-6db056dc"><span class="cl-6daea18e">USD</span></p></td>
<td rowspan="2" class="cl-6db069c5"><p class="cl-6db056dc"><span class="cl-6daea18e">Water Heating</span></p></td>
<td class="cl-6db069c6"><p class="cl-6db056dd"><span class="cl-6daea198">1.0</span></p></td>
<td class="cl-6db069c7"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db069ce"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db06a14"><p class="cl-6db056dd"><span class="cl-6daea18f">10,543.0</span></p></td>
<td class="cl-6db06a15"><p class="cl-6db056dd"><span class="cl-6daea18f">45</span></p></td>
<td class="cl-6db069e2"><p class="cl-6db056dd"><span class="cl-6daea18e">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="9" class="cl-6db069bb"><p class="cl-6db056dc"><span class="cl-6daea18e">TEX</span></p></td>
<td rowspan="2" class="cl-6db069c5"><p class="cl-6db056dc"><span class="cl-6daea18e">Heating</span></p></td>
<td class="cl-6db069c6"><p class="cl-6db056dd"><span class="cl-6daea198">1.0</span></p></td>
<td class="cl-6db069c7"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db069ce"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db06a14"><p class="cl-6db056dd"><span class="cl-6daea18f">6,118.0</span></p></td>
<td class="cl-6db06a15"><p class="cl-6db056dd"><span class="cl-6daea18f">51</span></p></td>
<td class="cl-6db069e2"><p class="cl-6db056dd"><span class="cl-6daea18e">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-6db06a20"><p class="cl-6db056dc"><span class="cl-6daea18e">Other Appliance</span></p></td>
<td class="cl-6db06a28"><p class="cl-6db056dd"><span class="cl-6daea198">5,987.0</span></p></td>
<td class="cl-6db06a29"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db06a32"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db06a33"><p class="cl-6db056dd"><span class="cl-6daea18f">8,459.0</span></p></td>
<td class="cl-6db06a34"><p class="cl-6db056dd"><span class="cl-6daea18f">51</span></p></td>
<td class="cl-6db06a32"><p class="cl-6db056dd"><span class="cl-6daea18e">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-6db069a7"><p class="cl-6db056dc"><span class="cl-6daea18e">Percentage</span></p></td>
<td rowspan="5" class="cl-6db069b0"><p class="cl-6db056dc"><span class="cl-6daea18e">Water Heating</span></p></td>
<td class="cl-6db069b1"><p class="cl-6db056dd"><span class="cl-6daea198">5.3</span></p></td>
<td class="cl-6db069b2"><p class="cl-6db056dd"><span class="cl-6daea198">10</span></p></td>
<td class="cl-6db069ba"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db069e3"><p class="cl-6db056dd"><span class="cl-6daea18f">5,257.0</span></p></td>
<td class="cl-6db069e4"><p class="cl-6db056dd"><span class="cl-6daea18f">29</span></p></td>
<td class="cl-6db069ba"><p class="cl-6db056dd"><span class="cl-6daea18e">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="3" class="cl-6db069a7"><p class="cl-6db056dc"><span class="cl-6daea18e">USD</span></p></td>
<td class="cl-6db069e3"><p class="cl-6db056dd"><span class="cl-6daea18f">5,257.0</span></p></td>
<td class="cl-6db069e4"><p class="cl-6db056dd"><span class="cl-6daea18f">50</span></p></td>
<td class="cl-6db069ba"><p class="cl-6db056dd"><span class="cl-6daea18e">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db069b1"><p class="cl-6db056dd"><span class="cl-6daea198">5,600.0</span></p></td>
<td class="cl-6db069b2"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db069ba"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6db069b1"><p class="cl-6db056dd"><span class="cl-6daea198">34,265.0</span></p></td>
<td class="cl-6db069b2"><p class="cl-6db056dd"><span class="cl-6daea198">1</span></p></td>
<td class="cl-6db069ba"><p class="cl-6db056dd"><span class="cl-6daea18e">FALSE</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/">flextable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/">flextable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>distinct_state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">distinct_state_avg</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Identify outliers (rows where n is 1)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>is_outlier <span class="op">=</span> <span class="va">n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Reorganize and format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">state_avg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Add title</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/add_header_lines.html">add_header_lines</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"State Avg. per utility counts (green=most frequent)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bold.html">bold</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">"header"</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Merge cells</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/merge_v.html">merge_v</a></span><span class="op">(</span>j <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/merge_v.html">merge_v</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"appliance"</span>, <span class="st">"refClass"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Conditional formatting for outliers</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">n</span> <span class="op">==</span> <span class="fl">1</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">n</span> <span class="op">==</span> <span class="fl">1</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"#ffe6e6"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"#e6ffe6"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style improvements</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/theme_vanilla.html">theme_vanilla</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/align.html">align</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_outer.html">border_outer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_inner.html">border_inner</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/padding.html">padding</a></span><span class="op">(</span>padding <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Add section borders</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/hline.html">hline</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">state</span> <span class="op">!=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">state</span>, default <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        border <span class="op">=</span> <span class="fu">officer</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray40"</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/colformat_double.html">colformat_double</a></span><span class="op">(</span>j <span class="op">=</span> <span class="st">"state_avg"</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span></span>
<span>    state <span class="op">=</span> <span class="st">"State"</span>,</span>
<span>    appliance <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    state_avg <span class="op">=</span> <span class="st">"State Average"</span>,</span>
<span>    refClass <span class="op">=</span> <span class="st">"Reference Class"</span>,</span>
<span>    n <span class="op">=</span> <span class="st">"Count"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-6dc3d25c{}.cl-6dc0dc3c{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6dc0dc46{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6dc0dc50{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(139, 0, 0, 1.00);background-color:transparent;}.cl-6dc0dc5a{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 100, 0, 1.00);background-color:transparent;}.cl-6dc1fc3e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6dc1fc48{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6dc1fc52{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:4pt;padding-top:4pt;padding-left:4pt;padding-right:4pt;line-height: 1;background-color:transparent;}.cl-6dc1fc53{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:4pt;padding-top:4pt;padding-left:4pt;padding-right:4pt;line-height: 1;background-color:transparent;}.cl-6dc20972{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20973{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20974{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc2097c{width:1.304in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc2097d{width:0.726in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc2097e{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20986{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20987{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20988{width:1.304in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20989{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20990{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20991{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc20992{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc2099a{width:1.304in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc2099b{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc2099c{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209a4{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209a5{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209a6{width:1.304in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209ae{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209af{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209b0{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209b8{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209c2{width:1.304in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209c3{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209cc{width:1.304in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6dc209cd{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-6dc3d25c">
<thead>
<tr style="overflow-wrap:break-word;"><th colspan="5" class="cl-6dc20972"><p class="cl-6dc1fc3e"><span class="cl-6dc0dc3c">State Avg. per utility counts (green=most frequent)</span></p></th></tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-6dc20972"><p class="cl-6dc1fc3e"><span class="cl-6dc0dc3c">State</span></p></th>
<th class="cl-6dc20973"><p class="cl-6dc1fc3e"><span class="cl-6dc0dc3c">Reference Class</span></p></th>
<th class="cl-6dc20974"><p class="cl-6dc1fc3e"><span class="cl-6dc0dc3c">Appliance</span></p></th>
<th class="cl-6dc2097c"><p class="cl-6dc1fc48"><span class="cl-6dc0dc3c">State Average</span></p></th>
<th class="cl-6dc2097d"><p class="cl-6dc1fc48"><span class="cl-6dc0dc3c">Count</span></p></th>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-6dc2097e"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">CAL</span></p></td>
<td rowspan="2" class="cl-6dc20986"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">USD</span></p></td>
<td rowspan="2" class="cl-6dc20987"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">Water Heating</span></p></td>
<td class="cl-6dc20988"><p class="cl-6dc1fc53"><span class="cl-6dc0dc50">4,534</span></p></td>
<td class="cl-6dc20989"><p class="cl-6dc1fc53"><span class="cl-6dc0dc50">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6dc2099a"><p class="cl-6dc1fc53"><span class="cl-6dc0dc5a">4,601</span></p></td>
<td class="cl-6dc2099b"><p class="cl-6dc1fc53"><span class="cl-6dc0dc5a">41</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="4" class="cl-6dc2099c"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">COL</span></p></td>
<td rowspan="2" class="cl-6dc209a4"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">kWh</span></p></td>
<td rowspan="2" class="cl-6dc209a5"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">Heating</span></p></td>
<td class="cl-6dc209a6"><p class="cl-6dc1fc53"><span class="cl-6dc0dc50">587</span></p></td>
<td class="cl-6dc209ae"><p class="cl-6dc1fc53"><span class="cl-6dc0dc50">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6dc209c2"><p class="cl-6dc1fc53"><span class="cl-6dc0dc5a">16,411</span></p></td>
<td class="cl-6dc209c3"><p class="cl-6dc1fc53"><span class="cl-6dc0dc5a">37</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="4" class="cl-6dc20991"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">USD</span></p></td>
<td rowspan="4" class="cl-6dc20992"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">Water Heating</span></p></td>
<td class="cl-6dc209cc"><p class="cl-6dc1fc53"><span class="cl-6dc0dc50">4,000</span></p></td>
<td class="cl-6dc209cd"><p class="cl-6dc1fc53"><span class="cl-6dc0dc50">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6dc2099a"><p class="cl-6dc1fc53"><span class="cl-6dc0dc5a">5,832</span></p></td>
<td class="cl-6dc2099b"><p class="cl-6dc1fc53"><span class="cl-6dc0dc5a">47</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-6dc2099c"><p class="cl-6dc1fc52"><span class="cl-6dc0dc46">TEX</span></p></td>
<td class="cl-6dc209a6"><p class="cl-6dc1fc53"><span class="cl-6dc0dc50">400</span></p></td>
<td class="cl-6dc209ae"><p class="cl-6dc1fc53"><span class="cl-6dc0dc50">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-6dc209c2"><p class="cl-6dc1fc53"><span class="cl-6dc0dc5a">4,396</span></p></td>
<td class="cl-6dc209c3"><p class="cl-6dc1fc53"><span class="cl-6dc0dc5a">51</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="alternate-discrep-frequency-tables" class="level3"><h3 class="anchored" data-anchor-id="alternate-discrep-frequency-tables">Alternate discrep frequency tables</h3>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com">gt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">table_data</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>distinct_families <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">family</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare the data with separate columns for Family and Frequency</span></span>
<span><span class="va">table_data_compact</span> <span class="op">&lt;-</span> <span class="va">table_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Sort by descending frequency</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="va">family</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    Family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">family</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,  <span class="co"># Order family values by descending frequency</span></span>
<span>    Frequency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">n</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,    <span class="co"># Order frequency values in descending order</span></span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the GT table with the new format</span></span>
<span><span class="va">table_data_compact</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span>rowname_col <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Compact Frequency Table by State, RefClass, and Appliance"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Label columns for clarity</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/cols_label.html">cols_label</a></span><span class="op">(</span></span>
<span>    refClass <span class="op">=</span> <span class="st">"Reference Class"</span>,</span>
<span>    appliance <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    Family <span class="op">=</span> <span class="st">"Family last year"</span>,</span>
<span>    Frequency <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style the table headers</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cell_text.html">cell_text</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_column_labels.html">cells_column_labels</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Center the row group headers for each state</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://gt.rstudio.com/reference/cell_text.html">cell_text</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"bold"</span>, align <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_row_groups.html">cells_row_groups</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style the appliance rows with lighter borders for each appliance within the state</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_options.html">tab_options</a></span><span class="op">(</span></span>
<span>    row_group.border.bottom.color <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    row_group.border.bottom.width <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    table.font.size <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span>,</span>
<span>    data_row.padding <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,  <span class="co"># Compact padding</span></span>
<span>    row.striping.include_stub <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    row.striping.background_color <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>    table.width <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/pct.html">pct</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="hvmrpjviwi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hvmrpjviwi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hvmrpjviwi thead, #hvmrpjviwi tbody, #hvmrpjviwi tfoot, #hvmrpjviwi tr, #hvmrpjviwi td, #hvmrpjviwi th {
  border-style: none;
}

#hvmrpjviwi p {
  margin: 0;
  padding: 0;
}

#hvmrpjviwi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 13px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hvmrpjviwi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hvmrpjviwi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hvmrpjviwi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hvmrpjviwi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hvmrpjviwi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hvmrpjviwi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hvmrpjviwi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hvmrpjviwi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hvmrpjviwi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hvmrpjviwi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hvmrpjviwi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hvmrpjviwi .gt_spanner_row {
  border-bottom-style: hidden;
}

#hvmrpjviwi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #BEBEBE;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hvmrpjviwi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #BEBEBE;
  vertical-align: middle;
}

#hvmrpjviwi .gt_from_md > :first-child {
  margin-top: 0;
}

#hvmrpjviwi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hvmrpjviwi .gt_row {
  padding-top: 3px;
  padding-bottom: 3px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hvmrpjviwi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hvmrpjviwi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hvmrpjviwi .gt_row_group_first td {
  border-top-width: 2px;
}

#hvmrpjviwi .gt_row_group_first th {
  border-top-width: 2px;
}

#hvmrpjviwi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hvmrpjviwi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hvmrpjviwi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hvmrpjviwi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hvmrpjviwi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hvmrpjviwi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hvmrpjviwi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hvmrpjviwi .gt_striped {
  background-color: #D3D3D3;
}

#hvmrpjviwi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hvmrpjviwi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hvmrpjviwi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hvmrpjviwi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hvmrpjviwi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hvmrpjviwi .gt_left {
  text-align: left;
}

#hvmrpjviwi .gt_center {
  text-align: center;
}

#hvmrpjviwi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hvmrpjviwi .gt_font_normal {
  font-weight: normal;
}

#hvmrpjviwi .gt_font_bold {
  font-weight: bold;
}

#hvmrpjviwi .gt_font_italic {
  font-style: italic;
}

#hvmrpjviwi .gt_super {
  font-size: 65%;
}

#hvmrpjviwi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hvmrpjviwi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hvmrpjviwi .gt_indent_1 {
  text-indent: 5px;
}

#hvmrpjviwi .gt_indent_2 {
  text-indent: 10px;
}

#hvmrpjviwi .gt_indent_3 {
  text-indent: 15px;
}

#hvmrpjviwi .gt_indent_4 {
  text-indent: 20px;
}

#hvmrpjviwi .gt_indent_5 {
  text-indent: 25px;
}

#hvmrpjviwi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hvmrpjviwi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border">Compact Frequency Table by State, RefClass, and Appliance</th>
</tr>
<tr class="gt_col_headings even">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="refClass" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Reference Class</th>
<th id="appliance" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Appliance</th>
<th id="Family" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Family last year</th>
<th id="Frequency" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Frequency (n)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">CAL</td>
<td class="gt_row gt_left" headers="stub_1_1 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_1 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_1 Family">5061, 5124</td>
<td class="gt_row gt_right" headers="stub_1_1 Frequency">41, 1</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">COL</td>
<td class="gt_row gt_left" headers="stub_1_2 refClass">kWh</td>
<td class="gt_row gt_left" headers="stub_1_2 appliance">Heating</td>
<td class="gt_row gt_right" headers="stub_1_2 Family">18052, 340, 11441</td>
<td class="gt_row gt_right" headers="stub_1_2 Frequency">36, 1, 1</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">COL</td>
<td class="gt_row gt_left" headers="stub_1_3 refClass">kWh</td>
<td class="gt_row gt_left" headers="stub_1_3 appliance">Refrigerator</td>
<td class="gt_row gt_right" headers="stub_1_3 Family">1370, 5600</td>
<td class="gt_row gt_right" headers="stub_1_3 Frequency">37, 1</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">MASS</td>
<td class="gt_row gt_left" headers="stub_1_4 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_4 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_4 Family">10543, 1</td>
<td class="gt_row gt_right" headers="stub_1_4 Frequency">45, 1</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_5 refClass">Percentage</td>
<td class="gt_row gt_left" headers="stub_1_5 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_5 Family">5257, 5.257</td>
<td class="gt_row gt_right" headers="stub_1_5 Frequency">29, 10</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_6 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_6 appliance">Heating</td>
<td class="gt_row gt_right" headers="stub_1_6 Family">6118, 1</td>
<td class="gt_row gt_right" headers="stub_1_6 Frequency">51, 1</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_7 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_7 appliance">Other Appliance</td>
<td class="gt_row gt_right" headers="stub_1_7 Family">8459, 5987</td>
<td class="gt_row gt_right" headers="stub_1_7 Frequency">51, 1</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_8 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_8 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_8 Family">5257, 5600, 34265</td>
<td class="gt_row gt_right" headers="stub_1_8 Frequency">50, 1, 1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#######</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com">gt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare the data, focusing on `state_avg` instead of `family`</span></span>
<span><span class="va">table_data_state_avg</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>distinct_state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">distinct_state_avg</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Sort by descending frequency</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    State_Avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,  <span class="co"># Order state_avg values by descending frequency</span></span>
<span>    Frequency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">n</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,          <span class="co"># Order frequency values in descending order</span></span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the GT table with the new format</span></span>
<span><span class="va">table_data_state_avg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span>rowname_col <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Compact Frequency Table by RefClass, Appliance, and State Average"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Label columns for clarity</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/cols_label.html">cols_label</a></span><span class="op">(</span></span>
<span>    refClass <span class="op">=</span> <span class="st">"Reference Class"</span>,</span>
<span>    appliance <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    State_Avg <span class="op">=</span> <span class="st">"State Avg"</span>,</span>
<span>    Frequency <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style the table headers</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cell_text.html">cell_text</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_column_labels.html">cells_column_labels</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Center the row group headers for each state</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://gt.rstudio.com/reference/cell_text.html">cell_text</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"bold"</span>, align <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_row_groups.html">cells_row_groups</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style the appliance rows with lighter borders for each appliance within the state</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_options.html">tab_options</a></span><span class="op">(</span></span>
<span>    row_group.border.bottom.color <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    row_group.border.bottom.width <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    table.font.size <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span>,</span>
<span>    data_row.padding <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,  <span class="co"># Compact padding</span></span>
<span>    row.striping.include_stub <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    row.striping.background_color <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>    table.width <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/pct.html">pct</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="lhlidulswv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lhlidulswv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lhlidulswv thead, #lhlidulswv tbody, #lhlidulswv tfoot, #lhlidulswv tr, #lhlidulswv td, #lhlidulswv th {
  border-style: none;
}

#lhlidulswv p {
  margin: 0;
  padding: 0;
}

#lhlidulswv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 13px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lhlidulswv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lhlidulswv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lhlidulswv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lhlidulswv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lhlidulswv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lhlidulswv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lhlidulswv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lhlidulswv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lhlidulswv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lhlidulswv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lhlidulswv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lhlidulswv .gt_spanner_row {
  border-bottom-style: hidden;
}

#lhlidulswv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #BEBEBE;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lhlidulswv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #BEBEBE;
  vertical-align: middle;
}

#lhlidulswv .gt_from_md > :first-child {
  margin-top: 0;
}

#lhlidulswv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lhlidulswv .gt_row {
  padding-top: 3px;
  padding-bottom: 3px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lhlidulswv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lhlidulswv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lhlidulswv .gt_row_group_first td {
  border-top-width: 2px;
}

#lhlidulswv .gt_row_group_first th {
  border-top-width: 2px;
}

#lhlidulswv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lhlidulswv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lhlidulswv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lhlidulswv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lhlidulswv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lhlidulswv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lhlidulswv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lhlidulswv .gt_striped {
  background-color: #D3D3D3;
}

#lhlidulswv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lhlidulswv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lhlidulswv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lhlidulswv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lhlidulswv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lhlidulswv .gt_left {
  text-align: left;
}

#lhlidulswv .gt_center {
  text-align: center;
}

#lhlidulswv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lhlidulswv .gt_font_normal {
  font-weight: normal;
}

#lhlidulswv .gt_font_bold {
  font-weight: bold;
}

#lhlidulswv .gt_font_italic {
  font-style: italic;
}

#lhlidulswv .gt_super {
  font-size: 65%;
}

#lhlidulswv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lhlidulswv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lhlidulswv .gt_indent_1 {
  text-indent: 5px;
}

#lhlidulswv .gt_indent_2 {
  text-indent: 10px;
}

#lhlidulswv .gt_indent_3 {
  text-indent: 15px;
}

#lhlidulswv .gt_indent_4 {
  text-indent: 20px;
}

#lhlidulswv .gt_indent_5 {
  text-indent: 25px;
}

#lhlidulswv .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#lhlidulswv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border">Compact Frequency Table by RefClass, Appliance, and State Average</th>
</tr>
<tr class="gt_col_headings even">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="refClass" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Reference Class</th>
<th id="appliance" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Appliance</th>
<th id="State_Avg" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">State Avg</th>
<th id="Frequency" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Frequency (n)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">CAL</td>
<td class="gt_row gt_left" headers="stub_1_1 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_1 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_1 State_Avg">4601, 4534</td>
<td class="gt_row gt_right" headers="stub_1_1 Frequency">41, 1</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">COL</td>
<td class="gt_row gt_left" headers="stub_1_2 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_2 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_2 State_Avg">5832, 4000</td>
<td class="gt_row gt_right" headers="stub_1_2 Frequency">47, 1</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">COL</td>
<td class="gt_row gt_left" headers="stub_1_3 refClass">kWh</td>
<td class="gt_row gt_left" headers="stub_1_3 appliance">Heating</td>
<td class="gt_row gt_right" headers="stub_1_3 State_Avg">16411, 587</td>
<td class="gt_row gt_right" headers="stub_1_3 Frequency">37, 1</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_4 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_4 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_4 State_Avg">4396, 400</td>
<td class="gt_row gt_right" headers="stub_1_4 Frequency">51, 1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a mapping between state codes and full state names</span></span>
<span><span class="va">state_code_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"CAL"</span> <span class="op">=</span> <span class="st">"California"</span>,</span>
<span>  <span class="st">"TEX"</span> <span class="op">=</span> <span class="st">"Texas"</span>,</span>
<span>  <span class="st">"COL"</span> <span class="op">=</span> <span class="st">"Colorado"</span>,</span>
<span>  <span class="st">"MASS"</span> <span class="op">=</span> <span class="st">"Massachusetts"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Revised parse_action_plan function</span></span>
<span><span class="va">parse_action_plan</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Extract participant-specific states</span></span>
<span>  <span class="va">participant_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Select action plan columns based on state codes</span></span>
<span>  <span class="va">action_plan_cols</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"^[ADP]\\d+(CAL|MASS|COL|TEX)\\d{2,3}$"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"32$"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Exclude columns ending with '32'</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Pivot longer to reshape data</span></span>
<span>  <span class="va">df_long</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">action_plan_cols</span><span class="op">)</span>,</span>
<span>      names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"modality"</span>, <span class="st">"state_code"</span>, <span class="st">"item_num"</span><span class="op">)</span>,</span>
<span>      names_pattern <span class="op">=</span> <span class="st">"^([ADP])\\d+(CAL|MASS|COL|TEX)(\\d+)$"</span>,</span>
<span>      values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      <span class="co"># Map state codes to full state names</span></span>
<span>      state_full <span class="op">=</span> <span class="va">state_code_map</span><span class="op">[</span><span class="va">state_code</span><span class="op">]</span>,</span>
<span>      <span class="co"># Ensure that the state_full is one of the participant's assigned states</span></span>
<span>      state_assigned <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">state_full</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">participant_states</span>, <span class="va">state_full</span>, <span class="cn">NA_character_</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">state_assigned</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Keep only matching states</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">state1</span>, <span class="va">state2</span>, <span class="va">refClass</span>, <span class="va">calc</span>, <span class="va">edu</span>, <span class="va">modality</span>, <span class="va">state_assigned</span>, <span class="va">item_num</span>, <span class="va">value</span>, <span class="va">id2</span>, <span class="va">Duration__in_seconds_</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># Assign appliance based on item_num</span></span>
<span>  <span class="va">df_long</span> <span class="op">&lt;-</span> <span class="va">df_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      appliance <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"07"</span>,<span class="st">"08"</span>,<span class="st">"09"</span>,<span class="st">"10"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Cooling"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11"</span>,<span class="st">"12"</span>,<span class="st">"13"</span>,<span class="st">"14"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Heating"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"15"</span>,<span class="st">"16"</span>,<span class="st">"17"</span>,<span class="st">"18"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Water Heating"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"19"</span>,<span class="st">"20"</span>,<span class="st">"21"</span>,<span class="st">"22"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Refrigerator"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"23"</span>,<span class="st">"24"</span>,<span class="st">"25"</span>,<span class="st">"26"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Other Appliance"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"27"</span>,<span class="st">"28"</span>,<span class="st">"29"</span>,<span class="st">"30"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Total kWh"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op">==</span> <span class="st">"31"</span> <span class="op">~</span> <span class="st">"Preferred Plan"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"33"</span>,<span class="st">"34"</span>,<span class="st">"35"</span>,<span class="st">"36"</span>,<span class="st">"37"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Reduction Choices"</span>,</span>
<span>        <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="co"># Assign item_type based on item_num</span></span>
<span>      item_type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"07"</span>,<span class="st">"11"</span>,<span class="st">"15"</span>,<span class="st">"19"</span>,<span class="st">"23"</span>,<span class="st">"27"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"family"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"08"</span>,<span class="st">"12"</span>,<span class="st">"16"</span>,<span class="st">"20"</span>,<span class="st">"24"</span>,<span class="st">"28"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"state_avg"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"09"</span>,<span class="st">"13"</span>,<span class="st">"17"</span>,<span class="st">"21"</span>,<span class="st">"25"</span>,<span class="st">"29"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"plan1"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"10"</span>,<span class="st">"14"</span>,<span class="st">"18"</span>,<span class="st">"22"</span>,<span class="st">"26"</span>,<span class="st">"30"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"plan2"</span>,</span>
<span>        <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Continue processing only relevant item_types</span></span>
<span>  <span class="va">df_long</span> <span class="op">&lt;-</span> <span class="va">df_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">item_type</span> <span class="op">!=</span> <span class="st">"other"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">item_num</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"item_type"</span>, values_from <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plan1"</span>, <span class="st">"plan2"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"plan"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df_long</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Read and preprocess the raw data</span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    state1 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Colorado</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Colorado"</span>,</span>
<span>      <span class="va">Massachusetts</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Massachusetts"</span>,</span>
<span>      <span class="va">California</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"California"</span>,</span>
<span>      <span class="va">Texas</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Texas"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span>,</span>
<span>    state2 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Colorado</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Colorado"</span>,</span>
<span>      <span class="va">Massachusetts</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Massachusetts"</span>,</span>
<span>      <span class="va">California</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"California"</span>,</span>
<span>      <span class="va">Texas</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Texas"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span>,</span>
<span>    refClass <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">ReferenceClass</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"USD"</span>,</span>
<span>      <span class="va">ReferenceClass</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"kWh"</span>,</span>
<span>      <span class="va">ReferenceClass</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Percentage"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span>,</span>
<span>    calc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">MATH01</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">MATH01</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>id2 <span class="op">=</span> <span class="va">ResponseId</span>, edu <span class="op">=</span> <span class="va">DEM04</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    edu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Some schooling, but no diploma or degree"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Highschool diploma or GED"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Some college"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">~</span> <span class="st">"College degree"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"Some graduate school"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">6</span> <span class="op">~</span> <span class="st">"Graduate degree"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">7</span> <span class="op">~</span> <span class="st">"Choose not to answer"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">edu</span>, <span class="va">refClass</span>, <span class="va">state1</span>, <span class="va">state2</span>, <span class="va">calc</span>, .after <span class="op">=</span> <span class="va">id2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to trim NA and empty columns</span></span>
<span><span class="va">trim_na_and_empty_columns</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="op">~</span> <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"AIND"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a list of trimmed datasets for each unique ID</span></span>
<span><span class="va">dAll</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">trim_na_and_empty_columns</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">s1</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply the revised parse_action_plan function to all participants</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">dAll</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">parse_action_plan</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine all parsed data</span></span>
<span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Handle specific data corrections (e.g., participant "R_1kFwgoKAmNTwCs3")</span></span>
<span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">id2</span> <span class="op">==</span> <span class="st">"R_1kFwgoKAmNTwCs3"</span> <span class="op">&amp;</span> <span class="va">state_assigned</span> <span class="op">==</span> <span class="st">"Texas"</span> <span class="op">&amp;</span> <span class="va">appliance</span> <span class="op">==</span> <span class="st">"Heating"</span>, <span class="fl">6118</span>, <span class="va">family</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Final mutations and calculations</span></span>
<span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    change <span class="op">=</span> <span class="va">value</span> <span class="op">-</span> <span class="va">family</span>,</span>
<span>    state_p_dif <span class="op">=</span> <span class="va">value</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>    state_f_dif <span class="op">=</span> <span class="va">family</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>    less_avg <span class="op">=</span> <span class="va">value</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>    calc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">calc</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"No Calculator"</span>, <span class="st">"Used Calculator"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s1_processed</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state_assigned</span>,<span class="va">appliance</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_distinct_family<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            n_distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span>            distinct_family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,</span>
<span>            distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span><span class="op">&gt;</span><span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Convert family and state_avg to numeric</span></span>
<span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    family_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    state_avg_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify discrepancies and include participant IDs</span></span>
<span><span class="va">duplicate_checks</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state_assigned</span>, <span class="va">appliance</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n_unique_family <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family_value</span><span class="op">)</span>,</span>
<span>    n_unique_state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg_value</span><span class="op">)</span>,</span>
<span>    families <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family_value</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    state_avgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg_value</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    participant_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">family_value</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">state_avg_value</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">'drop'</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_unique_family</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">n_unique_state_avg</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">duplicate_checks</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Found inconsistencies in family or state_avg values:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">duplicate_checks</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"No inconsistencies found in family or state_avg values.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_assigned<span class="op">=</span><span class="va">state</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s1_check</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    family_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    state_avg_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">id2</span>, <span class="va">state_assigned</span>, <span class="va">appliance</span>, <span class="va">family_value</span>, <span class="va">state_avg_value</span>, <span class="va">refClass</span>,<span class="va">state</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Rename columns in correct_values</span></span>
<span><span class="va">correct_values</span> <span class="op">&lt;-</span> <span class="va">correct_values</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>    family_correct <span class="op">=</span> <span class="va">family</span>,</span>
<span>    state_avg_correct <span class="op">=</span> <span class="va">state_avg</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">state_code_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"CAL"</span> <span class="op">=</span> <span class="st">"California"</span>,</span>
<span>  <span class="st">"TEX"</span> <span class="op">=</span> <span class="st">"Texas"</span>,</span>
<span>  <span class="st">"COL"</span> <span class="op">=</span> <span class="st">"Colorado"</span>,</span>
<span>  <span class="st">"MASS"</span> <span class="op">=</span> <span class="st">"Massachusetts"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Join participant data with correct values</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">s1_check</span>, <span class="va">correct_values</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"appliance"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute differences between participant values and correct values</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="va">comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    family_diff <span class="op">=</span> <span class="va">family_value</span> <span class="op">-</span> <span class="va">family_correct</span>,</span>
<span>    state_avg_diff <span class="op">=</span> <span class="va">state_avg_value</span> <span class="op">-</span> <span class="va">state_avg_correct</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify discrepancies</span></span>
<span><span class="va">discrepancies</span> <span class="op">&lt;-</span> <span class="va">comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">family_diff</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">state_avg_diff</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">discrepancies</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Participants with discrepancies in family or state_avg values:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span></span>
<span>    <span class="va">discrepancies</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>        <span class="va">id</span>,</span>
<span>        <span class="va">id2</span>,</span>
<span>        <span class="va">state</span>,</span>
<span>        <span class="va">appliance</span>,</span>
<span>        <span class="va">refClass</span>,</span>
<span>        <span class="va">family_value</span>,</span>
<span>        <span class="va">family_correct</span>,</span>
<span>        <span class="va">family_diff</span>,</span>
<span>        <span class="va">state_avg_value</span>,</span>
<span>        <span class="va">state_avg_correct</span>,</span>
<span>        <span class="va">state_avg_diff</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"No discrepancies found between participant values and correct values.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No discrepancies found between participant values and correct values.</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to inspect a participant's data</span></span>
<span><span class="va">inspect_participant</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">participant_id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">participant_data</span> <span class="op">&lt;-</span> <span class="va">comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">participant_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>      <span class="va">id</span>,</span>
<span>      <span class="va">id2</span>,</span>
<span>      <span class="va">state</span>,</span>
<span>      <span class="va">appliance</span>,</span>
<span>      <span class="va">refClass</span>,</span>
<span>        <span class="va">family_value</span>,</span>
<span>        <span class="va">family_correct</span>,</span>
<span>        <span class="va">family_diff</span>,</span>
<span>        <span class="va">state_avg_value</span>,</span>
<span>        <span class="va">state_avg_correct</span>,</span>
<span>        <span class="va">state_avg_diff</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">participant_data</span>, n<span class="op">=</span><span class="fl">24</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example usage:</span></span>
<span><span class="fu">inspect_participant</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>   <span class="co"># Replace with the participant ID you want to investigate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 11
# Groups:   id [1]
      id id2    state appliance refClass family_value family_correct family_diff
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;
 1     1 R_2QM… COL   Cooling   Percent…       697                NA          NA
 2     1 R_2QM… COL   Cooling   Percent…       697                NA          NA
 3     1 R_2QM… COL   Heating   Percent…     18052                NA          NA
 4     1 R_2QM… COL   Heating   Percent…     18052                NA          NA
 5     1 R_2QM… COL   Water He… Percent…     11667                NA          NA
 6     1 R_2QM… COL   Water He… Percent…     11667                NA          NA
 7     1 R_2QM… COL   Refriger… Percent…      1370                NA          NA
 8     1 R_2QM… COL   Refriger… Percent…      1370                NA          NA
 9     1 R_2QM… COL   Other Ap… Percent…      7982                NA          NA
10     1 R_2QM… COL   Other Ap… Percent…      7982                NA          NA
11     1 R_2QM… COL   Total kWh Percent…     39768                NA          NA
12     1 R_2QM… COL   Total kWh Percent…     39768                NA          NA
13     1 R_2QM… TEX   Cooling   Percent…      6573                NA          NA
14     1 R_2QM… TEX   Cooling   Percent…      6573                NA          NA
15     1 R_2QM… TEX   Heating   Percent…      6118                NA          NA
16     1 R_2QM… TEX   Heating   Percent…      6118                NA          NA
17     1 R_2QM… TEX   Water He… Percent…         5.26             NA          NA
18     1 R_2QM… TEX   Water He… Percent…         5.26             NA          NA
19     1 R_2QM… TEX   Refriger… Percent…      2639                NA          NA
20     1 R_2QM… TEX   Refriger… Percent…      2639                NA          NA
21     1 R_2QM… TEX   Other Ap… Percent…      8459                NA          NA
22     1 R_2QM… TEX   Other Ap… Percent…      8459                NA          NA
23     1 R_2QM… TEX   Total kWh Percent…     29046                NA          NA
24     1 R_2QM… TEX   Total kWh Percent…     29046                NA          NA
# ℹ 3 more variables: state_avg_value &lt;dbl&gt;, state_avg_correct &lt;dbl&gt;,
#   state_avg_diff &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">inspect_participant</span><span class="op">(</span><span class="fl">11</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 11
# Groups:   id [1]
      id id2    state appliance refClass family_value family_correct family_diff
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;
 1    11 R_263… CAL   Cooling   kWh              2581             NA          NA
 2    11 R_263… CAL   Cooling   kWh              2581             NA          NA
 3    11 R_263… CAL   Heating   kWh              6157             NA          NA
 4    11 R_263… CAL   Heating   kWh              6157             NA          NA
 5    11 R_263… CAL   Water He… kWh              5061             NA          NA
 6    11 R_263… CAL   Water He… kWh              5061             NA          NA
 7    11 R_263… CAL   Refriger… kWh              1266             NA          NA
 8    11 R_263… CAL   Refriger… kWh              1266             NA          NA
 9    11 R_263… CAL   Other Ap… kWh              7608             NA          NA
10    11 R_263… CAL   Other Ap… kWh              7608             NA          NA
11    11 R_263… CAL   Total kWh kWh             22673             NA          NA
12    11 R_263… CAL   Total kWh kWh             22673             NA          NA
13    11 R_263… COL   Cooling   kWh               697             NA          NA
14    11 R_263… COL   Cooling   kWh               697             NA          NA
15    11 R_263… COL   Heating   kWh               340             NA          NA
16    11 R_263… COL   Heating   kWh               340             NA          NA
17    11 R_263… COL   Water He… kWh             11667             NA          NA
18    11 R_263… COL   Water He… kWh             11667             NA          NA
19    11 R_263… COL   Refriger… kWh              5600             NA          NA
20    11 R_263… COL   Refriger… kWh              5600             NA          NA
21    11 R_263… COL   Other Ap… kWh              7982             NA          NA
22    11 R_263… COL   Other Ap… kWh              7982             NA          NA
23    11 R_263… COL   Total kWh kWh              1500             NA          NA
24    11 R_263… COL   Total kWh kWh              1500             NA          NA
# ℹ 3 more variables: state_avg_value &lt;dbl&gt;, state_avg_correct &lt;dbl&gt;,
#   state_avg_diff &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">correct_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">state</span>, <span class="op">~</span><span class="va">appliance</span>, <span class="op">~</span><span class="va">family</span>, <span class="op">~</span><span class="va">state_avg</span>,</span>
<span>  <span class="co"># Texas values</span></span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Cooling"</span>, <span class="fl">6573</span>, <span class="fl">4249</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Heating"</span>, <span class="fl">6118</span>, <span class="fl">5099</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span>, <span class="fl">5257</span>, <span class="fl">4396</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">2639</span>, <span class="fl">1318</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">8459</span>, <span class="fl">7883</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Total kWh"</span>, <span class="fl">29046</span>, <span class="fl">22945</span>,</span>
<span>  </span>
<span>  <span class="co"># California values</span></span>
<span>  <span class="st">"California"</span>, <span class="st">"Cooling"</span>, <span class="fl">2581</span>, <span class="fl">1289</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Heating"</span>, <span class="fl">6157</span>, <span class="fl">5597</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Water Heating"</span>, <span class="fl">5061</span>, <span class="fl">4601</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1266</span>, <span class="fl">1055</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7608</span>, <span class="fl">6916</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Total kWh"</span>, <span class="fl">22673</span>, <span class="fl">19458</span>,</span>
<span>  </span>
<span>  <span class="co"># Colorado values</span></span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Cooling"</span>, <span class="fl">697</span>, <span class="fl">498</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Heating"</span>, <span class="fl">18052</span>, <span class="fl">16411</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Water Heating"</span>, <span class="fl">11667</span>, <span class="fl">5832</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1370</span>, <span class="fl">1142</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7882</span>, <span class="fl">6652</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Total kWh"</span>, <span class="fl">39768</span>, <span class="fl">30535</span>,</span>
<span>  </span>
<span>  <span class="co"># Massachusetts values</span></span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Cooling"</span>, <span class="fl">419</span>, <span class="fl">322</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Heating"</span>, <span class="fl">26751</span>, <span class="fl">19108</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Water Heating"</span>, <span class="fl">10543</span>, <span class="fl">5070</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1230</span>, <span class="fl">1025</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7350</span>, <span class="fl">6682</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Total kWh"</span>, <span class="fl">46293</span>, <span class="fl">32207</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to inspect raw data for a specific participant and state</span></span>
<span><span class="va">inspect_raw_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">response_id</span>, <span class="va">state_code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get participant's raw data</span></span>
<span>  <span class="va">participant_data</span> <span class="op">&lt;-</span> <span class="va">raw_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ResponseId</span> <span class="op">==</span> <span class="va">response_id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get relevant columns for the state</span></span>
<span>  <span class="va">relevant_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span>, </span>
<span>                                                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"^[ADP]\\d+"</span>, <span class="va">state_code</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create a mapping for item numbers to appliance types</span></span>
<span>  <span class="va">appliance_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">item_nums</span>, <span class="op">~</span><span class="va">appliance</span>,</span>
<span>    <span class="st">"07|08"</span>, <span class="st">"Cooling"</span>,</span>
<span>    <span class="st">"11|12"</span>, <span class="st">"Heating"</span>,</span>
<span>    <span class="st">"15|16"</span>, <span class="st">"Water Heating"</span>,</span>
<span>    <span class="st">"19|20"</span>, <span class="st">"Refrigerator"</span>,</span>
<span>    <span class="st">"23|24"</span>, <span class="st">"Other Appliance"</span>,</span>
<span>    <span class="st">"27|28"</span>, <span class="st">"Total kWh"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract and organize values</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">appliance_map</span><span class="op">$</span><span class="va">item_nums</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nums</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cols</span> <span class="op">&lt;-</span> <span class="va">relevant_cols</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">relevant_cols</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="va">nums</span>, <span class="st">")$"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">values</span> <span class="op">&lt;-</span> <span class="va">participant_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>      column <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span>,</span>
<span>      appliance <span class="op">=</span> <span class="va">appliance_map</span><span class="op">$</span><span class="va">appliance</span><span class="op">[</span><span class="va">appliance_map</span><span class="op">$</span><span class="va">item_nums</span> <span class="op">==</span> <span class="va">nums</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Let's check participant 1's Texas Water Heating issue</span></span>
<span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check Participant 1 (R_2QMsYuHS385pTj1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Participant 1 - Texas Water Heating Values:"</span><span class="op">)</span></span>
<span><span class="va">p1_tex</span> <span class="op">&lt;-</span> <span class="fu">inspect_raw_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"TEX"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p1_tex</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="st">"Water"</span><span class="op">)</span><span class="op">)</span>,n<span class="op">=</span><span class="fl">24</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Check Participant 11 (R_263zmNZDB4Pqn9h)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"\nParticipant 11 - Colorado Heating Values:"</span><span class="op">)</span></span>
<span><span class="va">p11_col</span> <span class="op">&lt;-</span> <span class="fu">inspect_raw_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="st">"R_263zmNZDB4Pqn9h"</span>, <span class="st">"COL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p11_col</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="st">"Heating"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to compare raw vs processed values</span></span>
<span><span class="va">compare_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">processed_data</span>, <span class="va">response_id</span>, <span class="va">state</span>, <span class="va">appliance_type</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get raw values</span></span>
<span>  <span class="va">raw_vals</span> <span class="op">&lt;-</span> <span class="fu">inspect_raw_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">response_id</span>, </span>
<span>                                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>                                  <span class="va">state</span> <span class="op">==</span> <span class="st">"Texas"</span> <span class="op">~</span> <span class="st">"TEX"</span>,</span>
<span>                                  <span class="va">state</span> <span class="op">==</span> <span class="st">"Colorado"</span> <span class="op">~</span> <span class="st">"COL"</span>,</span>
<span>                                  <span class="va">state</span> <span class="op">==</span> <span class="st">"California"</span> <span class="op">~</span> <span class="st">"CAL"</span>,</span>
<span>                                  <span class="va">state</span> <span class="op">==</span> <span class="st">"Massachusetts"</span> <span class="op">~</span> <span class="st">"MASS"</span></span>
<span>                                <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">==</span> <span class="va">appliance_type</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get processed values</span></span>
<span>  <span class="va">proc_vals</span> <span class="op">&lt;-</span> <span class="va">processed_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id2</span> <span class="op">==</span> <span class="va">response_id</span>, </span>
<span>           <span class="va">state</span> <span class="op">==</span> <span class="op">!</span><span class="op">!</span><span class="va">state</span>,</span>
<span>           <span class="va">appliance</span> <span class="op">==</span> <span class="va">appliance_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">family</span>, <span class="va">state_avg_value</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Compare</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="st">"Raw Data"</span>,</span>
<span>    family <span class="op">=</span> <span class="va">raw_vals</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">raw_vals</span><span class="op">$</span><span class="va">column</span>, <span class="st">"07$|11$|15$|19$|23$|27$"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    state_avg <span class="op">=</span> <span class="va">raw_vals</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">raw_vals</span><span class="op">$</span><span class="va">column</span>, <span class="st">"08$|12$|16$|20$|24$|28$"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>        source <span class="op">=</span> <span class="st">"Processed Data"</span>,</span>
<span>        family <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">proc_vals</span><span class="op">$</span><span class="va">family</span><span class="op">)</span>,</span>
<span>        state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">proc_vals</span><span class="op">$</span><span class="va">state_avg_value</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example comparisons</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"\nComparison for Participant 1 - Texas Water Heating:"</span><span class="op">)</span></span>
<span><span class="fu">compare_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">s1_processed</span>, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">raw_data</span><span class="op">$</span><span class="va">P3TEX15</span><span class="op">)</span></span>
<span><span class="va">s1_processed</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state2</span><span class="op">==</span><span class="st">"Texas"</span>,<span class="va">appliance</span><span class="op">==</span><span class="st">"Water Heating"</span>,<span class="va">state_assigned</span><span class="op">==</span><span class="st">"Texas"</span>,<span class="va">plan</span><span class="op">==</span><span class="st">"plan1"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"\nComparison for Participant 11 - Colorado Heating:"</span><span class="op">)</span></span>
<span><span class="fu">compare_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">s1_processed</span>, <span class="st">"R_263zmNZDB4Pqn9h"</span>, <span class="st">"Colorado"</span>, <span class="st">"Heating"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check if the discrepancy is consistent across different blocks/presentations</span></span>
<span><span class="va">check_all_presentations</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">response_id</span>, <span class="va">state_code</span>, <span class="va">appliance_pattern</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">participant_data</span> <span class="op">&lt;-</span> <span class="va">raw_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ResponseId</span> <span class="op">==</span> <span class="va">response_id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">all_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span>, </span>
<span>                                               <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"^[ADP]\\d+"</span>, <span class="va">state_code</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                                      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span>, <span class="va">appliance_pattern</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">participant_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">all_cols</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"column"</span>, value <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">column</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example: Check all presentations of water heating for participant 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"\nAll presentations of water heating for Participant 1:"</span><span class="op">)</span></span>
<span><span class="fu">check_all_presentations</span><span class="op">(</span><span class="va">raw_data</span>, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"TEX"</span>, <span class="st">"15|16"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">raw_data</span><span class="op">$</span><span class="va">P3TEX15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="just-refclass-percentage-and-state-2-texas-have-the-issues-with-family-water-heating-5.26" class="level2"><h2 class="anchored" data-anchor-id="just-refclass-percentage-and-state-2-texas-have-the-issues-with-family-water-heating-5.26">Just refClass Percentage and state 2 Texas have the issues with family water heating = 5.26</h2>
<p>r$&gt; s1_processed |&gt; filter(state2==“Texas”,appliance==“Water Heating”,state_assigned==“Texas”,plan==“plan1”) |&gt; head(15) # A tibble: 15 × 17 id state1 state2 refClass calc edu modality state_assigned id2 Duration_<em>in_seconds</em> appliance family state_avg plan value family_value state_avg_value <int><chr><chr><chr><fct><fct><chr><chr><chr><dbl><chr> &lt;dbl+lbl&gt; &lt;dbl+lbl&gt; <chr> &lt;dbl+lbl&gt; <dbl><dbl> 1 1 Colorado Texas Percentage 1 Graduate degree P Texas R_2QMsYuHS385pTj1 1008 Water Heating 5.26 4396 plan1 700 5.26 4396 2 2 Colorado Texas Percentage 1 College degree P Texas R_2tzIyZavpl1RZBY 1126 Water Heating 5.26 4396 plan1 4396 5.26 4396 3 3 Colorado Texas Percentage 1 College degree P Texas R_3Gm1Y4QzSlyrEWo 870 Water Heating 5.26 4396 plan1 4468 5.26 4396 4 4 Colorado Texas Percentage 1 College degree P Texas R_Djh2q728ibyNWjD 2763 Water Heating 5.26 4396 plan1 1000 5.26 4396 5 5 Colorado Texas Percentage 0 Graduate degree P Texas R_3fAXNbIZ7kFieSu 920 Water Heating 5.26 4396 plan1 3756 5.26 4396 6 6 Colorado Texas Percentage 0 Graduate degree P Texas R_1JECzl10KgckJXg 878 Water Heating 5.26 4396 plan1 5200 5.26 4396 7 7 Colorado Texas Percentage 1 Graduate degree P Texas R_C2IQAZim25sij4d 2680 Water Heating 5.26 4396 plan1 4257 5.26 4396 8 8 Colorado Texas Percentage 1 Some college P Texas R_5bbi3tpMOhuGBIR 1628 Water Heating 5.26 4396 plan1 5100 5.26 4396 9 9 Colorado Texas Percentage 1 Graduate degree P Texas R_2BsVSAOpehXW9Cr 724 Water Heating 5.26 4396 plan1 5217 5.26 4396 10 10 Colorado Texas Percentage 1 Some college P Texas R_325F8wRln52w1QN 913 Water Heating 5.26 4396 plan1 4468 5.26 4396 11 12 Colorado Texas kWh 1 Graduate degree A Texas R_abEpO6g4xKOlwwF 644 Water Heating 5257 4396 plan1 8459 5257 4396 12 14 Colorado Texas USD 0 College degree D Texas R_2VsaxwvgHXasQx3 625 Water Heating 5257 400 plan1 4000 5257 400 13 24 Massachusetts Texas USD 1 College degree D Texas R_AEvC2EEL0GltodP 1047 Water Heating 5257 4396 plan1 4000 5257 4396 14 36 Colorado Texas USD 0 Graduate degree D Texas R_1nO7uu36tUOSbfw 390 Water Heating 5257 4396 plan1 4500 5257 4396 15 38 Massachusetts Texas kWh 1 College degree A Texas R_6f13I34krdFacjT 973 Water Heating 5257 4396 plan1 4500 5257 4396</dbl></dbl></chr></chr></dbl></chr></chr></chr></fct></fct></chr></chr></chr></int></p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/tegorman13\.github\.io\/Representation_Study\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../nb/overview.html" class="pagination-link" aria-label="Overview">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../misc/indiv.html" class="pagination-link" aria-label="Response Patterns">
        <span class="nav-page-text">Response Patterns</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024 <a href="https://tegorman13.github.io">Thomas Gorman</a></p>
</div>   
    <div class="nav-footer-center">
<p>site made with <a href="https://cran.r-project.org/"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a> and <a href="https://quarto.org/">Quarto</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/tegorman13/Representation_Study/blob/main/misc/outlier.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="https://github.com/tegorman13/Representation_Study" target="_blank">
<p><i class="fa-brands fa-github fa-2.0x" aria-label="github"></i></p>
</a>
  </li>  
</ul>
</div>
  </div>
</footer>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>