<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Thomas E. Gorman">
<title>Outliers and discrepancies – Representation Study</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../study_stim.html" rel="next">
<link href="../results.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-bb594cf559d6c7be5da8d399972e3a16.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link href="../site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="../site_libs/tabwid-1.1.3/tabwid.js"></script><link rel="stylesheet" href="../assets/style_qt.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../study1.html">Analysis</a></li><li class="breadcrumb-item"><a href="../misc/outlier.html">Outliers and discrepancies</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Representation Study</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/tegorman13/Representation_Study" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../study1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Study 1 Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../study2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Study 2 Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Results</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../misc/outlier.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Outliers and discrepancies</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Background</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../study_stim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Design and Stimulii</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../study_info.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">study 2 full info</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../initial_slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MPA_Slides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../study1_info.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">study 1 codebook</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../study2_info.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">study 2 codebook</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page-right" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../study1.html">Analysis</a></li><li class="breadcrumb-item"><a href="../misc/outlier.html">Outliers and discrepancies</a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Outliers and discrepancies</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author column-page-right">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://tegorman13.github.io/">Thomas E. Gorman</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://web.ics.purdue.edu/~treimer/">
            Communication and Cognition Lab, Purdue University, USA
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta column-page-right">

      
  
    
  </div>
  


</header><div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trinker/pacman">pacman</a></span><span class="op">)</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">dplyr</span>,<span class="va">purrr</span>,<span class="va">tidyr</span>,<span class="va">here</span>, <span class="va">haven</span>,<span class="va">tibble</span>,<span class="va">ggplot2</span>,<span class="va">gt</span>,<span class="va">ggh4x</span>,<span class="va">lme4</span>,<span class="va">flextable</span>,<span class="va">ggdist</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/s1_processed.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/s2_processed.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1_agg</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span><span class="st">"Total kWh"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span>,<span class="va">refClass</span>,<span class="va">state</span>,<span class="va">block</span>,<span class="va">plan</span>,<span class="va">calc</span>,<span class="va">edu</span>,<span class="va">pct_goal</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_kWh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,orig_kWh<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>, </span>
<span>            pct_change <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">orig_kWh</span><span class="op">-</span><span class="va">total_kWh</span><span class="op">)</span><span class="op">/</span><span class="va">orig_kWh</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>            n_change <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">!=</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            state_p_dif<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">state_p_dif</span><span class="op">)</span>,</span>
<span>            state_f_dif<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">state_f_dif</span><span class="op">)</span>,</span>
<span>            n_less_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">less_avg</span><span class="op">)</span>,</span>
<span>            duration<span class="op">=</span><span class="fu">first</span><span class="op">(</span><span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>matched_goal <span class="op">=</span> <span class="op">(</span><span class="va">pct_change</span> <span class="op">==</span> <span class="va">pct_goal</span><span class="op">)</span>, </span>
<span>             error <span class="op">=</span> <span class="va">pct_change</span> <span class="op">-</span> <span class="va">pct_goal</span>,</span>
<span>            abs_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">error</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># s1_agg |&gt; filter(matched_goal==FALSE, abs_error&lt;.02) |&gt; pull(abs_error)</span></span>
<span></span>
<span></span>
<span><span class="va">s1_agg4</span> <span class="op">&lt;-</span> <span class="va">s1_agg</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">matched_goal</span><span class="op">)</span>,n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, pct<span class="op">=</span><span class="va">mg</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">s1_agg2</span> <span class="op">&lt;-</span> <span class="va">s1_agg</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span>,<span class="va">refClass</span>,<span class="va">state</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">matched_goal</span><span class="op">)</span>,n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, pct<span class="op">=</span><span class="va">mg</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">outliers</span> <span class="op">&lt;-</span> <span class="va">s1_agg</span> <span class="op">|&gt;</span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>change_mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pct_change</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,change_sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">pct_change</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                     z_score<span class="op">=</span><span class="op">(</span><span class="va">pct_change</span><span class="op">-</span><span class="va">change_mean</span><span class="op">)</span><span class="op">/</span><span class="va">change_sd</span>,</span>
<span>                                     is_outlier<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">z_score</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">3.0</span><span class="op">)</span></span>
<span><span class="va">outlier_id</span> <span class="op">&lt;-</span> <span class="va">outliers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">is_outlier</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pull</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># quick summary of s1$Duration_in_seconds variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">s1</span><span class="op">$</span><span class="va">Duration__in_seconds_</span><span class="op">)</span></span>
<span>  <span class="co">#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span>  <span class="co">#   176     846    1184    1659    1688   47914 </span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Duration__in_seconds_</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Duration__in_seconds_</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">refClass</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">|&gt;</span>  <span class="fu">mutate</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">id</span>,x<span class="op">=</span><span class="va">Duration__in_seconds_</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">0.6</span>,position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>w<span class="op">=</span><span class="fl">0</span>, h<span class="op">=</span><span class="fl">0.17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggh4x</span><span class="fu">::</span><span class="fu"><a href="https://teunbrand.github.io/ggh4x/reference/facet_nested_wrap.html">facet_nested_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">refClass</span>,axes<span class="op">=</span><span class="st">"all"</span>,scales<span class="op">=</span><span class="st">"free"</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="va">s1_agg</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">duration</span><span class="op">&lt;</span><span class="fl">10000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">duration</span>,y<span class="op">=</span><span class="va">abs_error</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">refClass</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s1_agg</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">refClass</span><span class="op">)</span> <span class="op">+</span> <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span><span class="op">==</span><span class="st">"s2_10"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">s2_long</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>shape<span class="op">=</span><span class="va">plan</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">state_avg</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">family</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">id</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">rounded</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>,<span class="va">family</span>,<span class="va">rounded</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># counts for each distinct value</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span>,<span class="va">plan</span><span class="op">==</span><span class="st">"plan1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>,<span class="va">family</span>,<span class="va">rounded</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size<span class="op">=</span><span class="va">n</span>,alpha<span class="op">=</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="va">n</span><span class="op">)</span>,vjust<span class="op">=</span><span class="fl">1</span>,size<span class="op">=</span><span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">rounded</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">plan</span><span class="op">==</span><span class="st">"plan1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>,<span class="va">family</span>,<span class="va">rounded</span>,<span class="va">state</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size<span class="op">=</span><span class="va">n</span>,alpha<span class="op">=</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="va">n</span><span class="op">)</span>,vjust<span class="op">=</span><span class="fl">1</span>,size<span class="op">=</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">state</span><span class="op">~</span><span class="va">rounded</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># bar plot version of the above</span></span>
<span><span class="va">s2_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span><span class="op">!=</span><span class="st">"TOTAL"</span>,<span class="va">state</span><span class="op">==</span><span class="st">"California"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>,<span class="va">family</span>,<span class="va">rounded</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n<span class="op">=</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">appliance</span>,y<span class="op">=</span><span class="va">family</span>,fill<span class="op">=</span><span class="va">rounded</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">rounded</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"TOTAL"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">rounded</span>, <span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    distinct_families <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    color_flag <span class="op">=</span> <span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Continue grouping for plotting</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">family</span>, <span class="va">rounded</span>, <span class="va">state</span>,<span class="va">color_flag</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">appliance</span>, y <span class="op">=</span> <span class="va">family</span>,color <span class="op">=</span> <span class="va">color_flag</span>,fill<span class="op">=</span><span class="va">color_flag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="va">color_flag</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">rounded</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Family Value"</span>,</span>
<span>    size <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="va">s2_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"TOTAL"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">rounded</span>, <span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    distinct_families <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>    color_flag <span class="op">=</span> <span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Continue grouping for plotting</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">rounded</span>, <span class="va">state</span>,<span class="va">color_flag</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">appliance</span>, y <span class="op">=</span> <span class="va">state_avg</span>,color <span class="op">=</span> <span class="va">color_flag</span>,fill<span class="op">=</span><span class="va">color_flag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="va">color_flag</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">rounded</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Family Value"</span>,</span>
<span>    size <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    distinct_families <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    color_flag <span class="op">=</span> <span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Continue grouping for plotting</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">appliance</span>, <span class="va">family</span>, <span class="va">state</span>,<span class="va">color_flag</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">color_flag</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">appliance</span>, y <span class="op">=</span> <span class="va">family</span>,color <span class="op">=</span> <span class="va">color_flag</span>,fill<span class="op">=</span><span class="va">color_flag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="co">#geom_point(aes(alpha = .1, color = color_flag), position = position_jitter(width = 0.15)) +</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.75</span>,height<span class="op">=</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">refClass</span><span class="op">~</span><span class="va">state</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Family Value"</span>,</span>
<span>    size <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="task-data-checks" class="level2"><h2 class="anchored" data-anchor-id="task-data-checks">Task data checks</h2>
<div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for every combination of state, appliance, and refClass, calculate the number of distinct values of family, and of state_avg</span></span>
<span><span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_distinct_family<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            n_distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span>            distinct_family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,</span>
<span>            distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span><span class="op">&gt;</span><span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 7
# Groups:   state, appliance [10]
   state appliance       refClass   n_distinct_family n_distinct_state_avg
   &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;                  &lt;int&gt;                &lt;int&gt;
 1 CAL   Water Heating   USD                        2                    2
 2 COL   Heating         kWh                        3                    2
 3 COL   Refrigerator    kWh                        2                    1
 4 COL   Total kWh       kWh                        2                    1
 5 COL   Water Heating   USD                        1                    2
 6 MASS  Water Heating   USD                        2                    1
 7 TEX   Heating         USD                        2                    1
 8 TEX   Other Appliance USD                        2                    1
 9 TEX   Total kWh       kWh                        1                    2
10 TEX   Water Heating   Percentage                 2                    1
11 TEX   Water Heating   USD                        3                    2
# ℹ 2 more variables: distinct_family &lt;chr&gt;, distinct_state_avg &lt;chr&gt;</code></pre>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span>,<span class="va">rounded</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_distinct_family<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            n_distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span>            distinct_family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,</span>
<span>            distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span><span class="op">&gt;</span><span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 8
# Groups:   state, appliance, refClass [8]
  state        appliance refClass rounded n_distinct_family n_distinct_state_avg
  &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;               &lt;int&gt;                &lt;int&gt;
1 California   HEAT      kWh      Not Ro…                 2                    1
2 Colorado     HEAT      USD      Rounded                 1                    2
3 Colorado     WATER     Percent… Not Ro…                 1                    2
4 Massachuset… AC        Percent… Rounded                 2                    1
5 Massachuset… AC        USD      Rounded                 2                    1
6 Texas        HEAT      Percent… Not Ro…                 2                    1
7 Texas        HEAT      kWh      Not Ro…                 2                    1
8 Texas        WATER     Percent… Not Ro…                 2                    1
# ℹ 2 more variables: distinct_family &lt;chr&gt;, distinct_state_avg &lt;chr&gt;</code></pre>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n_distinct_family<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            n_distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span>            distinct_family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,</span>
<span>            distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span>,<span class="va">family</span>,<span class="va">state_avg</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">calc</span>,<span class="op">-</span><span class="va">edu</span>,<span class="op">-</span><span class="va">modality</span>,<span class="op">-</span><span class="va">id2</span>,<span class="op">-</span><span class="va">Duration__in_seconds_</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span><span class="op">&gt;</span><span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 20
# Groups:   state, appliance, refClass, family, state_avg [1]
      id state1   state2 refClass   state appliance family state_avg plan  value
   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl+lbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1     1 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1   700
 2     1 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4500
 3     2 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  4396
 4     2 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4396
 5     3 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  4468
 6     3 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4400
 7     4 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  1000
 8     4 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  1000
 9     5 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  3756
10     5 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  2987
11     6 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  5200
12     6 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4530
13     7 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  4257
14     7 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  3396
15     8 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  5100
16     8 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4500
17     9 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  5217
18     9 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4346
19    10 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan1  4468
20    10 Colorado Texas  Percentage TEX   Water He…   5.26 4396      plan2  4468
# ℹ 10 more variables: block &lt;dbl&gt;, pct_goal &lt;dbl&gt;, change &lt;dbl&gt;,
#   state_p_dif &lt;dbl&gt;, state_f_dif &lt;dbl&gt;, less_avg &lt;lgl&gt;,
#   n_distinct_family &lt;int&gt;, n_distinct_state_avg &lt;int&gt;, distinct_family &lt;chr&gt;,
#   distinct_state_avg &lt;chr&gt;</code></pre>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s1</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n_distinct_family <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>           n_distinct_state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>           distinct_family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span>,</span>
<span>           distinct_state_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">family</span>, <span class="va">state_avg</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>           family_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">state_avg</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">family</span>, <span class="va">state_avg</span>, <span class="va">family_count</span>, <span class="va">state_avg_count</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>,<span class="va">appliance</span>,<span class="va">refClass</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 7
# Groups:   state, appliance, refClass, state_avg [10]
   state appliance     refClass family state_avg family_count state_avg_count
   &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt; &lt;dbl+lbl&gt;        &lt;int&gt;           &lt;int&gt;
 1 CAL   Water Heating USD        5061  4601               82              82
 2 CAL   Water Heating USD        5124  4534                2               2
 3 COL   Heating       kWh         340   587                2               2
 4 COL   Heating       kWh       18052 16411               72              74
 5 COL   Heating       kWh       11441 16411                2              74
 6 COL   Refrigerator  kWh        5600  1142                2              76
 7 COL   Refrigerator  kWh        1370  1142               74              76
 8 COL   Total kWh     kWh        1500 30535                2              76
 9 COL   Total kWh     kWh       39768 30535               74              76
10 COL   Water Heating USD       11667  4000                2               2
11 COL   Water Heating USD       11667  5832               94              94
12 MASS  Water Heating USD           1  5070                2              92
13 MASS  Water Heating USD       10543  5070               90              92
14 TEX   Heating       USD           1  5099                2             104
15 TEX   Heating       USD        6118  5099              102             104</code></pre>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">problematic_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"R_1kFwgoKAmNTwCs3"</span><span class="op">)</span> <span class="co"># Add other IDs as needed</span></span>
<span></span>
<span><span class="va">raw_subset</span> <span class="op">&lt;-</span>  <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ResponseId</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">problematic_ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ResponseId</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P1"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P2"</span><span class="op">)</span>, </span>
<span>         <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P3"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P4"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">raw_subset</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 593
  ResponseId     P1TEX01 P1TEX02 P1TEX03 P1TEX04 P1TEX05 P1TEX06 P1TEX07 P1TEX08
  &lt;chr&gt;          &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 R_1kFwgoKAmNT… NA      NA      NA      NA      NA      NA           NA      NA
# ℹ 584 more variables: P1TEX09 &lt;dbl&gt;, P1TEX10 &lt;dbl&gt;, P1TEX11 &lt;dbl&gt;,
#   P1TEX12 &lt;dbl&gt;, P1TEX13 &lt;dbl&gt;, P1TEX14 &lt;dbl&gt;, P1TEX15 &lt;dbl&gt;, P1TEX16 &lt;dbl&gt;,
#   P1TEX17 &lt;dbl&gt;, P1TEX18 &lt;dbl&gt;, P1TEX19 &lt;dbl&gt;, P1TEX20 &lt;dbl&gt;, P1TEX21 &lt;dbl&gt;,
#   P1TEX22 &lt;dbl&gt;, P1TEX23 &lt;dbl&gt;, P1TEX24 &lt;dbl&gt;, P1TEX25 &lt;dbl&gt;, P1TEX26 &lt;dbl&gt;,
#   P1TEX27 &lt;dbl&gt;, P1TEX28 &lt;dbl&gt;, P1TEX29 &lt;dbl&gt;, P1TEX30 &lt;dbl&gt;,
#   P1TEX31 &lt;dbl+lbl&gt;, P1TEX32 &lt;chr&gt;, P1TEX33 &lt;dbl+lbl&gt;, P1TEX34 &lt;dbl+lbl&gt;,
#   P1TEX35 &lt;dbl+lbl&gt;, P1TEX36 &lt;dbl+lbl&gt;, P1TEX37 &lt;dbl+lbl&gt;, …</code></pre>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"Texas"</span>,<span class="va">appliance</span><span class="op">==</span><span class="st">"HEAT"</span>, <span class="va">rounded</span><span class="op">==</span><span class="st">"Not Rounded"</span>,<span class="va">refClass</span><span class="op">==</span><span class="st">"kWh"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">family</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 16
# Groups:   id, block [18]
   id     block refClass appliance pct_goal rounded     state calc   edu     pct
   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;  &lt;fct&gt; &lt;dbl&gt;
 1 s2_10      1 kWh      HEAT      10%      Not Rounded Texas No Ca… Coll…  0.1 
 2 s2_10      1 kWh      HEAT      10%      Not Rounded Texas No Ca… Coll…  0.1 
 3 s2_100     2 kWh      HEAT      15%      Not Rounded Texas Calcu… High…  0.15
 4 s2_100     2 kWh      HEAT      15%      Not Rounded Texas Calcu… High…  0.15
 5 s2_101     2 kWh      HEAT      15%      Not Rounded Texas Calcu… Some…  0.15
 6 s2_101     2 kWh      HEAT      15%      Not Rounded Texas Calcu… Some…  0.15
 7 s2_137     1 kWh      HEAT      10%      Not Rounded Texas Calcu… Some…  0.1 
 8 s2_137     1 kWh      HEAT      10%      Not Rounded Texas Calcu… Some…  0.1 
 9 s2_138     1 kWh      HEAT      10%      Not Rounded Texas Calcu… Grad…  0.1 
10 s2_138     1 kWh      HEAT      10%      Not Rounded Texas Calcu… Grad…  0.1 
# ℹ 26 more rows
# ℹ 6 more variables: family &lt;dbl&gt;, state_avg &lt;dbl&gt;, plan &lt;fct&gt;, value &lt;dbl&gt;,
#   change &lt;dbl&gt;, state_dif &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s2_long</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span><span class="op">==</span><span class="st">"s2_10"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="co"># no effort</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 16
# Groups:   id, block [2]
   id    block refClass appliance pct_goal rounded     state   calc  edu     pct
   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt;
 1 s2_10     1 kWh      AC        10%      Not Rounded Texas   No C… Coll…  0.1 
 2 s2_10     1 kWh      AC        10%      Not Rounded Texas   No C… Coll…  0.1 
 3 s2_10     1 kWh      HEAT      10%      Not Rounded Texas   No C… Coll…  0.1 
 4 s2_10     1 kWh      HEAT      10%      Not Rounded Texas   No C… Coll…  0.1 
 5 s2_10     1 kWh      WATER     10%      Not Rounded Texas   No C… Coll…  0.1 
 6 s2_10     1 kWh      WATER     10%      Not Rounded Texas   No C… Coll…  0.1 
 7 s2_10     1 kWh      REFRIG    10%      Not Rounded Texas   No C… Coll…  0.1 
 8 s2_10     1 kWh      REFRIG    10%      Not Rounded Texas   No C… Coll…  0.1 
 9 s2_10     1 kWh      OTHER     10%      Not Rounded Texas   No C… Coll…  0.1 
10 s2_10     1 kWh      OTHER     10%      Not Rounded Texas   No C… Coll…  0.1 
11 s2_10     1 kWh      TOTAL     10%      Not Rounded Texas   No C… Coll…  0.1 
12 s2_10     1 kWh      TOTAL     10%      Not Rounded Texas   No C… Coll…  0.1 
13 s2_10     2 kWh      AC        15%      Rounded     Massac… No C… Coll…  0.15
14 s2_10     2 kWh      AC        15%      Rounded     Massac… No C… Coll…  0.15
15 s2_10     2 kWh      HEAT      15%      Rounded     Massac… No C… Coll…  0.15
16 s2_10     2 kWh      HEAT      15%      Rounded     Massac… No C… Coll…  0.15
17 s2_10     2 kWh      WATER     15%      Rounded     Massac… No C… Coll…  0.15
18 s2_10     2 kWh      WATER     15%      Rounded     Massac… No C… Coll…  0.15
19 s2_10     2 kWh      REFRIG    15%      Rounded     Massac… No C… Coll…  0.15
20 s2_10     2 kWh      REFRIG    15%      Rounded     Massac… No C… Coll…  0.15
# ℹ 6 more variables: family &lt;dbl&gt;, state_avg &lt;dbl&gt;, plan &lt;fct&gt;, value &lt;dbl&gt;,
#   change &lt;dbl&gt;, state_dif &lt;dbl&gt;</code></pre>
</div>
</div>
<p>r$&gt; s1 |&gt; filter(family==34265) |&gt; select(id,state1,state2,refClass,id2,state,appliance,family,state_avg,plan,value,block,pct_goal) # A tibble: 2 × 13 # Groups: id [1] id state1 state2 refClass id2 state appliance family state_avg plan value block pct_goal <int><chr><chr><chr><chr><chr><chr><dbl> &lt;dbl+lbl&gt; <fct><dbl><dbl><dbl> 1 16 Texas Massachusetts USD R_3gNKA8IQr0uOSh3 TEX Water Heating 34265 4396 plan1 5486 1 0.15 2 16 Texas Massachusetts USD R_3gNKA8IQr0uOSh3 TEX Water Heating 34265 4396 plan2 6414 1 0.15</dbl></dbl></dbl></fct></dbl></chr></chr></chr></chr></chr></chr></int></p>
<p>s2_long |&gt; group_by(state,appliance,refClass,rounded) |&gt; mutate(state_avg=as.numeric(state_avg)) |&gt; summarise(n_distinct_family=n_distinct(family), n_distinct_state_avg=n_distinct(state_avg), # paste a string of each distinct value, separated by a comma distinct_family=paste(unique(family),collapse=“,”), distinct_state_avg=paste(unique(state_avg),collapse=“,”)) |&gt; filter(n_distinct_family&gt;1 | n_distinct_state_avg&gt;1) # A tibble: 8 × 8 # Groups: state, appliance, refClass [8] state appliance refClass rounded n_distinct_family n_distinct_state_avg distinct_family distinct_state_avg <chr><chr><chr><chr><int><int><chr><chr><br>
1 California HEAT kWh Not Rounded 2 1 3000,6157 5597<br>
2 Colorado HEAT USD Rounded 1 2 18000 16411,NA<br>
3 Colorado WATER Percentage Not Rounded 1 2 11667 1142,5832<br>
4 Massachusetts AC Percentage Rounded 2 1 0,1 322<br>
5 Massachusetts AC USD Rounded 2 1 0,1 322<br>
6 Texas HEAT Percentage Not Rounded 2 1 6118,5 5099<br>
7 Texas HEAT kWh Not Rounded 2 1 8539,6118 5099<br>
8 Texas WATER Percentage Not Rounded 2 1 5.257,5257 4396</chr></chr></int></int></chr></chr></chr></chr></p>
<p>r$&gt; s2_long |&gt; filter(family==3000,state==“California”,appliance==“HEAT”) # A tibble: 2 × 16 # Groups: id, block [1] id block refClass appliance pct_goal rounded state calc edu pct family state_avg plan value change state_dif <chr><dbl><chr><chr><chr><chr><chr><chr><fct><dbl><dbl><dbl><fct><dbl><dbl><dbl> 1 s2_11 1 kWh HEAT 10% Not Rounded California No Calculator Some college 0.1 3000 5597 plan1 4000 1000 -1597 2 s2_11 1 kWh HEAT 10% Not Rounded California No Calculator Some college 0.1 3000 5597 plan2 5000 2000 -597</dbl></dbl></dbl></fct></dbl></dbl></dbl></fct></chr></chr></chr></chr></chr></chr></dbl></chr></p>
<p>s2_long |&gt; filter(family==1) id block refClass appliance pct_goal rounded state calc edu pct family state_avg plan value change state_dif <chr><dbl><chr><chr><chr><chr><chr><chr><fct><dbl><dbl><dbl><fct><dbl><dbl><dbl> 1 s2_8 1 Percentage AC 15% Rounded Massachusetts Calculator College degree 0.15 1 322 plan1 1 0 -321 2 s2_8 1 Percentage AC 15% Rounded Massachusetts Calculator College degree 0.15 1 322 plan2 1 0 -321 3 s2_9 2 USD AC 10% Rounded Massachusetts No Calculator College degree 0.1 1 322 plan1 1 0 -321 4 s2_9 2 USD AC 10% Rounded Massachusetts No Calculator College degree 0.1 1 322 plan2 1 0 -321</dbl></dbl></dbl></fct></dbl></dbl></dbl></fct></chr></chr></chr></chr></chr></chr></dbl></chr></p>
</section><section id="wells-family-15-r-and-smith-family-10-e-percentage---5.257-for-texas-water-heating" class="level2"><h2 class="anchored" data-anchor-id="wells-family-15-r-and-smith-family-10-e-percentage---5.257-for-texas-water-heating">Wells Family 15 R and Smith Family 10 E Percentage - 5.257 for Texas water heating</h2>
<p>s2_long |&gt; filter(family==5.257) # A tibble: 8 × 16 # Groups: id, block [4] id block refClass appliance pct_goal rounded state calc edu pct family state_avg plan value change state_dif <chr><dbl><chr><chr><chr><chr><chr><chr><fct><dbl><dbl><dbl><fct><dbl><dbl><dbl> 1 s2_1 2 Percentage WATER 10% Not Rounded Texas Calculator Some college 0.1 5.26 4396 plan1 5000 4995. 604 2 s2_1 2 Percentage WATER 10% Not Rounded Texas Calculator Some college 0.1 5.26 4396 plan2 5000 4995. 604 3 s2_2 2 Percentage WATER 10% Not Rounded Texas No Calculator Graduate degree 0.1 5.26 4396 plan1 4396 4391. 0 4 s2_2 2 Percentage WATER 10% Not Rounded Texas No Calculator Graduate degree 0.1 5.26 4396 plan2 5257 5252. 861 5 s2_3 2 Percentage WATER 10% Not Rounded Texas Calculator Graduate degree 0.1 5.26 4396 plan1 3527 3522. -869 6 s2_3 2 Percentage WATER 10% Not Rounded Texas Calculator Graduate degree 0.1 5.26 4396 plan2 3027 3022. -1369 7 s2_4 2 Percentage WATER 10% Not Rounded Texas Calculator Graduate degree 0.1 5.26 4396 plan1 4800 4795. 404 8 s2_4 2 Percentage WATER 10% Not Rounded Texas Calculator Graduate degree 0.1 5.26 4396 plan2 5000 4995. 604</dbl></dbl></dbl></fct></dbl></dbl></dbl></fct></chr></chr></chr></chr></chr></chr></dbl></chr></p>
</section><section id="inspects-counts-for-each-distinct-value-of-prior-year-family-use-and-state-average" class="level2"><h2 class="anchored" data-anchor-id="inspects-counts-for-each-distinct-value-of-prior-year-family-use-and-state-average">Inspects counts for each distinct value of prior year family use, and state average</h2>
<div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/">flextable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">correct_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">state</span>, <span class="op">~</span><span class="va">appliance</span>, <span class="op">~</span><span class="va">family</span>, <span class="op">~</span><span class="va">state_avg</span>,</span>
<span>  <span class="co"># Texas values</span></span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Cooling"</span>, <span class="fl">6573</span>, <span class="fl">4249</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Heating"</span>, <span class="fl">6118</span>, <span class="fl">5099</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span>, <span class="fl">5257</span>, <span class="fl">4396</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">2639</span>, <span class="fl">1318</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">8459</span>, <span class="fl">7883</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Total kWh"</span>, <span class="fl">29046</span>, <span class="fl">22945</span>,</span>
<span>  </span>
<span>  <span class="co"># California values</span></span>
<span>  <span class="st">"California"</span>, <span class="st">"Cooling"</span>, <span class="fl">2581</span>, <span class="fl">1289</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Heating"</span>, <span class="fl">6157</span>, <span class="fl">5597</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Water Heating"</span>, <span class="fl">5061</span>, <span class="fl">4601</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1266</span>, <span class="fl">1055</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7608</span>, <span class="fl">6916</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Total kWh"</span>, <span class="fl">22673</span>, <span class="fl">19458</span>,</span>
<span>  </span>
<span>  <span class="co"># Colorado values</span></span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Cooling"</span>, <span class="fl">697</span>, <span class="fl">498</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Heating"</span>, <span class="fl">18052</span>, <span class="fl">16411</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Water Heating"</span>, <span class="fl">11667</span>, <span class="fl">5832</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1370</span>, <span class="fl">1142</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7882</span>, <span class="fl">6652</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Total kWh"</span>, <span class="fl">39768</span>, <span class="fl">30535</span>,</span>
<span>  </span>
<span>  <span class="co"># Massachusetts values</span></span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Cooling"</span>, <span class="fl">419</span>, <span class="fl">322</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Heating"</span>, <span class="fl">26751</span>, <span class="fl">19108</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Water Heating"</span>, <span class="fl">10543</span>, <span class="fl">5070</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1230</span>, <span class="fl">1025</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7350</span>, <span class="fl">6682</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Total kWh"</span>, <span class="fl">46293</span>, <span class="fl">32207</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># First, create a lookup table of correct values</span></span>
<span><span class="va">correct_lookup</span> <span class="op">&lt;-</span> <span class="va">correct_values</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">family</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">state</span> <span class="op">==</span> <span class="st">"Texas"</span> <span class="op">~</span> <span class="st">"TEX"</span>,</span>
<span>    <span class="va">state</span> <span class="op">==</span> <span class="st">"California"</span> <span class="op">~</span> <span class="st">"CAL"</span>,</span>
<span>    <span class="va">state</span> <span class="op">==</span> <span class="st">"Colorado"</span> <span class="op">~</span> <span class="st">"COL"</span>,</span>
<span>    <span class="va">state</span> <span class="op">==</span> <span class="st">"Massachusetts"</span> <span class="op">~</span> <span class="st">"MASS"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">state</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modify the main table</span></span>
<span><span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    distinct_families <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    color_flag <span class="op">=</span> <span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">color_flag</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">family</span>, <span class="va">state</span>, <span class="va">color_flag</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">color_flag</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Join with correct values to create is_correct flag</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">correct_lookup</span>, </span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"appliance"</span><span class="op">)</span>,</span>
<span>            suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_correct"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>is_correct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span> <span class="op">-</span> <span class="va">family_correct</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">family_correct</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Reorganize and format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="va">family</span>, <span class="va">n</span>, <span class="va">is_correct</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Swapped order here</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">family</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/add_header_lines.html">add_header_lines</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"Family prior year use per utility counts (green=most frequent)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bold.html">bold</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">"header"</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Merge cells</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/merge_v.html">merge_v</a></span><span class="op">(</span>j <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/merge_v.html">merge_v</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"appliance"</span>, <span class="st">"refClass"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Conditional formatting for both family and count</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">is_correct</span> <span class="op">==</span> <span class="cn">TRUE</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">is_correct</span> <span class="op">==</span> <span class="cn">FALSE</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">is_correct</span> <span class="op">==</span> <span class="cn">TRUE</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"#e6ffe6"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">is_correct</span> <span class="op">==</span> <span class="cn">FALSE</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"#ffe6e6"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style improvements</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/theme_vanilla.html">theme_vanilla</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/align.html">align</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"n"</span><span class="op">)</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_outer.html">border_outer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_inner.html">border_inner</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/padding.html">padding</a></span><span class="op">(</span>padding <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Add section borders</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/hline.html">hline</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">state</span> <span class="op">!=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">state</span>, default <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        border <span class="op">=</span> <span class="fu">officer</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray40"</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/colformat_double.html">colformat_double</a></span><span class="op">(</span>j <span class="op">=</span> <span class="st">"family"</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span></span>
<span>    state <span class="op">=</span> <span class="st">"State"</span>,</span>
<span>    appliance <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"Family"</span>,</span>
<span>    refClass <span class="op">=</span> <span class="st">"Reference Class"</span>,</span>
<span>    n <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>    is_correct <span class="op">=</span> <span class="st">"Correct Value"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="tabwid">
<style>.cl-ed9e8388{}.cl-ed9adec2{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ed9adecc{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ed9adecd{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 100, 0, 1.00);background-color:transparent;}.cl-ed9aded6{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(139, 0, 0, 1.00);background-color:transparent;}.cl-ed9c334e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ed9c334f{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ed9c3358{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:4pt;padding-top:4pt;padding-left:4pt;padding-right:4pt;line-height: 1;background-color:transparent;}.cl-ed9c3359{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:4pt;padding-top:4pt;padding-left:4pt;padding-right:4pt;line-height: 1;background-color:transparent;}.cl-ed9c435c{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c435d{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4366{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4367{width:0.843in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4368{width:0.726in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4369{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4370{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4371{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4372{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c437a{width:0.843in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c437b{width:0.726in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c437c{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4384{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4385{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c438e{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c438f{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4390{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4398{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4399{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c439a{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43a2{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43a3{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43a4{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43a5{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43ac{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43ad{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43ae{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43b6{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43b7{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43b8{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43b9{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43c0{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43c1{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43c2{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43ca{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43cb{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43cc{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43cd{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43d4{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43d5{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43de{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43df{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43e0{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43e1{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43e8{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43e9{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43f2{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43f3{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43f4{width:0.681in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43fc{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43fd{width:1.344in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c43fe{width:0.843in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4406{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4407{width:1.279in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4408{width:0.843in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed9c4409{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-ed9e8388">
<thead>
<tr style="overflow-wrap:break-word;"><th colspan="6" class="cl-ed9c435c"><p class="cl-ed9c334e"><span class="cl-ed9adec2">Family prior year use per utility counts (green=most frequent)</span></p></th></tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-ed9c4370"><p class="cl-ed9c334e"><span class="cl-ed9adec2">State</span></p></th>
<th class="cl-ed9c4371"><p class="cl-ed9c334e"><span class="cl-ed9adec2">Reference Class</span></p></th>
<th class="cl-ed9c4372"><p class="cl-ed9c334e"><span class="cl-ed9adec2">Appliance</span></p></th>
<th class="cl-ed9c437a"><p class="cl-ed9c334f"><span class="cl-ed9adec2">Family</span></p></th>
<th class="cl-ed9c437b"><p class="cl-ed9c334f"><span class="cl-ed9adec2">Count</span></p></th>
<th class="cl-ed9c437c"><p class="cl-ed9c334f"><span class="cl-ed9adec2">Correct Value</span></p></th>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-ed9c4384"><p class="cl-ed9c3358"><span class="cl-ed9adecc">CAL</span></p></td>
<td rowspan="2" class="cl-ed9c4385"><p class="cl-ed9c3358"><span class="cl-ed9adecc">USD</span></p></td>
<td rowspan="2" class="cl-ed9c438e"><p class="cl-ed9c3358"><span class="cl-ed9adecc">Water Heating</span></p></td>
<td class="cl-ed9c438f"><p class="cl-ed9c3359"><span class="cl-ed9adecd">5,061.0</span></p></td>
<td class="cl-ed9c4390"><p class="cl-ed9c3359"><span class="cl-ed9adecd">41</span></p></td>
<td class="cl-ed9c4398"><p class="cl-ed9c3359"><span class="cl-ed9adecc">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43a3"><p class="cl-ed9c3359"><span class="cl-ed9aded6">5,124.0</span></p></td>
<td class="cl-ed9c43a4"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c43a5"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="5" class="cl-ed9c43ac"><p class="cl-ed9c3358"><span class="cl-ed9adecc">COL</span></p></td>
<td rowspan="5" class="cl-ed9c43ad"><p class="cl-ed9c3358"><span class="cl-ed9adecc">kWh</span></p></td>
<td rowspan="3" class="cl-ed9c43ae"><p class="cl-ed9c3358"><span class="cl-ed9adecc">Heating</span></p></td>
<td class="cl-ed9c43b6"><p class="cl-ed9c3359"><span class="cl-ed9aded6">340.0</span></p></td>
<td class="cl-ed9c43b7"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c43b8"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43c2"><p class="cl-ed9c3359"><span class="cl-ed9aded6">11,441.0</span></p></td>
<td class="cl-ed9c43ca"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c43cb"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43cc"><p class="cl-ed9c3359"><span class="cl-ed9adecd">18,052.0</span></p></td>
<td class="cl-ed9c43cd"><p class="cl-ed9c3359"><span class="cl-ed9adecd">36</span></p></td>
<td class="cl-ed9c43a5"><p class="cl-ed9c3359"><span class="cl-ed9adecc">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-ed9c43de"><p class="cl-ed9c3358"><span class="cl-ed9adecc">Refrigerator</span></p></td>
<td class="cl-ed9c43df"><p class="cl-ed9c3359"><span class="cl-ed9adecd">1,370.0</span></p></td>
<td class="cl-ed9c43e0"><p class="cl-ed9c3359"><span class="cl-ed9adecd">37</span></p></td>
<td class="cl-ed9c43e1"><p class="cl-ed9c3359"><span class="cl-ed9adecc">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43e8"><p class="cl-ed9c3359"><span class="cl-ed9aded6">5,600.0</span></p></td>
<td class="cl-ed9c43e9"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c43e1"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-ed9c43ac"><p class="cl-ed9c3358"><span class="cl-ed9adecc">MASS</span></p></td>
<td rowspan="6" class="cl-ed9c43ad"><p class="cl-ed9c3358"><span class="cl-ed9adecc">USD</span></p></td>
<td rowspan="2" class="cl-ed9c43ae"><p class="cl-ed9c3358"><span class="cl-ed9adecc">Water Heating</span></p></td>
<td class="cl-ed9c43b6"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1.0</span></p></td>
<td class="cl-ed9c43b7"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c43b8"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43f2"><p class="cl-ed9c3359"><span class="cl-ed9adecd">10,543.0</span></p></td>
<td class="cl-ed9c43f3"><p class="cl-ed9c3359"><span class="cl-ed9adecd">45</span></p></td>
<td class="cl-ed9c43cb"><p class="cl-ed9c3359"><span class="cl-ed9adecc">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="9" class="cl-ed9c43ac"><p class="cl-ed9c3358"><span class="cl-ed9adecc">TEX</span></p></td>
<td rowspan="2" class="cl-ed9c43ae"><p class="cl-ed9c3358"><span class="cl-ed9adecc">Heating</span></p></td>
<td class="cl-ed9c43b6"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1.0</span></p></td>
<td class="cl-ed9c43b7"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c43b8"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43f2"><p class="cl-ed9c3359"><span class="cl-ed9adecd">6,118.0</span></p></td>
<td class="cl-ed9c43f3"><p class="cl-ed9c3359"><span class="cl-ed9adecd">51</span></p></td>
<td class="cl-ed9c43cb"><p class="cl-ed9c3359"><span class="cl-ed9adecc">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-ed9c43fd"><p class="cl-ed9c3358"><span class="cl-ed9adecc">Other Appliance</span></p></td>
<td class="cl-ed9c43fe"><p class="cl-ed9c3359"><span class="cl-ed9aded6">5,987.0</span></p></td>
<td class="cl-ed9c4406"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c4407"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c4408"><p class="cl-ed9c3359"><span class="cl-ed9adecd">8,459.0</span></p></td>
<td class="cl-ed9c4409"><p class="cl-ed9c3359"><span class="cl-ed9adecd">51</span></p></td>
<td class="cl-ed9c4407"><p class="cl-ed9c3359"><span class="cl-ed9adecc">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-ed9c439a"><p class="cl-ed9c3358"><span class="cl-ed9adecc">Percentage</span></p></td>
<td rowspan="5" class="cl-ed9c43a2"><p class="cl-ed9c3358"><span class="cl-ed9adecc">Water Heating</span></p></td>
<td class="cl-ed9c43a3"><p class="cl-ed9c3359"><span class="cl-ed9aded6">5.3</span></p></td>
<td class="cl-ed9c43a4"><p class="cl-ed9c3359"><span class="cl-ed9aded6">10</span></p></td>
<td class="cl-ed9c43a5"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43cc"><p class="cl-ed9c3359"><span class="cl-ed9adecd">5,257.0</span></p></td>
<td class="cl-ed9c43cd"><p class="cl-ed9c3359"><span class="cl-ed9adecd">29</span></p></td>
<td class="cl-ed9c43a5"><p class="cl-ed9c3359"><span class="cl-ed9adecc">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="3" class="cl-ed9c439a"><p class="cl-ed9c3358"><span class="cl-ed9adecc">USD</span></p></td>
<td class="cl-ed9c43cc"><p class="cl-ed9c3359"><span class="cl-ed9adecd">5,257.0</span></p></td>
<td class="cl-ed9c43cd"><p class="cl-ed9c3359"><span class="cl-ed9adecd">50</span></p></td>
<td class="cl-ed9c43a5"><p class="cl-ed9c3359"><span class="cl-ed9adecc">TRUE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43a3"><p class="cl-ed9c3359"><span class="cl-ed9aded6">5,600.0</span></p></td>
<td class="cl-ed9c43a4"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c43a5"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ed9c43a3"><p class="cl-ed9c3359"><span class="cl-ed9aded6">34,265.0</span></p></td>
<td class="cl-ed9c43a4"><p class="cl-ed9c3359"><span class="cl-ed9aded6">1</span></p></td>
<td class="cl-ed9c43a5"><p class="cl-ed9c3359"><span class="cl-ed9adecc">FALSE</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/">flextable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/flextable-book/">flextable</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>distinct_state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">distinct_state_avg</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Identify outliers (rows where n is 1)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>is_outlier <span class="op">=</span> <span class="va">n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Reorganize and format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="va">state_avg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Add title</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/add_header_lines.html">add_header_lines</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"State Avg. per utility counts (green=most frequent)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bold.html">bold</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">"header"</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Merge cells</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/merge_v.html">merge_v</a></span><span class="op">(</span>j <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/merge_v.html">merge_v</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"appliance"</span>, <span class="st">"refClass"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Conditional formatting for outliers</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">n</span> <span class="op">==</span> <span class="fl">1</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/color.html">color</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">n</span> <span class="op">==</span> <span class="fl">1</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"#ffe6e6"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bg.html">bg</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span>, j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"#e6ffe6"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style improvements</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/theme_vanilla.html">theme_vanilla</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/align.html">align</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state_avg"</span>, <span class="st">"n"</span><span class="op">)</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_outer.html">border_outer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_inner.html">border_inner</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/padding.html">padding</a></span><span class="op">(</span>padding <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Add section borders</span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/hline.html">hline</a></span><span class="op">(</span>i <span class="op">=</span> <span class="op">~</span> <span class="va">state</span> <span class="op">!=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">state</span>, default <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        border <span class="op">=</span> <span class="fu">officer</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray40"</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/colformat_double.html">colformat_double</a></span><span class="op">(</span>j <span class="op">=</span> <span class="st">"state_avg"</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span></span>
<span>    state <span class="op">=</span> <span class="st">"State"</span>,</span>
<span>    appliance <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    state_avg <span class="op">=</span> <span class="st">"State Average"</span>,</span>
<span>    refClass <span class="op">=</span> <span class="st">"Reference Class"</span>,</span>
<span>    n <span class="op">=</span> <span class="st">"Count"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="tabwid">
<style>.cl-edaf98bc{}.cl-edac7524{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-edac752e{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-edac752f{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(139, 0, 0, 1.00);background-color:transparent;}.cl-edac7530{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 100, 0, 1.00);background-color:transparent;}.cl-edadb52e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-edadb538{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-edadb542{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:4pt;padding-top:4pt;padding-left:4pt;padding-right:4pt;line-height: 1;background-color:transparent;}.cl-edadb543{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:4pt;padding-top:4pt;padding-left:4pt;padding-right:4pt;line-height: 1;background-color:transparent;}.cl-edadc32a{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc32b{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc334{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc335{width:1.304in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc336{width:0.726in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc33e{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc33f{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc348{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc349{width:1.304in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc34a{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc352{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc353{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc35c{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc35d{width:1.304in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc35e{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc366{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc367{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc368{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc369{width:1.304in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc370{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc371{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc372{width:1.474in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc37a{width:1.225in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc37b{width:1.304in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc37c{width:0.726in;background-color:rgba(230, 255, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc384{width:1.304in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-edadc385{width:0.726in;background-color:rgba(255, 230, 230, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 1pt solid rgba(102, 102, 102, 1.00);border-right: 1pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-edaf98bc">
<thead>
<tr style="overflow-wrap:break-word;"><th colspan="5" class="cl-edadc32a"><p class="cl-edadb52e"><span class="cl-edac7524">State Avg. per utility counts (green=most frequent)</span></p></th></tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-edadc32a"><p class="cl-edadb52e"><span class="cl-edac7524">State</span></p></th>
<th class="cl-edadc32b"><p class="cl-edadb52e"><span class="cl-edac7524">Reference Class</span></p></th>
<th class="cl-edadc334"><p class="cl-edadb52e"><span class="cl-edac7524">Appliance</span></p></th>
<th class="cl-edadc335"><p class="cl-edadb538"><span class="cl-edac7524">State Average</span></p></th>
<th class="cl-edadc336"><p class="cl-edadb538"><span class="cl-edac7524">Count</span></p></th>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-edadc33e"><p class="cl-edadb542"><span class="cl-edac752e">CAL</span></p></td>
<td rowspan="2" class="cl-edadc33f"><p class="cl-edadb542"><span class="cl-edac752e">USD</span></p></td>
<td rowspan="2" class="cl-edadc348"><p class="cl-edadb542"><span class="cl-edac752e">Water Heating</span></p></td>
<td class="cl-edadc349"><p class="cl-edadb543"><span class="cl-edac752f">4,534</span></p></td>
<td class="cl-edadc34a"><p class="cl-edadb543"><span class="cl-edac752f">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-edadc35d"><p class="cl-edadb543"><span class="cl-edac7530">4,601</span></p></td>
<td class="cl-edadc35e"><p class="cl-edadb543"><span class="cl-edac7530">41</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="4" class="cl-edadc366"><p class="cl-edadb542"><span class="cl-edac752e">COL</span></p></td>
<td rowspan="2" class="cl-edadc367"><p class="cl-edadb542"><span class="cl-edac752e">kWh</span></p></td>
<td rowspan="2" class="cl-edadc368"><p class="cl-edadb542"><span class="cl-edac752e">Heating</span></p></td>
<td class="cl-edadc369"><p class="cl-edadb543"><span class="cl-edac752f">587</span></p></td>
<td class="cl-edadc370"><p class="cl-edadb543"><span class="cl-edac752f">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-edadc37b"><p class="cl-edadb543"><span class="cl-edac7530">16,411</span></p></td>
<td class="cl-edadc37c"><p class="cl-edadb543"><span class="cl-edac7530">37</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="4" class="cl-edadc353"><p class="cl-edadb542"><span class="cl-edac752e">USD</span></p></td>
<td rowspan="4" class="cl-edadc35c"><p class="cl-edadb542"><span class="cl-edac752e">Water Heating</span></p></td>
<td class="cl-edadc384"><p class="cl-edadb543"><span class="cl-edac752f">4,000</span></p></td>
<td class="cl-edadc385"><p class="cl-edadb543"><span class="cl-edac752f">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-edadc35d"><p class="cl-edadb543"><span class="cl-edac7530">5,832</span></p></td>
<td class="cl-edadc35e"><p class="cl-edadb543"><span class="cl-edac7530">47</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td rowspan="2" class="cl-edadc366"><p class="cl-edadb542"><span class="cl-edac752e">TEX</span></p></td>
<td class="cl-edadc369"><p class="cl-edadb543"><span class="cl-edac752f">400</span></p></td>
<td class="cl-edadc370"><p class="cl-edadb543"><span class="cl-edac752f">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-edadc37b"><p class="cl-edadb543"><span class="cl-edac7530">4,396</span></p></td>
<td class="cl-edadc37c"><p class="cl-edadb543"><span class="cl-edac7530">51</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="alternate-discrep-frequency-tables" class="level3"><h3 class="anchored" data-anchor-id="alternate-discrep-frequency-tables">Alternate discrep frequency tables</h3>
<div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com">gt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">table_data</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>distinct_families <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">distinct_families</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">family</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare the data with separate columns for Family and Frequency</span></span>
<span><span class="va">table_data_compact</span> <span class="op">&lt;-</span> <span class="va">table_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">appliance</span>, <span class="va">refClass</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Sort by descending frequency</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="va">family</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    Family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">family</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,  <span class="co"># Order family values by descending frequency</span></span>
<span>    Frequency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">n</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,    <span class="co"># Order frequency values in descending order</span></span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the GT table with the new format</span></span>
<span><span class="va">table_data_compact</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span>rowname_col <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Compact Frequency Table by State, RefClass, and Appliance"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Label columns for clarity</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/cols_label.html">cols_label</a></span><span class="op">(</span></span>
<span>    refClass <span class="op">=</span> <span class="st">"Reference Class"</span>,</span>
<span>    appliance <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    Family <span class="op">=</span> <span class="st">"Family last year"</span>,</span>
<span>    Frequency <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style the table headers</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cell_text.html">cell_text</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_column_labels.html">cells_column_labels</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Center the row group headers for each state</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://gt.rstudio.com/reference/cell_text.html">cell_text</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"bold"</span>, align <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_row_groups.html">cells_row_groups</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style the appliance rows with lighter borders for each appliance within the state</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_options.html">tab_options</a></span><span class="op">(</span></span>
<span>    row_group.border.bottom.color <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    row_group.border.bottom.width <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    table.font.size <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span>,</span>
<span>    data_row.padding <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,  <span class="co"># Compact padding</span></span>
<span>    row.striping.include_stub <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    row.striping.background_color <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>    table.width <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/pct.html">pct</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="zomhyeoxja" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zomhyeoxja table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zomhyeoxja thead, #zomhyeoxja tbody, #zomhyeoxja tfoot, #zomhyeoxja tr, #zomhyeoxja td, #zomhyeoxja th {
  border-style: none;
}

#zomhyeoxja p {
  margin: 0;
  padding: 0;
}

#zomhyeoxja .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 13px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zomhyeoxja .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zomhyeoxja .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zomhyeoxja .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zomhyeoxja .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zomhyeoxja .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zomhyeoxja .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zomhyeoxja .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zomhyeoxja .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zomhyeoxja .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zomhyeoxja .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zomhyeoxja .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zomhyeoxja .gt_spanner_row {
  border-bottom-style: hidden;
}

#zomhyeoxja .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #BEBEBE;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zomhyeoxja .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #BEBEBE;
  vertical-align: middle;
}

#zomhyeoxja .gt_from_md > :first-child {
  margin-top: 0;
}

#zomhyeoxja .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zomhyeoxja .gt_row {
  padding-top: 3px;
  padding-bottom: 3px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zomhyeoxja .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zomhyeoxja .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zomhyeoxja .gt_row_group_first td {
  border-top-width: 2px;
}

#zomhyeoxja .gt_row_group_first th {
  border-top-width: 2px;
}

#zomhyeoxja .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zomhyeoxja .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zomhyeoxja .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zomhyeoxja .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zomhyeoxja .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zomhyeoxja .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zomhyeoxja .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zomhyeoxja .gt_striped {
  background-color: #D3D3D3;
}

#zomhyeoxja .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zomhyeoxja .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zomhyeoxja .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zomhyeoxja .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zomhyeoxja .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zomhyeoxja .gt_left {
  text-align: left;
}

#zomhyeoxja .gt_center {
  text-align: center;
}

#zomhyeoxja .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zomhyeoxja .gt_font_normal {
  font-weight: normal;
}

#zomhyeoxja .gt_font_bold {
  font-weight: bold;
}

#zomhyeoxja .gt_font_italic {
  font-style: italic;
}

#zomhyeoxja .gt_super {
  font-size: 65%;
}

#zomhyeoxja .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zomhyeoxja .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zomhyeoxja .gt_indent_1 {
  text-indent: 5px;
}

#zomhyeoxja .gt_indent_2 {
  text-indent: 10px;
}

#zomhyeoxja .gt_indent_3 {
  text-indent: 15px;
}

#zomhyeoxja .gt_indent_4 {
  text-indent: 20px;
}

#zomhyeoxja .gt_indent_5 {
  text-indent: 25px;
}

#zomhyeoxja .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#zomhyeoxja div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border">Compact Frequency Table by State, RefClass, and Appliance</th>
</tr>
<tr class="gt_col_headings even">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="refClass" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Reference Class</th>
<th id="appliance" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Appliance</th>
<th id="Family" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Family last year</th>
<th id="Frequency" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Frequency (n)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">CAL</td>
<td class="gt_row gt_left" headers="stub_1_1 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_1 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_1 Family">5061, 5124</td>
<td class="gt_row gt_right" headers="stub_1_1 Frequency">41, 1</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">COL</td>
<td class="gt_row gt_left" headers="stub_1_2 refClass">kWh</td>
<td class="gt_row gt_left" headers="stub_1_2 appliance">Heating</td>
<td class="gt_row gt_right" headers="stub_1_2 Family">18052, 340, 11441</td>
<td class="gt_row gt_right" headers="stub_1_2 Frequency">36, 1, 1</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">COL</td>
<td class="gt_row gt_left" headers="stub_1_3 refClass">kWh</td>
<td class="gt_row gt_left" headers="stub_1_3 appliance">Refrigerator</td>
<td class="gt_row gt_right" headers="stub_1_3 Family">1370, 5600</td>
<td class="gt_row gt_right" headers="stub_1_3 Frequency">37, 1</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">MASS</td>
<td class="gt_row gt_left" headers="stub_1_4 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_4 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_4 Family">10543, 1</td>
<td class="gt_row gt_right" headers="stub_1_4 Frequency">45, 1</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_5 refClass">Percentage</td>
<td class="gt_row gt_left" headers="stub_1_5 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_5 Family">5257, 5.257</td>
<td class="gt_row gt_right" headers="stub_1_5 Frequency">29, 10</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_6 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_6 appliance">Heating</td>
<td class="gt_row gt_right" headers="stub_1_6 Family">6118, 1</td>
<td class="gt_row gt_right" headers="stub_1_6 Frequency">51, 1</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_7 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_7 appliance">Other Appliance</td>
<td class="gt_row gt_right" headers="stub_1_7 Family">8459, 5987</td>
<td class="gt_row gt_right" headers="stub_1_7 Frequency">51, 1</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_8 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_8 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_8 Family">5257, 5600, 34265</td>
<td class="gt_row gt_right" headers="stub_1_8 Frequency">50, 1, 1</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#######</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com">gt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare the data, focusing on `state_avg` instead of `family`</span></span>
<span><span class="va">table_data_state_avg</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">!=</span> <span class="st">"Total kWh"</span>, <span class="va">plan</span> <span class="op">==</span> <span class="st">"plan1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>distinct_state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">distinct_state_avg</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">state</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Sort by descending frequency</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span>, <span class="va">state_avg</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">refClass</span>, <span class="va">appliance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    State_Avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,  <span class="co"># Order state_avg values by descending frequency</span></span>
<span>    Frequency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">n</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,          <span class="co"># Order frequency values in descending order</span></span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the GT table with the new format</span></span>
<span><span class="va">table_data_state_avg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span>rowname_col <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Compact Frequency Table by RefClass, Appliance, and State Average"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Label columns for clarity</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/cols_label.html">cols_label</a></span><span class="op">(</span></span>
<span>    refClass <span class="op">=</span> <span class="st">"Reference Class"</span>,</span>
<span>    appliance <span class="op">=</span> <span class="st">"Appliance"</span>,</span>
<span>    State_Avg <span class="op">=</span> <span class="st">"State Avg"</span>,</span>
<span>    Frequency <span class="op">=</span> <span class="st">"Frequency (n)"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style the table headers</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cell_text.html">cell_text</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_column_labels.html">cells_column_labels</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Center the row group headers for each state</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://gt.rstudio.com/reference/cell_text.html">cell_text</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"bold"</span>, align <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_row_groups.html">cells_row_groups</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Style the appliance rows with lighter borders for each appliance within the state</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_options.html">tab_options</a></span><span class="op">(</span></span>
<span>    row_group.border.bottom.color <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    row_group.border.bottom.width <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    table.font.size <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span>,</span>
<span>    data_row.padding <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,  <span class="co"># Compact padding</span></span>
<span>    row.striping.include_stub <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    row.striping.background_color <span class="op">=</span> <span class="st">"lightgrey"</span>,</span>
<span>    table.width <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/pct.html">pct</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="zocpcamkld" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zocpcamkld table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zocpcamkld thead, #zocpcamkld tbody, #zocpcamkld tfoot, #zocpcamkld tr, #zocpcamkld td, #zocpcamkld th {
  border-style: none;
}

#zocpcamkld p {
  margin: 0;
  padding: 0;
}

#zocpcamkld .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 13px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zocpcamkld .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zocpcamkld .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zocpcamkld .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zocpcamkld .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zocpcamkld .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zocpcamkld .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zocpcamkld .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zocpcamkld .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zocpcamkld .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zocpcamkld .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zocpcamkld .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zocpcamkld .gt_spanner_row {
  border-bottom-style: hidden;
}

#zocpcamkld .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #BEBEBE;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zocpcamkld .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #BEBEBE;
  vertical-align: middle;
}

#zocpcamkld .gt_from_md > :first-child {
  margin-top: 0;
}

#zocpcamkld .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zocpcamkld .gt_row {
  padding-top: 3px;
  padding-bottom: 3px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zocpcamkld .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zocpcamkld .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zocpcamkld .gt_row_group_first td {
  border-top-width: 2px;
}

#zocpcamkld .gt_row_group_first th {
  border-top-width: 2px;
}

#zocpcamkld .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zocpcamkld .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zocpcamkld .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zocpcamkld .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zocpcamkld .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zocpcamkld .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zocpcamkld .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zocpcamkld .gt_striped {
  background-color: #D3D3D3;
}

#zocpcamkld .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zocpcamkld .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zocpcamkld .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zocpcamkld .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zocpcamkld .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zocpcamkld .gt_left {
  text-align: left;
}

#zocpcamkld .gt_center {
  text-align: center;
}

#zocpcamkld .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zocpcamkld .gt_font_normal {
  font-weight: normal;
}

#zocpcamkld .gt_font_bold {
  font-weight: bold;
}

#zocpcamkld .gt_font_italic {
  font-style: italic;
}

#zocpcamkld .gt_super {
  font-size: 65%;
}

#zocpcamkld .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zocpcamkld .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zocpcamkld .gt_indent_1 {
  text-indent: 5px;
}

#zocpcamkld .gt_indent_2 {
  text-indent: 10px;
}

#zocpcamkld .gt_indent_3 {
  text-indent: 15px;
}

#zocpcamkld .gt_indent_4 {
  text-indent: 20px;
}

#zocpcamkld .gt_indent_5 {
  text-indent: 25px;
}

#zocpcamkld .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#zocpcamkld div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border">Compact Frequency Table by RefClass, Appliance, and State Average</th>
</tr>
<tr class="gt_col_headings even">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="refClass" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Reference Class</th>
<th id="appliance" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Appliance</th>
<th id="State_Avg" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">State Avg</th>
<th id="Frequency" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Frequency (n)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">CAL</td>
<td class="gt_row gt_left" headers="stub_1_1 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_1 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_1 State_Avg">4601, 4534</td>
<td class="gt_row gt_right" headers="stub_1_1 Frequency">41, 1</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">COL</td>
<td class="gt_row gt_left" headers="stub_1_2 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_2 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_2 State_Avg">5832, 4000</td>
<td class="gt_row gt_right" headers="stub_1_2 Frequency">47, 1</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">COL</td>
<td class="gt_row gt_left" headers="stub_1_3 refClass">kWh</td>
<td class="gt_row gt_left" headers="stub_1_3 appliance">Heating</td>
<td class="gt_row gt_right" headers="stub_1_3 State_Avg">16411, 587</td>
<td class="gt_row gt_right" headers="stub_1_3 Frequency">37, 1</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub gt_striped" data-quarto-table-cell-role="th" scope="row">TEX</td>
<td class="gt_row gt_left" headers="stub_1_4 refClass">USD</td>
<td class="gt_row gt_left" headers="stub_1_4 appliance">Water Heating</td>
<td class="gt_row gt_right" headers="stub_1_4 State_Avg">4396, 400</td>
<td class="gt_row gt_right" headers="stub_1_4 Frequency">51, 1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a mapping between state codes and full state names</span></span>
<span><span class="va">state_code_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"CAL"</span> <span class="op">=</span> <span class="st">"California"</span>,</span>
<span>  <span class="st">"TEX"</span> <span class="op">=</span> <span class="st">"Texas"</span>,</span>
<span>  <span class="st">"COL"</span> <span class="op">=</span> <span class="st">"Colorado"</span>,</span>
<span>  <span class="st">"MASS"</span> <span class="op">=</span> <span class="st">"Massachusetts"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Revised parse_action_plan function</span></span>
<span><span class="va">parse_action_plan</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Extract participant-specific states</span></span>
<span>  <span class="va">participant_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Select action plan columns based on state codes</span></span>
<span>  <span class="va">action_plan_cols</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"^[ADP]\\d+(CAL|MASS|COL|TEX)\\d{2,3}$"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"32$"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Exclude columns ending with '32'</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Pivot longer to reshape data</span></span>
<span>  <span class="va">df_long</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">action_plan_cols</span><span class="op">)</span>,</span>
<span>      names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"modality"</span>, <span class="st">"state_code"</span>, <span class="st">"item_num"</span><span class="op">)</span>,</span>
<span>      names_pattern <span class="op">=</span> <span class="st">"^([ADP])\\d+(CAL|MASS|COL|TEX)(\\d+)$"</span>,</span>
<span>      values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      <span class="co"># Map state codes to full state names</span></span>
<span>      state_full <span class="op">=</span> <span class="va">state_code_map</span><span class="op">[</span><span class="va">state_code</span><span class="op">]</span>,</span>
<span>      <span class="co"># Ensure that the state_full is one of the participant's assigned states</span></span>
<span>      state_assigned <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">state_full</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">participant_states</span>, <span class="va">state_full</span>, <span class="cn">NA_character_</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">state_assigned</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Keep only matching states</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">state1</span>, <span class="va">state2</span>, <span class="va">refClass</span>, <span class="va">calc</span>, <span class="va">edu</span>, <span class="va">modality</span>, <span class="va">state_assigned</span>, <span class="va">item_num</span>, <span class="va">value</span>, <span class="va">id2</span>, <span class="va">Duration__in_seconds_</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># Assign appliance based on item_num</span></span>
<span>  <span class="va">df_long</span> <span class="op">&lt;-</span> <span class="va">df_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      appliance <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"07"</span>,<span class="st">"08"</span>,<span class="st">"09"</span>,<span class="st">"10"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Cooling"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11"</span>,<span class="st">"12"</span>,<span class="st">"13"</span>,<span class="st">"14"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Heating"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"15"</span>,<span class="st">"16"</span>,<span class="st">"17"</span>,<span class="st">"18"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Water Heating"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"19"</span>,<span class="st">"20"</span>,<span class="st">"21"</span>,<span class="st">"22"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Refrigerator"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"23"</span>,<span class="st">"24"</span>,<span class="st">"25"</span>,<span class="st">"26"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Other Appliance"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"27"</span>,<span class="st">"28"</span>,<span class="st">"29"</span>,<span class="st">"30"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Total kWh"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op">==</span> <span class="st">"31"</span> <span class="op">~</span> <span class="st">"Preferred Plan"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"33"</span>,<span class="st">"34"</span>,<span class="st">"35"</span>,<span class="st">"36"</span>,<span class="st">"37"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Reduction Choices"</span>,</span>
<span>        <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="co"># Assign item_type based on item_num</span></span>
<span>      item_type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"07"</span>,<span class="st">"11"</span>,<span class="st">"15"</span>,<span class="st">"19"</span>,<span class="st">"23"</span>,<span class="st">"27"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"family"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"08"</span>,<span class="st">"12"</span>,<span class="st">"16"</span>,<span class="st">"20"</span>,<span class="st">"24"</span>,<span class="st">"28"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"state_avg"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"09"</span>,<span class="st">"13"</span>,<span class="st">"17"</span>,<span class="st">"21"</span>,<span class="st">"25"</span>,<span class="st">"29"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"plan1"</span>,</span>
<span>        <span class="va">item_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"10"</span>,<span class="st">"14"</span>,<span class="st">"18"</span>,<span class="st">"22"</span>,<span class="st">"26"</span>,<span class="st">"30"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"plan2"</span>,</span>
<span>        <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Continue processing only relevant item_types</span></span>
<span>  <span class="va">df_long</span> <span class="op">&lt;-</span> <span class="va">df_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">item_type</span> <span class="op">!=</span> <span class="st">"other"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">item_num</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"item_type"</span>, values_from <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plan1"</span>, <span class="st">"plan2"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"plan"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df_long</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Read and preprocess the raw data</span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    state1 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Colorado</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Colorado"</span>,</span>
<span>      <span class="va">Massachusetts</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Massachusetts"</span>,</span>
<span>      <span class="va">California</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"California"</span>,</span>
<span>      <span class="va">Texas</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Texas"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span>,</span>
<span>    state2 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Colorado</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Colorado"</span>,</span>
<span>      <span class="va">Massachusetts</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Massachusetts"</span>,</span>
<span>      <span class="va">California</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"California"</span>,</span>
<span>      <span class="va">Texas</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Texas"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span>,</span>
<span>    refClass <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">ReferenceClass</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"USD"</span>,</span>
<span>      <span class="va">ReferenceClass</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"kWh"</span>,</span>
<span>      <span class="va">ReferenceClass</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Percentage"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span>,</span>
<span>    calc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">MATH01</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">MATH01</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>id2 <span class="op">=</span> <span class="va">ResponseId</span>, edu <span class="op">=</span> <span class="va">DEM04</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    edu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Some schooling, but no diploma or degree"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Highschool diploma or GED"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Some college"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">~</span> <span class="st">"College degree"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"Some graduate school"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">6</span> <span class="op">~</span> <span class="st">"Graduate degree"</span>,</span>
<span>      <span class="va">edu</span> <span class="op">==</span> <span class="fl">7</span> <span class="op">~</span> <span class="st">"Choose not to answer"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">edu</span>, <span class="va">refClass</span>, <span class="va">state1</span>, <span class="va">state2</span>, <span class="va">calc</span>, .after <span class="op">=</span> <span class="va">id2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to trim NA and empty columns</span></span>
<span><span class="va">trim_na_and_empty_columns</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="op">~</span> <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"AIND"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a list of trimmed datasets for each unique ID</span></span>
<span><span class="va">dAll</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">trim_na_and_empty_columns</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">s1</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply the revised parse_action_plan function to all participants</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">dAll</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">parse_action_plan</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine all parsed data</span></span>
<span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Handle specific data corrections (e.g., participant "R_1kFwgoKAmNTwCs3")</span></span>
<span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">id2</span> <span class="op">==</span> <span class="st">"R_1kFwgoKAmNTwCs3"</span> <span class="op">&amp;</span> <span class="va">state_assigned</span> <span class="op">==</span> <span class="st">"Texas"</span> <span class="op">&amp;</span> <span class="va">appliance</span> <span class="op">==</span> <span class="st">"Heating"</span>, <span class="fl">6118</span>, <span class="va">family</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Final mutations and calculations</span></span>
<span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    change <span class="op">=</span> <span class="va">value</span> <span class="op">-</span> <span class="va">family</span>,</span>
<span>    state_p_dif <span class="op">=</span> <span class="va">value</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>    state_f_dif <span class="op">=</span> <span class="va">family</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>    less_avg <span class="op">=</span> <span class="va">value</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,</span>
<span>    calc <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">calc</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"No Calculator"</span>, <span class="st">"Used Calculator"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s1_processed</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state_assigned</span>,<span class="va">appliance</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_distinct_family<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>            n_distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>, </span>
<span>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span>            distinct_family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>,</span>
<span>            distinct_state_avg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_distinct_family</span><span class="op">&gt;</span><span class="fl">1</span> <span class="op">|</span> <span class="va">n_distinct_state_avg</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Convert family and state_avg to numeric</span></span>
<span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    family_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    state_avg_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify discrepancies and include participant IDs</span></span>
<span><span class="va">duplicate_checks</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state_assigned</span>, <span class="va">appliance</span>, <span class="va">refClass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n_unique_family <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">family_value</span><span class="op">)</span>,</span>
<span>    n_unique_state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">state_avg_value</span><span class="op">)</span>,</span>
<span>    families <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">family_value</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    state_avgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">state_avg_value</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    participant_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">family_value</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">state_avg_value</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">'drop'</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_unique_family</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">n_unique_state_avg</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">duplicate_checks</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Found inconsistencies in family or state_avg values:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">duplicate_checks</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"No inconsistencies found in family or state_avg values.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s1_processed</span> <span class="op">&lt;-</span> <span class="va">s1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state_assigned<span class="op">=</span><span class="va">state</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">s1_check</span> <span class="op">&lt;-</span> <span class="va">s1_processed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    family_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>,</span>
<span>    state_avg_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_avg</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">id2</span>, <span class="va">state_assigned</span>, <span class="va">appliance</span>, <span class="va">family_value</span>, <span class="va">state_avg_value</span>, <span class="va">refClass</span>,<span class="va">state</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Rename columns in correct_values</span></span>
<span><span class="va">correct_values</span> <span class="op">&lt;-</span> <span class="va">correct_values</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>    family_correct <span class="op">=</span> <span class="va">family</span>,</span>
<span>    state_avg_correct <span class="op">=</span> <span class="va">state_avg</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Join participant data with correct values</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">s1_check</span>, <span class="va">correct_values</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"appliance"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute differences between participant values and correct values</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="va">comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    family_diff <span class="op">=</span> <span class="va">family_value</span> <span class="op">-</span> <span class="va">family_correct</span>,</span>
<span>    state_avg_diff <span class="op">=</span> <span class="va">state_avg_value</span> <span class="op">-</span> <span class="va">state_avg_correct</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify discrepancies</span></span>
<span><span class="va">discrepancies</span> <span class="op">&lt;-</span> <span class="va">comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">family_diff</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">state_avg_diff</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">discrepancies</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Participants with discrepancies in family or state_avg values:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span></span>
<span>    <span class="va">discrepancies</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>        <span class="va">id</span>,</span>
<span>        <span class="va">id2</span>,</span>
<span>        <span class="va">state</span>,</span>
<span>        <span class="va">appliance</span>,</span>
<span>        <span class="va">refClass</span>,</span>
<span>        <span class="va">family_value</span>,</span>
<span>        <span class="va">family_correct</span>,</span>
<span>        <span class="va">family_diff</span>,</span>
<span>        <span class="va">state_avg_value</span>,</span>
<span>        <span class="va">state_avg_correct</span>,</span>
<span>        <span class="va">state_avg_diff</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"No discrepancies found between participant values and correct values.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>No discrepancies found between participant values and correct values.</code></pre>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to inspect a participant's data</span></span>
<span><span class="va">inspect_participant</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">participant_id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">participant_data</span> <span class="op">&lt;-</span> <span class="va">comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">participant_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>      <span class="va">id</span>,</span>
<span>      <span class="va">id2</span>,</span>
<span>      <span class="va">state</span>,</span>
<span>      <span class="va">appliance</span>,</span>
<span>      <span class="va">refClass</span>,</span>
<span>        <span class="va">family_value</span>,</span>
<span>        <span class="va">family_correct</span>,</span>
<span>        <span class="va">family_diff</span>,</span>
<span>        <span class="va">state_avg_value</span>,</span>
<span>        <span class="va">state_avg_correct</span>,</span>
<span>        <span class="va">state_avg_diff</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">participant_data</span>, n<span class="op">=</span><span class="fl">24</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example usage:</span></span>
<span><span class="fu">inspect_participant</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>   <span class="co"># Replace with the participant ID you want to investigate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 11
# Groups:   id [1]
      id id2    state appliance refClass family_value family_correct family_diff
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;
 1     1 R_2QM… COL   Cooling   Percent…       697                NA          NA
 2     1 R_2QM… COL   Cooling   Percent…       697                NA          NA
 3     1 R_2QM… COL   Heating   Percent…     18052                NA          NA
 4     1 R_2QM… COL   Heating   Percent…     18052                NA          NA
 5     1 R_2QM… COL   Water He… Percent…     11667                NA          NA
 6     1 R_2QM… COL   Water He… Percent…     11667                NA          NA
 7     1 R_2QM… COL   Refriger… Percent…      1370                NA          NA
 8     1 R_2QM… COL   Refriger… Percent…      1370                NA          NA
 9     1 R_2QM… COL   Other Ap… Percent…      7982                NA          NA
10     1 R_2QM… COL   Other Ap… Percent…      7982                NA          NA
11     1 R_2QM… COL   Total kWh Percent…     39768                NA          NA
12     1 R_2QM… COL   Total kWh Percent…     39768                NA          NA
13     1 R_2QM… TEX   Cooling   Percent…      6573                NA          NA
14     1 R_2QM… TEX   Cooling   Percent…      6573                NA          NA
15     1 R_2QM… TEX   Heating   Percent…      6118                NA          NA
16     1 R_2QM… TEX   Heating   Percent…      6118                NA          NA
17     1 R_2QM… TEX   Water He… Percent…         5.26             NA          NA
18     1 R_2QM… TEX   Water He… Percent…         5.26             NA          NA
19     1 R_2QM… TEX   Refriger… Percent…      2639                NA          NA
20     1 R_2QM… TEX   Refriger… Percent…      2639                NA          NA
21     1 R_2QM… TEX   Other Ap… Percent…      8459                NA          NA
22     1 R_2QM… TEX   Other Ap… Percent…      8459                NA          NA
23     1 R_2QM… TEX   Total kWh Percent…     29046                NA          NA
24     1 R_2QM… TEX   Total kWh Percent…     29046                NA          NA
# ℹ 3 more variables: state_avg_value &lt;dbl&gt;, state_avg_correct &lt;dbl&gt;,
#   state_avg_diff &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">inspect_participant</span><span class="op">(</span><span class="fl">11</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 11
# Groups:   id [1]
      id id2    state appliance refClass family_value family_correct family_diff
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;
 1    11 R_263… CAL   Cooling   kWh              2581             NA          NA
 2    11 R_263… CAL   Cooling   kWh              2581             NA          NA
 3    11 R_263… CAL   Heating   kWh              6157             NA          NA
 4    11 R_263… CAL   Heating   kWh              6157             NA          NA
 5    11 R_263… CAL   Water He… kWh              5061             NA          NA
 6    11 R_263… CAL   Water He… kWh              5061             NA          NA
 7    11 R_263… CAL   Refriger… kWh              1266             NA          NA
 8    11 R_263… CAL   Refriger… kWh              1266             NA          NA
 9    11 R_263… CAL   Other Ap… kWh              7608             NA          NA
10    11 R_263… CAL   Other Ap… kWh              7608             NA          NA
11    11 R_263… CAL   Total kWh kWh             22673             NA          NA
12    11 R_263… CAL   Total kWh kWh             22673             NA          NA
13    11 R_263… COL   Cooling   kWh               697             NA          NA
14    11 R_263… COL   Cooling   kWh               697             NA          NA
15    11 R_263… COL   Heating   kWh               340             NA          NA
16    11 R_263… COL   Heating   kWh               340             NA          NA
17    11 R_263… COL   Water He… kWh             11667             NA          NA
18    11 R_263… COL   Water He… kWh             11667             NA          NA
19    11 R_263… COL   Refriger… kWh              5600             NA          NA
20    11 R_263… COL   Refriger… kWh              5600             NA          NA
21    11 R_263… COL   Other Ap… kWh              7982             NA          NA
22    11 R_263… COL   Other Ap… kWh              7982             NA          NA
23    11 R_263… COL   Total kWh kWh              1500             NA          NA
24    11 R_263… COL   Total kWh kWh              1500             NA          NA
# ℹ 3 more variables: state_avg_value &lt;dbl&gt;, state_avg_correct &lt;dbl&gt;,
#   state_avg_diff &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">correct_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">state</span>, <span class="op">~</span><span class="va">appliance</span>, <span class="op">~</span><span class="va">family</span>, <span class="op">~</span><span class="va">state_avg</span>,</span>
<span>  <span class="co"># Texas values</span></span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Cooling"</span>, <span class="fl">6573</span>, <span class="fl">4249</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Heating"</span>, <span class="fl">6118</span>, <span class="fl">5099</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span>, <span class="fl">5257</span>, <span class="fl">4396</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">2639</span>, <span class="fl">1318</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">8459</span>, <span class="fl">7883</span>,</span>
<span>  <span class="st">"Texas"</span>, <span class="st">"Total kWh"</span>, <span class="fl">29046</span>, <span class="fl">22945</span>,</span>
<span>  </span>
<span>  <span class="co"># California values</span></span>
<span>  <span class="st">"California"</span>, <span class="st">"Cooling"</span>, <span class="fl">2581</span>, <span class="fl">1289</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Heating"</span>, <span class="fl">6157</span>, <span class="fl">5597</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Water Heating"</span>, <span class="fl">5061</span>, <span class="fl">4601</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1266</span>, <span class="fl">1055</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7608</span>, <span class="fl">6916</span>,</span>
<span>  <span class="st">"California"</span>, <span class="st">"Total kWh"</span>, <span class="fl">22673</span>, <span class="fl">19458</span>,</span>
<span>  </span>
<span>  <span class="co"># Colorado values</span></span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Cooling"</span>, <span class="fl">697</span>, <span class="fl">498</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Heating"</span>, <span class="fl">18052</span>, <span class="fl">16411</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Water Heating"</span>, <span class="fl">11667</span>, <span class="fl">5832</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1370</span>, <span class="fl">1142</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7882</span>, <span class="fl">6652</span>,</span>
<span>  <span class="st">"Colorado"</span>, <span class="st">"Total kWh"</span>, <span class="fl">39768</span>, <span class="fl">30535</span>,</span>
<span>  </span>
<span>  <span class="co"># Massachusetts values</span></span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Cooling"</span>, <span class="fl">419</span>, <span class="fl">322</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Heating"</span>, <span class="fl">26751</span>, <span class="fl">19108</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Water Heating"</span>, <span class="fl">10543</span>, <span class="fl">5070</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Refrigerator"</span>, <span class="fl">1230</span>, <span class="fl">1025</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Other Appliance"</span>, <span class="fl">7350</span>, <span class="fl">6682</span>,</span>
<span>  <span class="st">"Massachusetts"</span>, <span class="st">"Total kWh"</span>, <span class="fl">46293</span>, <span class="fl">32207</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Display code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to inspect raw data for a specific participant and state</span></span>
<span><span class="va">inspect_raw_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">response_id</span>, <span class="va">state_code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get participant's raw data</span></span>
<span>  <span class="va">participant_data</span> <span class="op">&lt;-</span> <span class="va">raw_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ResponseId</span> <span class="op">==</span> <span class="va">response_id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get relevant columns for the state</span></span>
<span>  <span class="va">relevant_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span>, </span>
<span>                                                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"^[ADP]\\d+"</span>, <span class="va">state_code</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create a mapping for item numbers to appliance types</span></span>
<span>  <span class="va">appliance_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">item_nums</span>, <span class="op">~</span><span class="va">appliance</span>,</span>
<span>    <span class="st">"07|08"</span>, <span class="st">"Cooling"</span>,</span>
<span>    <span class="st">"11|12"</span>, <span class="st">"Heating"</span>,</span>
<span>    <span class="st">"15|16"</span>, <span class="st">"Water Heating"</span>,</span>
<span>    <span class="st">"19|20"</span>, <span class="st">"Refrigerator"</span>,</span>
<span>    <span class="st">"23|24"</span>, <span class="st">"Other Appliance"</span>,</span>
<span>    <span class="st">"27|28"</span>, <span class="st">"Total kWh"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract and organize values</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">appliance_map</span><span class="op">$</span><span class="va">item_nums</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nums</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cols</span> <span class="op">&lt;-</span> <span class="va">relevant_cols</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">relevant_cols</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="va">nums</span>, <span class="st">")$"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">values</span> <span class="op">&lt;-</span> <span class="va">participant_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>      column <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span>,</span>
<span>      appliance <span class="op">=</span> <span class="va">appliance_map</span><span class="op">$</span><span class="va">appliance</span><span class="op">[</span><span class="va">appliance_map</span><span class="op">$</span><span class="va">item_nums</span> <span class="op">==</span> <span class="va">nums</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Let's check participant 1's Texas Water Heating issue</span></span>
<span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">read_sav</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check Participant 1 (R_2QMsYuHS385pTj1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Participant 1 - Texas Water Heating Values:"</span><span class="op">)</span></span>
<span><span class="va">p1_tex</span> <span class="op">&lt;-</span> <span class="fu">inspect_raw_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"TEX"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p1_tex</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="st">"Water"</span><span class="op">)</span><span class="op">)</span>,n<span class="op">=</span><span class="fl">24</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Check Participant 11 (R_263zmNZDB4Pqn9h)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"\nParticipant 11 - Colorado Heating Values:"</span><span class="op">)</span></span>
<span><span class="va">p11_col</span> <span class="op">&lt;-</span> <span class="fu">inspect_raw_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="st">"R_263zmNZDB4Pqn9h"</span>, <span class="st">"COL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p11_col</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">appliance</span>, <span class="st">"Heating"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to compare raw vs processed values</span></span>
<span><span class="va">compare_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">processed_data</span>, <span class="va">response_id</span>, <span class="va">state</span>, <span class="va">appliance_type</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get raw values</span></span>
<span>  <span class="va">raw_vals</span> <span class="op">&lt;-</span> <span class="fu">inspect_raw_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">response_id</span>, </span>
<span>                                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>                                  <span class="va">state</span> <span class="op">==</span> <span class="st">"Texas"</span> <span class="op">~</span> <span class="st">"TEX"</span>,</span>
<span>                                  <span class="va">state</span> <span class="op">==</span> <span class="st">"Colorado"</span> <span class="op">~</span> <span class="st">"COL"</span>,</span>
<span>                                  <span class="va">state</span> <span class="op">==</span> <span class="st">"California"</span> <span class="op">~</span> <span class="st">"CAL"</span>,</span>
<span>                                  <span class="va">state</span> <span class="op">==</span> <span class="st">"Massachusetts"</span> <span class="op">~</span> <span class="st">"MASS"</span></span>
<span>                                <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">appliance</span> <span class="op">==</span> <span class="va">appliance_type</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get processed values</span></span>
<span>  <span class="va">proc_vals</span> <span class="op">&lt;-</span> <span class="va">processed_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id2</span> <span class="op">==</span> <span class="va">response_id</span>, </span>
<span>           <span class="va">state</span> <span class="op">==</span> <span class="op">!</span><span class="op">!</span><span class="va">state</span>,</span>
<span>           <span class="va">appliance</span> <span class="op">==</span> <span class="va">appliance_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">family</span>, <span class="va">state_avg_value</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Compare</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="st">"Raw Data"</span>,</span>
<span>    family <span class="op">=</span> <span class="va">raw_vals</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">raw_vals</span><span class="op">$</span><span class="va">column</span>, <span class="st">"07$|11$|15$|19$|23$|27$"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    state_avg <span class="op">=</span> <span class="va">raw_vals</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">raw_vals</span><span class="op">$</span><span class="va">column</span>, <span class="st">"08$|12$|16$|20$|24$|28$"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>        source <span class="op">=</span> <span class="st">"Processed Data"</span>,</span>
<span>        family <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">proc_vals</span><span class="op">$</span><span class="va">family</span><span class="op">)</span>,</span>
<span>        state_avg <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">proc_vals</span><span class="op">$</span><span class="va">state_avg_value</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example comparisons</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"\nComparison for Participant 1 - Texas Water Heating:"</span><span class="op">)</span></span>
<span><span class="fu">compare_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">s1_processed</span>, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">raw_data</span><span class="op">$</span><span class="va">P3TEX15</span><span class="op">)</span></span>
<span><span class="va">s1_processed</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state2</span><span class="op">==</span><span class="st">"Texas"</span>,<span class="va">appliance</span><span class="op">==</span><span class="st">"Water Heating"</span>,<span class="va">state_assigned</span><span class="op">==</span><span class="st">"Texas"</span>,<span class="va">plan</span><span class="op">==</span><span class="st">"plan1"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"\nComparison for Participant 11 - Colorado Heating:"</span><span class="op">)</span></span>
<span><span class="fu">compare_values</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">s1_processed</span>, <span class="st">"R_263zmNZDB4Pqn9h"</span>, <span class="st">"Colorado"</span>, <span class="st">"Heating"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check if the discrepancy is consistent across different blocks/presentations</span></span>
<span><span class="va">check_all_presentations</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw_data</span>, <span class="va">response_id</span>, <span class="va">state_code</span>, <span class="va">appliance_pattern</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">participant_data</span> <span class="op">&lt;-</span> <span class="va">raw_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ResponseId</span> <span class="op">==</span> <span class="va">response_id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">all_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span>, </span>
<span>                                               <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"^[ADP]\\d+"</span>, <span class="va">state_code</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                                      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">participant_data</span><span class="op">)</span>, <span class="va">appliance_pattern</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">participant_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">all_cols</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"column"</span>, value <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">column</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example: Check all presentations of water heating for participant 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"\nAll presentations of water heating for Participant 1:"</span><span class="op">)</span></span>
<span><span class="fu">check_all_presentations</span><span class="op">(</span><span class="va">raw_data</span>, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"TEX"</span>, <span class="st">"15|16"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">raw_data</span><span class="op">$</span><span class="va">P3TEX15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="just-refclass-percentage-and-state-2-texas-have-the-issues-with-family-water-heating-5.26" class="level2"><h2 class="anchored" data-anchor-id="just-refclass-percentage-and-state-2-texas-have-the-issues-with-family-water-heating-5.26">Just refClass Percentage and state 2 Texas have the issues with family water heating = 5.26</h2>
<p>r$&gt; s1_processed |&gt; filter(state2==“Texas”,appliance==“Water Heating”,state_assigned==“Texas”,plan==“plan1”) |&gt; head(15) # A tibble: 15 × 17 id state1 state2 refClass calc edu modality state_assigned id2 Duration_<em>in_seconds</em> appliance family state_avg plan value family_value state_avg_value <int><chr><chr><chr><fct><fct><chr><chr><chr><dbl><chr> &lt;dbl+lbl&gt; &lt;dbl+lbl&gt; <chr> &lt;dbl+lbl&gt; <dbl><dbl> 1 1 Colorado Texas Percentage 1 Graduate degree P Texas R_2QMsYuHS385pTj1 1008 Water Heating 5.26 4396 plan1 700 5.26 4396 2 2 Colorado Texas Percentage 1 College degree P Texas R_2tzIyZavpl1RZBY 1126 Water Heating 5.26 4396 plan1 4396 5.26 4396 3 3 Colorado Texas Percentage 1 College degree P Texas R_3Gm1Y4QzSlyrEWo 870 Water Heating 5.26 4396 plan1 4468 5.26 4396 4 4 Colorado Texas Percentage 1 College degree P Texas R_Djh2q728ibyNWjD 2763 Water Heating 5.26 4396 plan1 1000 5.26 4396 5 5 Colorado Texas Percentage 0 Graduate degree P Texas R_3fAXNbIZ7kFieSu 920 Water Heating 5.26 4396 plan1 3756 5.26 4396 6 6 Colorado Texas Percentage 0 Graduate degree P Texas R_1JECzl10KgckJXg 878 Water Heating 5.26 4396 plan1 5200 5.26 4396 7 7 Colorado Texas Percentage 1 Graduate degree P Texas R_C2IQAZim25sij4d 2680 Water Heating 5.26 4396 plan1 4257 5.26 4396 8 8 Colorado Texas Percentage 1 Some college P Texas R_5bbi3tpMOhuGBIR 1628 Water Heating 5.26 4396 plan1 5100 5.26 4396 9 9 Colorado Texas Percentage 1 Graduate degree P Texas R_2BsVSAOpehXW9Cr 724 Water Heating 5.26 4396 plan1 5217 5.26 4396 10 10 Colorado Texas Percentage 1 Some college P Texas R_325F8wRln52w1QN 913 Water Heating 5.26 4396 plan1 4468 5.26 4396 11 12 Colorado Texas kWh 1 Graduate degree A Texas R_abEpO6g4xKOlwwF 644 Water Heating 5257 4396 plan1 8459 5257 4396 12 14 Colorado Texas USD 0 College degree D Texas R_2VsaxwvgHXasQx3 625 Water Heating 5257 400 plan1 4000 5257 400 13 24 Massachusetts Texas USD 1 College degree D Texas R_AEvC2EEL0GltodP 1047 Water Heating 5257 4396 plan1 4000 5257 4396 14 36 Colorado Texas USD 0 Graduate degree D Texas R_1nO7uu36tUOSbfw 390 Water Heating 5257 4396 plan1 4500 5257 4396 15 38 Massachusetts Texas kWh 1 College degree A Texas R_6f13I34krdFacjT 973 Water Heating 5257 4396 plan1 4500 5257 4396</dbl></dbl></chr></chr></dbl></chr></chr></chr></fct></fct></chr></chr></chr></int></p>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/tegorman13\.github\.io\/Representation_Study\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-page-right"><div class="nav-page nav-page-previous">
      <a href="../results.html" class="pagination-link" aria-label="Results">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Results</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../study_stim.html" class="pagination-link" aria-label="Design and Stimulii">
        <span class="nav-page-text">Design and Stimulii</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Outliers and discrepancies"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">- name: Thomas E. Gorman</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://tegorman13.github.io/</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">  affiliations: </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - name:  Communication and Cognition Lab, Purdue University, USA</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation-url: https://web.ics.purdue.edu/~treimer/</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> true</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> false</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> true</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">  #echo: false</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">    grid:</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">      sidebar-width: 220px</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">      body-width: 1200px</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">      margin-width: 170px</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co">      gutter-width: 1.0rem</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co">  # hugo-md:</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co">  #   include: true</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="co">  #   html-math-method: mathjax</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co">  #   output-file: results_hugo.md</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co">  # gfm:</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co">  #   echo: true</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="co">  #   output-file: results_gfm.md</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(dplyr,purrr,tidyr,here, haven,tibble,ggplot2,gt,ggh4x,lme4,flextable,ggdist)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/s1_processed.rds"</span>))</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>s2_long <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/s2_processed.rds"</span>))</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>s1_agg <span class="ot">&lt;-</span> s1 <span class="sc">|&gt;</span> </span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance <span class="sc">!=</span><span class="st">"Total kWh"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id,refClass,state,block,plan,calc,edu,pct_goal) <span class="sc">|&gt;</span> </span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_kWh =</span> <span class="fu">sum</span>(value),<span class="at">orig_kWh=</span><span class="fu">sum</span>(family), </span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_change =</span> <span class="fu">round</span>((orig_kWh<span class="sc">-</span>total_kWh)<span class="sc">/</span>orig_kWh,<span class="dv">3</span>), </span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_change =</span> <span class="fu">sum</span>(value<span class="sc">!=</span>family),</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">state_p_dif=</span><span class="fu">mean</span>(state_p_dif),</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">state_f_dif=</span><span class="fu">mean</span>(state_f_dif),</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_less_avg =</span> <span class="fu">sum</span>(less_avg),</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">duration=</span><span class="fu">first</span>(Duration__in_seconds_)) <span class="sc">|&gt;</span> </span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">matched_goal =</span> (pct_change <span class="sc">==</span> pct_goal), </span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>             <span class="at">error =</span> pct_change <span class="sc">-</span> pct_goal,</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">abs_error =</span> <span class="fu">abs</span>(error))</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a><span class="co"># s1_agg |&gt; filter(matched_goal==FALSE, abs_error&lt;.02) |&gt; pull(abs_error)</span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>s1_agg4 <span class="ot">&lt;-</span> s1_agg <span class="sc">|&gt;</span> <span class="fu">group_by</span>(id,refClass) <span class="sc">|&gt;</span> </span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mg=</span><span class="fu">sum</span>(matched_goal),<span class="at">n=</span><span class="fu">n</span>(), <span class="at">pct=</span>mg<span class="sc">/</span>n) </span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>s1_agg2 <span class="ot">&lt;-</span> s1_agg <span class="sc">|&gt;</span> <span class="fu">group_by</span>(id,refClass,state) <span class="sc">|&gt;</span> </span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mg=</span><span class="fu">sum</span>(matched_goal),<span class="at">n=</span><span class="fu">n</span>(), <span class="at">pct=</span>mg<span class="sc">/</span>n) </span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> s1_agg <span class="sc">|&gt;</span>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">change_mean=</span><span class="fu">mean</span>(pct_change,<span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="at">change_sd=</span><span class="fu">sd</span>(pct_change,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">z_score=</span>(pct_change<span class="sc">-</span>change_mean)<span class="sc">/</span>change_sd,</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">is_outlier=</span><span class="fu">abs</span>(z_score)<span class="sc">&gt;</span><span class="fl">3.0</span>)</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>outlier_id <span class="ot">&lt;-</span> outliers <span class="sc">|&gt;</span> <span class="fu">filter</span>(is_outlier) <span class="sc">|&gt;</span> <span class="fu">pull</span>(id) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a><span class="co"># quick summary of s1$Duration_in_seconds variable</span></span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(s1<span class="sc">$</span>Duration__in_seconds_)</span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   176     846    1184    1659    1688   47914 </span></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(refClass) <span class="sc">|&gt;</span> </span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(Duration__in_seconds_),<span class="fu">sd</span>(Duration__in_seconds_),<span class="fu">median</span>(Duration__in_seconds_))</span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Duration__in_seconds_)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>refClass)</span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">id=</span><span class="fu">reorder</span>(id,Duration__in_seconds_)) <span class="sc">|&gt;</span> </span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>id,<span class="at">x=</span>Duration__in_seconds_)) <span class="sc">+</span> </span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">1</span>,<span class="at">alpha=</span><span class="fl">0.6</span>,<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">w=</span><span class="dv">0</span>, <span class="at">h=</span><span class="fl">0.17</span>)) <span class="sc">+</span></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_nested_wrap</span>(<span class="sc">~</span>refClass,<span class="at">axes=</span><span class="st">"all"</span>,<span class="at">scales=</span><span class="st">"free"</span>,<span class="at">ncol=</span><span class="dv">2</span>)  </span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>s1_agg <span class="sc">|&gt;</span> <span class="fu">filter</span>(duration<span class="sc">&lt;</span><span class="dv">10000</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>duration,<span class="at">y=</span>abs_error)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>refClass)</span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a>s1_agg <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>duration)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>refClass) <span class="sc">+</span> <span class="fu">stat_halfeye</span>()</span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="st">"s2_10"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>)</span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">unique</span>(s2_long<span class="sc">$</span>id)[<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance<span class="sc">!=</span><span class="st">"TOTAL"</span>,state<span class="sc">==</span><span class="st">"California"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>appliance,<span class="at">y=</span>value)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape=</span>plan)) <span class="sc">+</span></span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>state_avg),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>family),<span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>id) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> </span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance<span class="sc">!=</span><span class="st">"TOTAL"</span>,state<span class="sc">==</span><span class="st">"California"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>appliance,<span class="at">y=</span>family)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>rounded)</span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> </span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance<span class="sc">!=</span><span class="st">"TOTAL"</span>,state<span class="sc">==</span><span class="st">"California"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance,family,rounded) <span class="sc">|&gt;</span> </span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># counts for each distinct value</span></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) </span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> </span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance<span class="sc">!=</span><span class="st">"TOTAL"</span>,state<span class="sc">==</span><span class="st">"California"</span>,plan<span class="sc">==</span><span class="st">"plan1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance,family,rounded) <span class="sc">|&gt;</span> </span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>appliance,<span class="at">y=</span>family)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>n,<span class="at">alpha=</span>.<span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>n),<span class="at">vjust=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>rounded)</span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> </span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance<span class="sc">!=</span><span class="st">"TOTAL"</span>,plan<span class="sc">==</span><span class="st">"plan1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance,family,rounded,state) <span class="sc">|&gt;</span> </span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>appliance,<span class="at">y=</span>family)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>n,<span class="at">alpha=</span>.<span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>n),<span class="at">vjust=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(state<span class="sc">~</span>rounded)</span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a><span class="co"># bar plot version of the above</span></span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> </span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance<span class="sc">!=</span><span class="st">"TOTAL"</span>,state<span class="sc">==</span><span class="st">"California"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance,family,rounded) <span class="sc">|&gt;</span> </span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>appliance,<span class="at">y=</span>family,<span class="at">fill=</span>rounded)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>rounded)</span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">%&gt;%</span></span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance <span class="sc">!=</span> <span class="st">"TOTAL"</span>, plan <span class="sc">==</span> <span class="st">"plan1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, rounded, state) <span class="sc">%&gt;%</span></span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a>    <span class="at">distinct_families =</span> <span class="fu">n_distinct</span>(family),</span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a>    <span class="at">color_flag =</span> distinct_families <span class="sc">&gt;</span> <span class="dv">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span id="cb30-164"><a href="#cb30-164" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Continue grouping for plotting</span></span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, family, rounded, state,color_flag) <span class="sc">%&gt;%</span></span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> appliance, <span class="at">y =</span> family,<span class="at">color =</span> color_flag,<span class="at">fill=</span>color_flag)) <span class="sc">+</span></span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .<span class="dv">1</span>, <span class="at">color =</span> color_flag), <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.15</span>)) <span class="sc">+</span></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.45</span>)) <span class="sc">+</span></span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"blue"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-173"><a href="#cb30-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(state <span class="sc">~</span> rounded,<span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb30-174"><a href="#cb30-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Appliance"</span>,</span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Family Value"</span>,</span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">"Frequency (n)"</span></span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">%&gt;%</span></span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance <span class="sc">!=</span> <span class="st">"TOTAL"</span>, plan <span class="sc">==</span> <span class="st">"plan1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, rounded, state) <span class="sc">%&gt;%</span></span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a>    <span class="at">distinct_families =</span> <span class="fu">n_distinct</span>(state_avg),</span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">color_flag =</span> distinct_families <span class="sc">&gt;</span> <span class="dv">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Continue grouping for plotting</span></span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, state_avg, rounded, state,color_flag) <span class="sc">%&gt;%</span></span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> appliance, <span class="at">y =</span> state_avg,<span class="at">color =</span> color_flag,<span class="at">fill=</span>color_flag)) <span class="sc">+</span></span>
<span id="cb30-193"><a href="#cb30-193" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .<span class="dv">1</span>, <span class="at">color =</span> color_flag), <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.15</span>)) <span class="sc">+</span></span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.15</span>)) <span class="sc">+</span></span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"blue"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(state <span class="sc">~</span> rounded,<span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Appliance"</span>,</span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Family Value"</span>,</span>
<span id="cb30-200"><a href="#cb30-200" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">"Frequency (n)"</span></span>
<span id="cb30-201"><a href="#cb30-201" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span></span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance <span class="sc">!=</span> <span class="st">"Total kWh"</span>, plan <span class="sc">==</span> <span class="st">"plan1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, state,refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a>    <span class="at">distinct_families =</span> <span class="fu">n_distinct</span>(family),</span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">color_flag =</span> distinct_families <span class="sc">&gt;</span> <span class="dv">1</span>  <span class="co"># Flag as TRUE if more than 1 distinct value</span></span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Continue grouping for plotting</span></span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, family, state,color_flag,refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-216"><a href="#cb30-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(color_flag) <span class="sc">|&gt;</span> </span>
<span id="cb30-217"><a href="#cb30-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> appliance, <span class="at">y =</span> family,<span class="at">color =</span> color_flag,<span class="at">fill=</span>color_flag)) <span class="sc">+</span></span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a> <span class="co">#geom_point(aes(alpha = .1, color = color_flag), position = position_jitter(width = 0.15)) +</span></span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.75</span>,<span class="at">height=</span>.<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"blue"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(refClass<span class="sc">~</span>state,<span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Appliance"</span>,</span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Family Value"</span>,</span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">"Frequency (n)"</span></span>
<span id="cb30-226"><a href="#cb30-226" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb30-227"><a href="#cb30-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task data checks</span></span>
<span id="cb30-237"><a href="#cb30-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a><span class="co"># for every combination of state, appliance, and refClass, calculate the number of distinct values of family, and of state_avg</span></span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(state,appliance,refClass) <span class="sc">|&gt;</span> </span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_avg=</span><span class="fu">as.numeric</span>(state_avg)) <span class="sc">|&gt;</span> </span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_distinct_family=</span><span class="fu">n_distinct</span>(family),</span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_distinct_state_avg=</span><span class="fu">n_distinct</span>(state_avg), </span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a>            <span class="at">distinct_family=</span><span class="fu">paste</span>(<span class="fu">unique</span>(family),<span class="at">collapse=</span><span class="st">","</span>),</span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a>            <span class="at">distinct_state_avg=</span><span class="fu">paste</span>(<span class="fu">unique</span>(state_avg),<span class="at">collapse=</span><span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_distinct_family<span class="sc">&gt;</span><span class="dv">1</span> <span class="sc">|</span> n_distinct_state_avg<span class="sc">&gt;</span><span class="dv">1</span>) </span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> <span class="fu">group_by</span>(state,appliance,refClass,rounded) <span class="sc">|&gt;</span> </span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_avg=</span><span class="fu">as.numeric</span>(state_avg)) <span class="sc">|&gt;</span> </span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_distinct_family=</span><span class="fu">n_distinct</span>(family),</span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_distinct_state_avg=</span><span class="fu">n_distinct</span>(state_avg), </span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span id="cb30-262"><a href="#cb30-262" aria-hidden="true" tabindex="-1"></a>            <span class="at">distinct_family=</span><span class="fu">paste</span>(<span class="fu">unique</span>(family),<span class="at">collapse=</span><span class="st">","</span>),</span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a>            <span class="at">distinct_state_avg=</span><span class="fu">paste</span>(<span class="fu">unique</span>(state_avg),<span class="at">collapse=</span><span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_distinct_family<span class="sc">&gt;</span><span class="dv">1</span> <span class="sc">|</span> n_distinct_state_avg<span class="sc">&gt;</span><span class="dv">1</span>) </span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-267"><a href="#cb30-267" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(state,appliance,refClass) <span class="sc">|&gt;</span> </span>
<span id="cb30-268"><a href="#cb30-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_distinct_family=</span><span class="fu">n_distinct</span>(family),</span>
<span id="cb30-269"><a href="#cb30-269" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_distinct_state_avg=</span><span class="fu">n_distinct</span>(state_avg), </span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span id="cb30-271"><a href="#cb30-271" aria-hidden="true" tabindex="-1"></a>            <span class="at">distinct_family=</span><span class="fu">paste</span>(<span class="fu">unique</span>(family),<span class="at">collapse=</span><span class="st">","</span>),</span>
<span id="cb30-272"><a href="#cb30-272" aria-hidden="true" tabindex="-1"></a>            <span class="at">distinct_state_avg=</span><span class="fu">paste</span>(<span class="fu">unique</span>(state_avg),<span class="at">collapse=</span><span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,appliance,refClass,family,state_avg) <span class="sc">|&gt;</span></span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>calc,<span class="sc">-</span>edu,<span class="sc">-</span>modality,<span class="sc">-</span>id2,<span class="sc">-</span>Duration__in_seconds_) <span class="sc">|&gt;</span> </span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(n_distinct_family<span class="sc">&gt;</span><span class="dv">1</span> <span class="sc">|</span> n_distinct_state_avg<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>)</span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">|&gt;</span> </span>
<span id="cb30-279"><a href="#cb30-279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(state, appliance, refClass) <span class="sc">|&gt;</span> </span>
<span id="cb30-280"><a href="#cb30-280" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n_distinct_family =</span> <span class="fu">n_distinct</span>(family),</span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_distinct_state_avg =</span> <span class="fu">n_distinct</span>(state_avg), </span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a>           <span class="at">distinct_family =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(family), <span class="at">collapse =</span> <span class="st">","</span>),</span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a>           <span class="at">distinct_state_avg =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(state_avg), <span class="at">collapse =</span> <span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(n_distinct_family <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> n_distinct_state_avg <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-285"><a href="#cb30-285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(state, appliance, refClass, family, state_avg) <span class="sc">|&gt;</span> </span>
<span id="cb30-286"><a href="#cb30-286" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">state_avg_count =</span> <span class="fu">n_distinct</span>(state_avg),</span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a>           <span class="at">family_count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(state, appliance, refClass, state_avg) <span class="sc">|&gt;</span> </span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">state_avg_count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(state, appliance, refClass, family, state_avg, family_count, state_avg_count) <span class="sc">|&gt;</span> </span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state,appliance,refClass) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-296"><a href="#cb30-296" aria-hidden="true" tabindex="-1"></a>problematic_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"R_1kFwgoKAmNTwCs3"</span>) <span class="co"># Add other IDs as needed</span></span>
<span id="cb30-297"><a href="#cb30-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-298"><a href="#cb30-298" aria-hidden="true" tabindex="-1"></a>raw_subset <span class="ot">&lt;-</span>  haven<span class="sc">::</span><span class="fu">read_sav</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-299"><a href="#cb30-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ResponseId <span class="sc">%in%</span> problematic_ids) <span class="sc">%&gt;%</span></span>
<span id="cb30-300"><a href="#cb30-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ResponseId, <span class="fu">starts_with</span>(<span class="st">"P1"</span>), <span class="fu">starts_with</span>(<span class="st">"P2"</span>), </span>
<span id="cb30-301"><a href="#cb30-301" aria-hidden="true" tabindex="-1"></a>         <span class="fu">starts_with</span>(<span class="st">"P3"</span>), <span class="fu">starts_with</span>(<span class="st">"P4"</span>))</span>
<span id="cb30-302"><a href="#cb30-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-303"><a href="#cb30-303" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(raw_subset)</span>
<span id="cb30-304"><a href="#cb30-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-305"><a href="#cb30-305" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> <span class="fu">filter</span>(state<span class="sc">==</span><span class="st">"Texas"</span>,appliance<span class="sc">==</span><span class="st">"HEAT"</span>, rounded<span class="sc">==</span><span class="st">"Not Rounded"</span>,refClass<span class="sc">==</span><span class="st">"kWh"</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="sc">-</span>family)</span>
<span id="cb30-306"><a href="#cb30-306" aria-hidden="true" tabindex="-1"></a>s2_long <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="st">"s2_10"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>) <span class="co"># no effort</span></span>
<span id="cb30-307"><a href="#cb30-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-308"><a href="#cb30-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-309"><a href="#cb30-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-310"><a href="#cb30-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-311"><a href="#cb30-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-312"><a href="#cb30-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-313"><a href="#cb30-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-314"><a href="#cb30-314" aria-hidden="true" tabindex="-1"></a>r$&gt; s1 |&gt; filter(family==34265) |&gt; select(id,state1,state2,refClass,id2,state,appliance,family,state_avg,plan,value,block,pct_goal)</span>
<span id="cb30-315"><a href="#cb30-315" aria-hidden="true" tabindex="-1"></a><span class="fu"># A tibble: 2 × 13</span></span>
<span id="cb30-316"><a href="#cb30-316" aria-hidden="true" tabindex="-1"></a><span class="fu"># Groups:   id [1]</span></span>
<span id="cb30-317"><a href="#cb30-317" aria-hidden="true" tabindex="-1"></a>     id state1 state2        refClass id2               state appliance     family state_avg plan  value block pct_goal</span>
<span id="cb30-318"><a href="#cb30-318" aria-hidden="true" tabindex="-1"></a>  &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;dbl+lbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span id="cb30-319"><a href="#cb30-319" aria-hidden="true" tabindex="-1"></a>1    16 Texas  Massachusetts USD      R_3gNKA8IQr0uOSh3 TEX   Water Heating  34265 4396      plan1  5486     1     0.15</span>
<span id="cb30-320"><a href="#cb30-320" aria-hidden="true" tabindex="-1"></a>2    16 Texas  Massachusetts USD      R_3gNKA8IQr0uOSh3 TEX   Water Heating  34265 4396      plan2  6414     1     0.15</span>
<span id="cb30-321"><a href="#cb30-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-322"><a href="#cb30-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-323"><a href="#cb30-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-324"><a href="#cb30-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-325"><a href="#cb30-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-326"><a href="#cb30-326" aria-hidden="true" tabindex="-1"></a>s2_long |&gt; group_by(state,appliance,refClass,rounded) |&gt; </span>
<span id="cb30-327"><a href="#cb30-327" aria-hidden="true" tabindex="-1"></a>  mutate(state_avg=as.numeric(state_avg)) |&gt; </span>
<span id="cb30-328"><a href="#cb30-328" aria-hidden="true" tabindex="-1"></a>  summarise(n_distinct_family=n_distinct(family),</span>
<span id="cb30-329"><a href="#cb30-329" aria-hidden="true" tabindex="-1"></a>            n_distinct_state_avg=n_distinct(state_avg), </span>
<span id="cb30-330"><a href="#cb30-330" aria-hidden="true" tabindex="-1"></a>            # paste a string of each distinct value, separated by a comma</span>
<span id="cb30-331"><a href="#cb30-331" aria-hidden="true" tabindex="-1"></a>            distinct_family=paste(unique(family),collapse=","),</span>
<span id="cb30-332"><a href="#cb30-332" aria-hidden="true" tabindex="-1"></a>            distinct_state_avg=paste(unique(state_avg),collapse=",")) |&gt;</span>
<span id="cb30-333"><a href="#cb30-333" aria-hidden="true" tabindex="-1"></a>  filter(n_distinct_family&gt;1 | n_distinct_state_avg&gt;1) </span>
<span id="cb30-334"><a href="#cb30-334" aria-hidden="true" tabindex="-1"></a> # A tibble: 8 × 8</span>
<span id="cb30-335"><a href="#cb30-335" aria-hidden="true" tabindex="-1"></a><span class="fu"># Groups:   state, appliance, refClass [8]</span></span>
<span id="cb30-336"><a href="#cb30-336" aria-hidden="true" tabindex="-1"></a>  state         appliance refClass   rounded     n_distinct_family n_distinct_state_avg distinct_family distinct_state_avg</span>
<span id="cb30-337"><a href="#cb30-337" aria-hidden="true" tabindex="-1"></a>  &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;                   &lt;int&gt;                &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;             </span>
<span id="cb30-338"><a href="#cb30-338" aria-hidden="true" tabindex="-1"></a>1 California    HEAT      kWh        Not Rounded                 2                    1 3000,6157       5597              </span>
<span id="cb30-339"><a href="#cb30-339" aria-hidden="true" tabindex="-1"></a>2 Colorado      HEAT      USD        Rounded                     1                    2 18000           16411,NA          </span>
<span id="cb30-340"><a href="#cb30-340" aria-hidden="true" tabindex="-1"></a>3 Colorado      WATER     Percentage Not Rounded                 1                    2 11667           1142,5832         </span>
<span id="cb30-341"><a href="#cb30-341" aria-hidden="true" tabindex="-1"></a>4 Massachusetts AC        Percentage Rounded                     2                    1 0,1             322               </span>
<span id="cb30-342"><a href="#cb30-342" aria-hidden="true" tabindex="-1"></a>5 Massachusetts AC        USD        Rounded                     2                    1 0,1             322               </span>
<span id="cb30-343"><a href="#cb30-343" aria-hidden="true" tabindex="-1"></a>6 Texas         HEAT      Percentage Not Rounded                 2                    1 6118,5          5099              </span>
<span id="cb30-344"><a href="#cb30-344" aria-hidden="true" tabindex="-1"></a>7 Texas         HEAT      kWh        Not Rounded                 2                    1 8539,6118       5099              </span>
<span id="cb30-345"><a href="#cb30-345" aria-hidden="true" tabindex="-1"></a>8 Texas         WATER     Percentage Not Rounded                 2                    1 5.257,5257      4396     </span>
<span id="cb30-346"><a href="#cb30-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-347"><a href="#cb30-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-348"><a href="#cb30-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-349"><a href="#cb30-349" aria-hidden="true" tabindex="-1"></a>r$&gt; s2_long |&gt; filter(family==3000,state=="California",appliance=="HEAT")</span>
<span id="cb30-350"><a href="#cb30-350" aria-hidden="true" tabindex="-1"></a><span class="fu"># A tibble: 2 × 16</span></span>
<span id="cb30-351"><a href="#cb30-351" aria-hidden="true" tabindex="-1"></a><span class="fu"># Groups:   id, block [1]</span></span>
<span id="cb30-352"><a href="#cb30-352" aria-hidden="true" tabindex="-1"></a>  id    block refClass appliance pct_goal rounded     state      calc          edu            pct family state_avg plan  value change state_dif</span>
<span id="cb30-353"><a href="#cb30-353" aria-hidden="true" tabindex="-1"></a>  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;fct&gt;        &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span>
<span id="cb30-354"><a href="#cb30-354" aria-hidden="true" tabindex="-1"></a>1 s2_11     1 kWh      HEAT      10%      Not Rounded California No Calculator Some college   0.1   3000      5597 plan1  4000   1000     -1597</span>
<span id="cb30-355"><a href="#cb30-355" aria-hidden="true" tabindex="-1"></a>2 s2_11     1 kWh      HEAT      10%      Not Rounded California No Calculator Some college   0.1   3000      5597 plan2  5000   2000      -597</span>
<span id="cb30-356"><a href="#cb30-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-357"><a href="#cb30-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-358"><a href="#cb30-358" aria-hidden="true" tabindex="-1"></a>s2_long |&gt; filter(family==1)</span>
<span id="cb30-359"><a href="#cb30-359" aria-hidden="true" tabindex="-1"></a>  id    block refClass   appliance pct_goal rounded state         calc          edu              pct family state_avg plan  value change state_dif</span>
<span id="cb30-360"><a href="#cb30-360" aria-hidden="true" tabindex="-1"></a>  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;         &lt;fct&gt;          &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span>
<span id="cb30-361"><a href="#cb30-361" aria-hidden="true" tabindex="-1"></a>1 s2_8      1 Percentage AC        15%      Rounded Massachusetts Calculator    College degree  0.15      1       322 plan1     1      0      -321</span>
<span id="cb30-362"><a href="#cb30-362" aria-hidden="true" tabindex="-1"></a>2 s2_8      1 Percentage AC        15%      Rounded Massachusetts Calculator    College degree  0.15      1       322 plan2     1      0      -321</span>
<span id="cb30-363"><a href="#cb30-363" aria-hidden="true" tabindex="-1"></a>3 s2_9      2 USD        AC        10%      Rounded Massachusetts No Calculator College degree  0.1       1       322 plan1     1      0      -321</span>
<span id="cb30-364"><a href="#cb30-364" aria-hidden="true" tabindex="-1"></a>4 s2_9      2 USD        AC        10%      Rounded Massachusetts No Calculator College degree  0.1       1       322 plan2     1      0      -321</span>
<span id="cb30-365"><a href="#cb30-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-366"><a href="#cb30-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-367"><a href="#cb30-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-368"><a href="#cb30-368" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wells Family 15 R and Smith Family 10 E Percentage - 5.257 for Texas water heating</span></span>
<span id="cb30-369"><a href="#cb30-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-370"><a href="#cb30-370" aria-hidden="true" tabindex="-1"></a> s2_long |&gt; filter(family==5.257)</span>
<span id="cb30-371"><a href="#cb30-371" aria-hidden="true" tabindex="-1"></a><span class="fu"># A tibble: 8 × 16</span></span>
<span id="cb30-372"><a href="#cb30-372" aria-hidden="true" tabindex="-1"></a><span class="fu"># Groups:   id, block [4]</span></span>
<span id="cb30-373"><a href="#cb30-373" aria-hidden="true" tabindex="-1"></a>  id    block refClass   appliance pct_goal rounded     state calc          edu               pct family state_avg plan  value change state_dif</span>
<span id="cb30-374"><a href="#cb30-374" aria-hidden="true" tabindex="-1"></a>  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;           &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span>
<span id="cb30-375"><a href="#cb30-375" aria-hidden="true" tabindex="-1"></a>1 s2_1      2 Percentage WATER     10%      Not Rounded Texas Calculator    Some college      0.1   5.26      4396 plan1  5000  4995.       604</span>
<span id="cb30-376"><a href="#cb30-376" aria-hidden="true" tabindex="-1"></a>2 s2_1      2 Percentage WATER     10%      Not Rounded Texas Calculator    Some college      0.1   5.26      4396 plan2  5000  4995.       604</span>
<span id="cb30-377"><a href="#cb30-377" aria-hidden="true" tabindex="-1"></a>3 s2_2      2 Percentage WATER     10%      Not Rounded Texas No Calculator Graduate degree   0.1   5.26      4396 plan1  4396  4391.         0</span>
<span id="cb30-378"><a href="#cb30-378" aria-hidden="true" tabindex="-1"></a>4 s2_2      2 Percentage WATER     10%      Not Rounded Texas No Calculator Graduate degree   0.1   5.26      4396 plan2  5257  5252.       861</span>
<span id="cb30-379"><a href="#cb30-379" aria-hidden="true" tabindex="-1"></a>5 s2_3      2 Percentage WATER     10%      Not Rounded Texas Calculator    Graduate degree   0.1   5.26      4396 plan1  3527  3522.      -869</span>
<span id="cb30-380"><a href="#cb30-380" aria-hidden="true" tabindex="-1"></a>6 s2_3      2 Percentage WATER     10%      Not Rounded Texas Calculator    Graduate degree   0.1   5.26      4396 plan2  3027  3022.     -1369</span>
<span id="cb30-381"><a href="#cb30-381" aria-hidden="true" tabindex="-1"></a>7 s2_4      2 Percentage WATER     10%      Not Rounded Texas Calculator    Graduate degree   0.1   5.26      4396 plan1  4800  4795.       404</span>
<span id="cb30-382"><a href="#cb30-382" aria-hidden="true" tabindex="-1"></a>8 s2_4      2 Percentage WATER     10%      Not Rounded Texas Calculator    Graduate degree   0.1   5.26      4396 plan2  5000  4995.       604</span>
<span id="cb30-383"><a href="#cb30-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-384"><a href="#cb30-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-385"><a href="#cb30-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-386"><a href="#cb30-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-387"><a href="#cb30-387" aria-hidden="true" tabindex="-1"></a><span class="fu">## Inspects counts for each distinct value of prior year family use, and state average</span></span>
<span id="cb30-388"><a href="#cb30-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-391"><a href="#cb30-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-392"><a href="#cb30-392" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-393"><a href="#cb30-393" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb30-394"><a href="#cb30-394" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(officer)</span>
<span id="cb30-395"><a href="#cb30-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-396"><a href="#cb30-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-397"><a href="#cb30-397" aria-hidden="true" tabindex="-1"></a>correct_values <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb30-398"><a href="#cb30-398" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>state, <span class="sc">~</span>appliance, <span class="sc">~</span>family, <span class="sc">~</span>state_avg,</span>
<span id="cb30-399"><a href="#cb30-399" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Texas values</span></span>
<span id="cb30-400"><a href="#cb30-400" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Cooling"</span>, <span class="dv">6573</span>, <span class="dv">4249</span>,</span>
<span id="cb30-401"><a href="#cb30-401" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Heating"</span>, <span class="dv">6118</span>, <span class="dv">5099</span>,</span>
<span id="cb30-402"><a href="#cb30-402" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span>, <span class="dv">5257</span>, <span class="dv">4396</span>,</span>
<span id="cb30-403"><a href="#cb30-403" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Refrigerator"</span>, <span class="dv">2639</span>, <span class="dv">1318</span>,</span>
<span id="cb30-404"><a href="#cb30-404" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Other Appliance"</span>, <span class="dv">8459</span>, <span class="dv">7883</span>,</span>
<span id="cb30-405"><a href="#cb30-405" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Total kWh"</span>, <span class="dv">29046</span>, <span class="dv">22945</span>,</span>
<span id="cb30-406"><a href="#cb30-406" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-407"><a href="#cb30-407" aria-hidden="true" tabindex="-1"></a>  <span class="co"># California values</span></span>
<span id="cb30-408"><a href="#cb30-408" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Cooling"</span>, <span class="dv">2581</span>, <span class="dv">1289</span>,</span>
<span id="cb30-409"><a href="#cb30-409" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Heating"</span>, <span class="dv">6157</span>, <span class="dv">5597</span>,</span>
<span id="cb30-410"><a href="#cb30-410" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Water Heating"</span>, <span class="dv">5061</span>, <span class="dv">4601</span>,</span>
<span id="cb30-411"><a href="#cb30-411" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Refrigerator"</span>, <span class="dv">1266</span>, <span class="dv">1055</span>,</span>
<span id="cb30-412"><a href="#cb30-412" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Other Appliance"</span>, <span class="dv">7608</span>, <span class="dv">6916</span>,</span>
<span id="cb30-413"><a href="#cb30-413" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Total kWh"</span>, <span class="dv">22673</span>, <span class="dv">19458</span>,</span>
<span id="cb30-414"><a href="#cb30-414" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-415"><a href="#cb30-415" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Colorado values</span></span>
<span id="cb30-416"><a href="#cb30-416" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Cooling"</span>, <span class="dv">697</span>, <span class="dv">498</span>,</span>
<span id="cb30-417"><a href="#cb30-417" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Heating"</span>, <span class="dv">18052</span>, <span class="dv">16411</span>,</span>
<span id="cb30-418"><a href="#cb30-418" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Water Heating"</span>, <span class="dv">11667</span>, <span class="dv">5832</span>,</span>
<span id="cb30-419"><a href="#cb30-419" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Refrigerator"</span>, <span class="dv">1370</span>, <span class="dv">1142</span>,</span>
<span id="cb30-420"><a href="#cb30-420" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Other Appliance"</span>, <span class="dv">7882</span>, <span class="dv">6652</span>,</span>
<span id="cb30-421"><a href="#cb30-421" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Total kWh"</span>, <span class="dv">39768</span>, <span class="dv">30535</span>,</span>
<span id="cb30-422"><a href="#cb30-422" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-423"><a href="#cb30-423" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Massachusetts values</span></span>
<span id="cb30-424"><a href="#cb30-424" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Cooling"</span>, <span class="dv">419</span>, <span class="dv">322</span>,</span>
<span id="cb30-425"><a href="#cb30-425" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Heating"</span>, <span class="dv">26751</span>, <span class="dv">19108</span>,</span>
<span id="cb30-426"><a href="#cb30-426" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Water Heating"</span>, <span class="dv">10543</span>, <span class="dv">5070</span>,</span>
<span id="cb30-427"><a href="#cb30-427" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Refrigerator"</span>, <span class="dv">1230</span>, <span class="dv">1025</span>,</span>
<span id="cb30-428"><a href="#cb30-428" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Other Appliance"</span>, <span class="dv">7350</span>, <span class="dv">6682</span>,</span>
<span id="cb30-429"><a href="#cb30-429" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Total kWh"</span>, <span class="dv">46293</span>, <span class="dv">32207</span></span>
<span id="cb30-430"><a href="#cb30-430" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-431"><a href="#cb30-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-432"><a href="#cb30-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-433"><a href="#cb30-433" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create a lookup table of correct values</span></span>
<span id="cb30-434"><a href="#cb30-434" aria-hidden="true" tabindex="-1"></a>correct_lookup <span class="ot">&lt;-</span> correct_values <span class="sc">%&gt;%</span></span>
<span id="cb30-435"><a href="#cb30-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, appliance, family) <span class="sc">%&gt;%</span></span>
<span id="cb30-436"><a href="#cb30-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-437"><a href="#cb30-437" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"Texas"</span> <span class="sc">~</span> <span class="st">"TEX"</span>,</span>
<span id="cb30-438"><a href="#cb30-438" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"California"</span> <span class="sc">~</span> <span class="st">"CAL"</span>,</span>
<span id="cb30-439"><a href="#cb30-439" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"Colorado"</span> <span class="sc">~</span> <span class="st">"COL"</span>,</span>
<span id="cb30-440"><a href="#cb30-440" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"Massachusetts"</span> <span class="sc">~</span> <span class="st">"MASS"</span>,</span>
<span id="cb30-441"><a href="#cb30-441" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> state</span>
<span id="cb30-442"><a href="#cb30-442" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb30-443"><a href="#cb30-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-444"><a href="#cb30-444" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the main table</span></span>
<span id="cb30-445"><a href="#cb30-445" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span></span>
<span id="cb30-446"><a href="#cb30-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance <span class="sc">!=</span> <span class="st">"Total kWh"</span>, plan <span class="sc">==</span> <span class="st">"plan1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-447"><a href="#cb30-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, state, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-448"><a href="#cb30-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-449"><a href="#cb30-449" aria-hidden="true" tabindex="-1"></a>    <span class="at">distinct_families =</span> <span class="fu">n_distinct</span>(family),</span>
<span id="cb30-450"><a href="#cb30-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">color_flag =</span> distinct_families <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb30-451"><a href="#cb30-451" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-452"><a href="#cb30-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-453"><a href="#cb30-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(color_flag) <span class="sc">%&gt;%</span></span>
<span id="cb30-454"><a href="#cb30-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, family, state, color_flag, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-455"><a href="#cb30-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-456"><a href="#cb30-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>color_flag) <span class="sc">%&gt;%</span></span>
<span id="cb30-457"><a href="#cb30-457" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join with correct values to create is_correct flag</span></span>
<span id="cb30-458"><a href="#cb30-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(correct_lookup, </span>
<span id="cb30-459"><a href="#cb30-459" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"appliance"</span>),</span>
<span id="cb30-460"><a href="#cb30-460" aria-hidden="true" tabindex="-1"></a>            <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_correct"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-461"><a href="#cb30-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_correct =</span> <span class="fu">abs</span>(<span class="fu">as.numeric</span>(family) <span class="sc">-</span> family_correct) <span class="sc">&lt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-462"><a href="#cb30-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>family_correct) <span class="sc">%&gt;%</span></span>
<span id="cb30-463"><a href="#cb30-463" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reorganize and format</span></span>
<span id="cb30-464"><a href="#cb30-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, refClass, appliance, family, n, is_correct) <span class="sc">%&gt;%</span>  <span class="co"># Swapped order here</span></span>
<span id="cb30-465"><a href="#cb30-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state, appliance, refClass, family) <span class="sc">%&gt;%</span></span>
<span id="cb30-466"><a href="#cb30-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-467"><a href="#cb30-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_lines</span>(<span class="at">values =</span> <span class="st">"Family prior year use per utility counts (green=most frequent)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-468"><a href="#cb30-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">"header"</span>, <span class="at">i =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-469"><a href="#cb30-469" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge cells</span></span>
<span id="cb30-470"><a href="#cb30-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge_v</span>(<span class="at">j =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-471"><a href="#cb30-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge_v</span>(<span class="at">j =</span> <span class="fu">c</span>(<span class="st">"appliance"</span>, <span class="st">"refClass"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-472"><a href="#cb30-472" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Conditional formatting for both family and count</span></span>
<span id="cb30-473"><a href="#cb30-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">color</span>(<span class="at">i =</span> <span class="sc">~</span> is_correct <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">j =</span> <span class="fu">c</span>(<span class="st">"family"</span>, <span class="st">"n"</span>), <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-474"><a href="#cb30-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">color</span>(<span class="at">i =</span> <span class="sc">~</span> is_correct <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">j =</span> <span class="fu">c</span>(<span class="st">"family"</span>, <span class="st">"n"</span>), <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-475"><a href="#cb30-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bg</span>(<span class="at">i =</span> <span class="sc">~</span> is_correct <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">j =</span> <span class="fu">c</span>(<span class="st">"family"</span>, <span class="st">"n"</span>), <span class="at">bg =</span> <span class="st">"#e6ffe6"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-476"><a href="#cb30-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bg</span>(<span class="at">i =</span> <span class="sc">~</span> is_correct <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">j =</span> <span class="fu">c</span>(<span class="st">"family"</span>, <span class="st">"n"</span>), <span class="at">bg =</span> <span class="st">"#ffe6e6"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-477"><a href="#cb30-477" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style improvements</span></span>
<span id="cb30-478"><a href="#cb30-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_vanilla</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-479"><a href="#cb30-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">align</span>(<span class="at">j =</span> <span class="fu">c</span>(<span class="st">"family"</span>, <span class="st">"n"</span>), <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-480"><a href="#cb30-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">border_outer</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-481"><a href="#cb30-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-482"><a href="#cb30-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fontsize</span>(<span class="at">size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-483"><a href="#cb30-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">padding</span>(<span class="at">padding =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-484"><a href="#cb30-484" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add section borders</span></span>
<span id="cb30-485"><a href="#cb30-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hline</span>(<span class="at">i =</span> <span class="sc">~</span> state <span class="sc">!=</span> <span class="fu">lag</span>(state, <span class="at">default =</span> <span class="fu">first</span>(state)), </span>
<span id="cb30-486"><a href="#cb30-486" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> officer<span class="sc">::</span><span class="fu">fp_border</span>(<span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">width =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-487"><a href="#cb30-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colformat_double</span>(<span class="at">j =</span> <span class="st">"family"</span>, <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-488"><a href="#cb30-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_header_labels</span>(</span>
<span id="cb30-489"><a href="#cb30-489" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="st">"State"</span>,</span>
<span id="cb30-490"><a href="#cb30-490" aria-hidden="true" tabindex="-1"></a>    <span class="at">appliance =</span> <span class="st">"Appliance"</span>,</span>
<span id="cb30-491"><a href="#cb30-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Family"</span>,</span>
<span id="cb30-492"><a href="#cb30-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">refClass =</span> <span class="st">"Reference Class"</span>,</span>
<span id="cb30-493"><a href="#cb30-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="st">"Count"</span>,</span>
<span id="cb30-494"><a href="#cb30-494" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_correct =</span> <span class="st">"Correct Value"</span></span>
<span id="cb30-495"><a href="#cb30-495" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-496"><a href="#cb30-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autofit</span>()</span>
<span id="cb30-497"><a href="#cb30-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-498"><a href="#cb30-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-499"><a href="#cb30-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-500"><a href="#cb30-500" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-501"><a href="#cb30-501" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb30-502"><a href="#cb30-502" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(officer)</span>
<span id="cb30-503"><a href="#cb30-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-504"><a href="#cb30-504" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-505"><a href="#cb30-505" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb30-506"><a href="#cb30-506" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(officer)</span>
<span id="cb30-507"><a href="#cb30-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-508"><a href="#cb30-508" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span></span>
<span id="cb30-509"><a href="#cb30-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance <span class="sc">!=</span> <span class="st">"Total kWh"</span>, plan <span class="sc">==</span> <span class="st">"plan1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-510"><a href="#cb30-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, state, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-511"><a href="#cb30-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distinct_state_avg =</span> <span class="fu">n_distinct</span>(state_avg)) <span class="sc">%&gt;%</span></span>
<span id="cb30-512"><a href="#cb30-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-513"><a href="#cb30-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(distinct_state_avg <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-514"><a href="#cb30-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, state_avg, state, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-515"><a href="#cb30-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-516"><a href="#cb30-516" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identify outliers (rows where n is 1)</span></span>
<span id="cb30-517"><a href="#cb30-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_outlier =</span> n <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-518"><a href="#cb30-518" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reorganize and format</span></span>
<span id="cb30-519"><a href="#cb30-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, refClass, appliance, state_avg, n) <span class="sc">%&gt;%</span></span>
<span id="cb30-520"><a href="#cb30-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state, appliance, refClass, state_avg) <span class="sc">%&gt;%</span></span>
<span id="cb30-521"><a href="#cb30-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-522"><a href="#cb30-522" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add title</span></span>
<span id="cb30-523"><a href="#cb30-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_lines</span>(<span class="at">values =</span> <span class="st">"State Avg. per utility counts (green=most frequent)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-524"><a href="#cb30-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">"header"</span>, <span class="at">i =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-525"><a href="#cb30-525" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge cells</span></span>
<span id="cb30-526"><a href="#cb30-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge_v</span>(<span class="at">j =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-527"><a href="#cb30-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge_v</span>(<span class="at">j =</span> <span class="fu">c</span>(<span class="st">"appliance"</span>, <span class="st">"refClass"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-528"><a href="#cb30-528" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Conditional formatting for outliers</span></span>
<span id="cb30-529"><a href="#cb30-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">color</span>(<span class="at">i =</span> <span class="sc">~</span> n <span class="sc">==</span> <span class="dv">1</span>, <span class="at">j =</span> <span class="fu">c</span>(<span class="st">"state_avg"</span>, <span class="st">"n"</span>), <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-530"><a href="#cb30-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">color</span>(<span class="at">i =</span> <span class="sc">~</span> n <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="at">j =</span> <span class="fu">c</span>(<span class="st">"state_avg"</span>, <span class="st">"n"</span>), <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-531"><a href="#cb30-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bg</span>(<span class="at">i =</span> <span class="sc">~</span> n <span class="sc">==</span> <span class="dv">1</span>, <span class="at">j =</span> <span class="fu">c</span>(<span class="st">"state_avg"</span>, <span class="st">"n"</span>), <span class="at">bg =</span> <span class="st">"#ffe6e6"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-532"><a href="#cb30-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bg</span>(<span class="at">i =</span> <span class="sc">~</span> n <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="at">j =</span> <span class="fu">c</span>(<span class="st">"state_avg"</span>, <span class="st">"n"</span>), <span class="at">bg =</span> <span class="st">"#e6ffe6"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-533"><a href="#cb30-533" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style improvements</span></span>
<span id="cb30-534"><a href="#cb30-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_vanilla</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-535"><a href="#cb30-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">align</span>(<span class="at">j =</span> <span class="fu">c</span>(<span class="st">"state_avg"</span>, <span class="st">"n"</span>), <span class="at">align =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-536"><a href="#cb30-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">border_outer</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-537"><a href="#cb30-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-538"><a href="#cb30-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fontsize</span>(<span class="at">size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-539"><a href="#cb30-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">padding</span>(<span class="at">padding =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-540"><a href="#cb30-540" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add section borders</span></span>
<span id="cb30-541"><a href="#cb30-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hline</span>(<span class="at">i =</span> <span class="sc">~</span> state <span class="sc">!=</span> <span class="fu">lag</span>(state, <span class="at">default =</span> <span class="fu">first</span>(state)), </span>
<span id="cb30-542"><a href="#cb30-542" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> officer<span class="sc">::</span><span class="fu">fp_border</span>(<span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">width =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-543"><a href="#cb30-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colformat_double</span>(<span class="at">j =</span> <span class="st">"state_avg"</span>, <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-544"><a href="#cb30-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_header_labels</span>(</span>
<span id="cb30-545"><a href="#cb30-545" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="st">"State"</span>,</span>
<span id="cb30-546"><a href="#cb30-546" aria-hidden="true" tabindex="-1"></a>    <span class="at">appliance =</span> <span class="st">"Appliance"</span>,</span>
<span id="cb30-547"><a href="#cb30-547" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_avg =</span> <span class="st">"State Average"</span>,</span>
<span id="cb30-548"><a href="#cb30-548" aria-hidden="true" tabindex="-1"></a>    <span class="at">refClass =</span> <span class="st">"Reference Class"</span>,</span>
<span id="cb30-549"><a href="#cb30-549" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="st">"Count"</span></span>
<span id="cb30-550"><a href="#cb30-550" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-551"><a href="#cb30-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autofit</span>()</span>
<span id="cb30-552"><a href="#cb30-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-553"><a href="#cb30-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-554"><a href="#cb30-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-555"><a href="#cb30-555" aria-hidden="true" tabindex="-1"></a><span class="fu">### Alternate discrep frequency tables</span></span>
<span id="cb30-556"><a href="#cb30-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-559"><a href="#cb30-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-560"><a href="#cb30-560" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-561"><a href="#cb30-561" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb30-562"><a href="#cb30-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-563"><a href="#cb30-563" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span> s1 <span class="sc">%&gt;%</span></span>
<span id="cb30-564"><a href="#cb30-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance <span class="sc">!=</span> <span class="st">"Total kWh"</span>, plan <span class="sc">==</span> <span class="st">"plan1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-565"><a href="#cb30-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, state, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-566"><a href="#cb30-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distinct_families =</span> <span class="fu">n_distinct</span>(family)) <span class="sc">%&gt;%</span></span>
<span id="cb30-567"><a href="#cb30-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-568"><a href="#cb30-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(distinct_families <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-569"><a href="#cb30-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, family, state, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-570"><a href="#cb30-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-571"><a href="#cb30-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state, refClass, appliance)</span>
<span id="cb30-572"><a href="#cb30-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-573"><a href="#cb30-573" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data with separate columns for Family and Frequency</span></span>
<span id="cb30-574"><a href="#cb30-574" aria-hidden="true" tabindex="-1"></a>table_data_compact <span class="ot">&lt;-</span> table_data <span class="sc">%&gt;%</span></span>
<span id="cb30-575"><a href="#cb30-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state, appliance, refClass, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span>  <span class="co"># Sort by descending frequency</span></span>
<span id="cb30-576"><a href="#cb30-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, refClass, appliance, family, n) <span class="sc">%&gt;%</span></span>
<span id="cb30-577"><a href="#cb30-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, refClass, appliance) <span class="sc">%&gt;%</span></span>
<span id="cb30-578"><a href="#cb30-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-579"><a href="#cb30-579" aria-hidden="true" tabindex="-1"></a>    <span class="at">Family =</span> <span class="fu">paste</span>(family[<span class="fu">order</span>(<span class="sc">-</span>n)], <span class="at">collapse =</span> <span class="st">", "</span>),  <span class="co"># Order family values by descending frequency</span></span>
<span id="cb30-580"><a href="#cb30-580" aria-hidden="true" tabindex="-1"></a>    <span class="at">Frequency =</span> <span class="fu">paste</span>(n[<span class="fu">order</span>(<span class="sc">-</span>n)], <span class="at">collapse =</span> <span class="st">", "</span>),    <span class="co"># Order frequency values in descending order</span></span>
<span id="cb30-581"><a href="#cb30-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb30-582"><a href="#cb30-582" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-583"><a href="#cb30-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-584"><a href="#cb30-584" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the GT table with the new format</span></span>
<span id="cb30-585"><a href="#cb30-585" aria-hidden="true" tabindex="-1"></a>table_data_compact <span class="sc">%&gt;%</span></span>
<span id="cb30-586"><a href="#cb30-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-587"><a href="#cb30-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb30-588"><a href="#cb30-588" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Compact Frequency Table by State, RefClass, and Appliance"</span></span>
<span id="cb30-589"><a href="#cb30-589" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-590"><a href="#cb30-590" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Label columns for clarity</span></span>
<span id="cb30-591"><a href="#cb30-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb30-592"><a href="#cb30-592" aria-hidden="true" tabindex="-1"></a>    <span class="at">refClass =</span> <span class="st">"Reference Class"</span>,</span>
<span id="cb30-593"><a href="#cb30-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">appliance =</span> <span class="st">"Appliance"</span>,</span>
<span id="cb30-594"><a href="#cb30-594" aria-hidden="true" tabindex="-1"></a>    <span class="at">Family =</span> <span class="st">"Family last year"</span>,</span>
<span id="cb30-595"><a href="#cb30-595" aria-hidden="true" tabindex="-1"></a>    <span class="at">Frequency =</span> <span class="st">"Frequency (n)"</span></span>
<span id="cb30-596"><a href="#cb30-596" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-597"><a href="#cb30-597" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style the table headers</span></span>
<span id="cb30-598"><a href="#cb30-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb30-599"><a href="#cb30-599" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb30-600"><a href="#cb30-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> <span class="fu">everything</span>())</span>
<span id="cb30-601"><a href="#cb30-601" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-602"><a href="#cb30-602" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Center the row group headers for each state</span></span>
<span id="cb30-603"><a href="#cb30-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb30-604"><a href="#cb30-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">list</span>(<span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>, <span class="at">align =</span> <span class="st">"center"</span>)),</span>
<span id="cb30-605"><a href="#cb30-605" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_row_groups</span>(<span class="at">groups =</span> <span class="fu">everything</span>())</span>
<span id="cb30-606"><a href="#cb30-606" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-607"><a href="#cb30-607" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style the appliance rows with lighter borders for each appliance within the state</span></span>
<span id="cb30-608"><a href="#cb30-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb30-609"><a href="#cb30-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_group.border.bottom.color =</span> <span class="st">"grey"</span>,</span>
<span id="cb30-610"><a href="#cb30-610" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_group.border.bottom.width =</span> <span class="fu">px</span>(<span class="dv">1</span>),</span>
<span id="cb30-611"><a href="#cb30-611" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.font.size =</span> <span class="fu">px</span>(<span class="dv">13</span>),</span>
<span id="cb30-612"><a href="#cb30-612" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_row.padding =</span> <span class="fu">px</span>(<span class="dv">3</span>),  <span class="co"># Compact padding</span></span>
<span id="cb30-613"><a href="#cb30-613" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.striping.include_stub =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-614"><a href="#cb30-614" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.striping.background_color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb30-615"><a href="#cb30-615" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.width =</span> <span class="fu">pct</span>(<span class="dv">100</span>)</span>
<span id="cb30-616"><a href="#cb30-616" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-617"><a href="#cb30-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-618"><a href="#cb30-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-619"><a href="#cb30-619" aria-hidden="true" tabindex="-1"></a><span class="do">#######</span></span>
<span id="cb30-620"><a href="#cb30-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-621"><a href="#cb30-621" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-622"><a href="#cb30-622" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb30-623"><a href="#cb30-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-624"><a href="#cb30-624" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data, focusing on `state_avg` instead of `family`</span></span>
<span id="cb30-625"><a href="#cb30-625" aria-hidden="true" tabindex="-1"></a>table_data_state_avg <span class="ot">&lt;-</span> s1 <span class="sc">%&gt;%</span></span>
<span id="cb30-626"><a href="#cb30-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(appliance <span class="sc">!=</span> <span class="st">"Total kWh"</span>, plan <span class="sc">==</span> <span class="st">"plan1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-627"><a href="#cb30-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, state, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-628"><a href="#cb30-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distinct_state_avg =</span> <span class="fu">n_distinct</span>(state_avg)) <span class="sc">%&gt;%</span></span>
<span id="cb30-629"><a href="#cb30-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-630"><a href="#cb30-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(distinct_state_avg <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-631"><a href="#cb30-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appliance, state_avg, state, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-632"><a href="#cb30-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-633"><a href="#cb30-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state, refClass, appliance, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span>  <span class="co"># Sort by descending frequency</span></span>
<span id="cb30-634"><a href="#cb30-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, refClass, appliance, state_avg, n) <span class="sc">%&gt;%</span></span>
<span id="cb30-635"><a href="#cb30-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, refClass, appliance) <span class="sc">%&gt;%</span></span>
<span id="cb30-636"><a href="#cb30-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-637"><a href="#cb30-637" aria-hidden="true" tabindex="-1"></a>    <span class="at">State_Avg =</span> <span class="fu">paste</span>(state_avg[<span class="fu">order</span>(<span class="sc">-</span>n)], <span class="at">collapse =</span> <span class="st">", "</span>),  <span class="co"># Order state_avg values by descending frequency</span></span>
<span id="cb30-638"><a href="#cb30-638" aria-hidden="true" tabindex="-1"></a>    <span class="at">Frequency =</span> <span class="fu">paste</span>(n[<span class="fu">order</span>(<span class="sc">-</span>n)], <span class="at">collapse =</span> <span class="st">", "</span>),          <span class="co"># Order frequency values in descending order</span></span>
<span id="cb30-639"><a href="#cb30-639" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb30-640"><a href="#cb30-640" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-641"><a href="#cb30-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-642"><a href="#cb30-642" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the GT table with the new format</span></span>
<span id="cb30-643"><a href="#cb30-643" aria-hidden="true" tabindex="-1"></a>table_data_state_avg <span class="sc">%&gt;%</span></span>
<span id="cb30-644"><a href="#cb30-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-645"><a href="#cb30-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb30-646"><a href="#cb30-646" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Compact Frequency Table by RefClass, Appliance, and State Average"</span></span>
<span id="cb30-647"><a href="#cb30-647" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-648"><a href="#cb30-648" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Label columns for clarity</span></span>
<span id="cb30-649"><a href="#cb30-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb30-650"><a href="#cb30-650" aria-hidden="true" tabindex="-1"></a>    <span class="at">refClass =</span> <span class="st">"Reference Class"</span>,</span>
<span id="cb30-651"><a href="#cb30-651" aria-hidden="true" tabindex="-1"></a>    <span class="at">appliance =</span> <span class="st">"Appliance"</span>,</span>
<span id="cb30-652"><a href="#cb30-652" aria-hidden="true" tabindex="-1"></a>    <span class="at">State_Avg =</span> <span class="st">"State Avg"</span>,</span>
<span id="cb30-653"><a href="#cb30-653" aria-hidden="true" tabindex="-1"></a>    <span class="at">Frequency =</span> <span class="st">"Frequency (n)"</span></span>
<span id="cb30-654"><a href="#cb30-654" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-655"><a href="#cb30-655" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style the table headers</span></span>
<span id="cb30-656"><a href="#cb30-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb30-657"><a href="#cb30-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb30-658"><a href="#cb30-658" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> <span class="fu">everything</span>())</span>
<span id="cb30-659"><a href="#cb30-659" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-660"><a href="#cb30-660" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Center the row group headers for each state</span></span>
<span id="cb30-661"><a href="#cb30-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb30-662"><a href="#cb30-662" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">list</span>(<span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>, <span class="at">align =</span> <span class="st">"center"</span>)),</span>
<span id="cb30-663"><a href="#cb30-663" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_row_groups</span>(<span class="at">groups =</span> <span class="fu">everything</span>())</span>
<span id="cb30-664"><a href="#cb30-664" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-665"><a href="#cb30-665" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Style the appliance rows with lighter borders for each appliance within the state</span></span>
<span id="cb30-666"><a href="#cb30-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb30-667"><a href="#cb30-667" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_group.border.bottom.color =</span> <span class="st">"grey"</span>,</span>
<span id="cb30-668"><a href="#cb30-668" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_group.border.bottom.width =</span> <span class="fu">px</span>(<span class="dv">1</span>),</span>
<span id="cb30-669"><a href="#cb30-669" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.font.size =</span> <span class="fu">px</span>(<span class="dv">13</span>),</span>
<span id="cb30-670"><a href="#cb30-670" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_row.padding =</span> <span class="fu">px</span>(<span class="dv">3</span>),  <span class="co"># Compact padding</span></span>
<span id="cb30-671"><a href="#cb30-671" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.striping.include_stub =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-672"><a href="#cb30-672" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.striping.background_color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb30-673"><a href="#cb30-673" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.width =</span> <span class="fu">pct</span>(<span class="dv">100</span>)</span>
<span id="cb30-674"><a href="#cb30-674" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-675"><a href="#cb30-675" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-676"><a href="#cb30-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-677"><a href="#cb30-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-678"><a href="#cb30-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-679"><a href="#cb30-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-680"><a href="#cb30-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-681"><a href="#cb30-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-682"><a href="#cb30-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-685"><a href="#cb30-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-686"><a href="#cb30-686" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb30-687"><a href="#cb30-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-688"><a href="#cb30-688" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-689"><a href="#cb30-689" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb30-690"><a href="#cb30-690" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb30-691"><a href="#cb30-691" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb30-692"><a href="#cb30-692" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb30-693"><a href="#cb30-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-694"><a href="#cb30-694" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a mapping between state codes and full state names</span></span>
<span id="cb30-695"><a href="#cb30-695" aria-hidden="true" tabindex="-1"></a>state_code_map <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb30-696"><a href="#cb30-696" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CAL"</span> <span class="ot">=</span> <span class="st">"California"</span>,</span>
<span id="cb30-697"><a href="#cb30-697" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TEX"</span> <span class="ot">=</span> <span class="st">"Texas"</span>,</span>
<span id="cb30-698"><a href="#cb30-698" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COL"</span> <span class="ot">=</span> <span class="st">"Colorado"</span>,</span>
<span id="cb30-699"><a href="#cb30-699" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MASS"</span> <span class="ot">=</span> <span class="st">"Massachusetts"</span></span>
<span id="cb30-700"><a href="#cb30-700" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-701"><a href="#cb30-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-702"><a href="#cb30-702" aria-hidden="true" tabindex="-1"></a><span class="co"># Revised parse_action_plan function</span></span>
<span id="cb30-703"><a href="#cb30-703" aria-hidden="true" tabindex="-1"></a>parse_action_plan <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb30-704"><a href="#cb30-704" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-705"><a href="#cb30-705" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract participant-specific states</span></span>
<span id="cb30-706"><a href="#cb30-706" aria-hidden="true" tabindex="-1"></a>  participant_states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">unique</span>(df<span class="sc">$</span>state1), <span class="fu">unique</span>(df<span class="sc">$</span>state2))</span>
<span id="cb30-707"><a href="#cb30-707" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-708"><a href="#cb30-708" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select action plan columns based on state codes</span></span>
<span id="cb30-709"><a href="#cb30-709" aria-hidden="true" tabindex="-1"></a>  action_plan_cols <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb30-710"><a href="#cb30-710" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"^[ADP]</span><span class="sc">\\</span><span class="st">d+(CAL|MASS|COL|TEX)</span><span class="sc">\\</span><span class="st">d{2,3}$"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-711"><a href="#cb30-711" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"32$"</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Exclude columns ending with '32'</span></span>
<span id="cb30-712"><a href="#cb30-712" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>()</span>
<span id="cb30-713"><a href="#cb30-713" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-714"><a href="#cb30-714" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot longer to reshape data</span></span>
<span id="cb30-715"><a href="#cb30-715" aria-hidden="true" tabindex="-1"></a>  df_long <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb30-716"><a href="#cb30-716" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb30-717"><a href="#cb30-717" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">all_of</span>(action_plan_cols),</span>
<span id="cb30-718"><a href="#cb30-718" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"modality"</span>, <span class="st">"state_code"</span>, <span class="st">"item_num"</span>),</span>
<span id="cb30-719"><a href="#cb30-719" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_pattern =</span> <span class="st">"^([ADP])</span><span class="sc">\\</span><span class="st">d+(CAL|MASS|COL|TEX)(</span><span class="sc">\\</span><span class="st">d+)$"</span>,</span>
<span id="cb30-720"><a href="#cb30-720" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb30-721"><a href="#cb30-721" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb30-722"><a href="#cb30-722" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb30-723"><a href="#cb30-723" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Map state codes to full state names</span></span>
<span id="cb30-724"><a href="#cb30-724" aria-hidden="true" tabindex="-1"></a>      <span class="at">state_full =</span> state_code_map[state_code],</span>
<span id="cb30-725"><a href="#cb30-725" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ensure that the state_full is one of the participant's assigned states</span></span>
<span id="cb30-726"><a href="#cb30-726" aria-hidden="true" tabindex="-1"></a>      <span class="at">state_assigned =</span> <span class="fu">if_else</span>(state_full <span class="sc">%in%</span> participant_states, state_full, <span class="cn">NA_character_</span>)</span>
<span id="cb30-727"><a href="#cb30-727" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb30-728"><a href="#cb30-728" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(state_assigned)) <span class="sc">%&gt;%</span>  <span class="co"># Keep only matching states</span></span>
<span id="cb30-729"><a href="#cb30-729" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(id, state1, state2, refClass, calc, edu, modality, state_assigned, item_num, value, id2, Duration__in_seconds_) </span>
<span id="cb30-730"><a href="#cb30-730" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-731"><a href="#cb30-731" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign appliance based on item_num</span></span>
<span id="cb30-732"><a href="#cb30-732" aria-hidden="true" tabindex="-1"></a>  df_long <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb30-733"><a href="#cb30-733" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb30-734"><a href="#cb30-734" aria-hidden="true" tabindex="-1"></a>      <span class="at">appliance =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-735"><a href="#cb30-735" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"07"</span>,<span class="st">"08"</span>,<span class="st">"09"</span>,<span class="st">"10"</span>) <span class="sc">~</span> <span class="st">"Cooling"</span>,</span>
<span id="cb30-736"><a href="#cb30-736" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"11"</span>,<span class="st">"12"</span>,<span class="st">"13"</span>,<span class="st">"14"</span>) <span class="sc">~</span> <span class="st">"Heating"</span>,</span>
<span id="cb30-737"><a href="#cb30-737" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"15"</span>,<span class="st">"16"</span>,<span class="st">"17"</span>,<span class="st">"18"</span>) <span class="sc">~</span> <span class="st">"Water Heating"</span>,</span>
<span id="cb30-738"><a href="#cb30-738" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"19"</span>,<span class="st">"20"</span>,<span class="st">"21"</span>,<span class="st">"22"</span>) <span class="sc">~</span> <span class="st">"Refrigerator"</span>,</span>
<span id="cb30-739"><a href="#cb30-739" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"23"</span>,<span class="st">"24"</span>,<span class="st">"25"</span>,<span class="st">"26"</span>) <span class="sc">~</span> <span class="st">"Other Appliance"</span>,</span>
<span id="cb30-740"><a href="#cb30-740" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"27"</span>,<span class="st">"28"</span>,<span class="st">"29"</span>,<span class="st">"30"</span>) <span class="sc">~</span> <span class="st">"Total kWh"</span>,</span>
<span id="cb30-741"><a href="#cb30-741" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">==</span> <span class="st">"31"</span> <span class="sc">~</span> <span class="st">"Preferred Plan"</span>,</span>
<span id="cb30-742"><a href="#cb30-742" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"33"</span>,<span class="st">"34"</span>,<span class="st">"35"</span>,<span class="st">"36"</span>,<span class="st">"37"</span>) <span class="sc">~</span> <span class="st">"Reduction Choices"</span>,</span>
<span id="cb30-743"><a href="#cb30-743" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb30-744"><a href="#cb30-744" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb30-745"><a href="#cb30-745" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Assign item_type based on item_num</span></span>
<span id="cb30-746"><a href="#cb30-746" aria-hidden="true" tabindex="-1"></a>      <span class="at">item_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-747"><a href="#cb30-747" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"07"</span>,<span class="st">"11"</span>,<span class="st">"15"</span>,<span class="st">"19"</span>,<span class="st">"23"</span>,<span class="st">"27"</span>) <span class="sc">~</span> <span class="st">"family"</span>,</span>
<span id="cb30-748"><a href="#cb30-748" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"08"</span>,<span class="st">"12"</span>,<span class="st">"16"</span>,<span class="st">"20"</span>,<span class="st">"24"</span>,<span class="st">"28"</span>) <span class="sc">~</span> <span class="st">"state_avg"</span>,</span>
<span id="cb30-749"><a href="#cb30-749" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"09"</span>,<span class="st">"13"</span>,<span class="st">"17"</span>,<span class="st">"21"</span>,<span class="st">"25"</span>,<span class="st">"29"</span>) <span class="sc">~</span> <span class="st">"plan1"</span>,</span>
<span id="cb30-750"><a href="#cb30-750" aria-hidden="true" tabindex="-1"></a>        item_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"10"</span>,<span class="st">"14"</span>,<span class="st">"18"</span>,<span class="st">"22"</span>,<span class="st">"26"</span>,<span class="st">"30"</span>) <span class="sc">~</span> <span class="st">"plan2"</span>,</span>
<span id="cb30-751"><a href="#cb30-751" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"other"</span></span>
<span id="cb30-752"><a href="#cb30-752" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb30-753"><a href="#cb30-753" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-754"><a href="#cb30-754" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-755"><a href="#cb30-755" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Continue processing only relevant item_types</span></span>
<span id="cb30-756"><a href="#cb30-756" aria-hidden="true" tabindex="-1"></a>  df_long <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb30-757"><a href="#cb30-757" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(item_type <span class="sc">!=</span> <span class="st">"other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-758"><a href="#cb30-758" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>item_num) <span class="sc">%&gt;%</span></span>
<span id="cb30-759"><a href="#cb30-759" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"item_type"</span>, <span class="at">values_from =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-760"><a href="#cb30-760" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"plan1"</span>, <span class="st">"plan2"</span>), <span class="at">names_to =</span> <span class="st">"plan"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb30-761"><a href="#cb30-761" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-762"><a href="#cb30-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_long)</span>
<span id="cb30-763"><a href="#cb30-763" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-764"><a href="#cb30-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-765"><a href="#cb30-765" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and preprocess the raw data</span></span>
<span id="cb30-766"><a href="#cb30-766" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span>))</span>
<span id="cb30-767"><a href="#cb30-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-768"><a href="#cb30-768" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> s1 <span class="sc">%&gt;%</span> </span>
<span id="cb30-769"><a href="#cb30-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-770"><a href="#cb30-770" aria-hidden="true" tabindex="-1"></a>    <span class="at">state1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-771"><a href="#cb30-771" aria-hidden="true" tabindex="-1"></a>      Colorado <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Colorado"</span>,</span>
<span id="cb30-772"><a href="#cb30-772" aria-hidden="true" tabindex="-1"></a>      Massachusetts <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Massachusetts"</span>,</span>
<span id="cb30-773"><a href="#cb30-773" aria-hidden="true" tabindex="-1"></a>      California <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"California"</span>,</span>
<span id="cb30-774"><a href="#cb30-774" aria-hidden="true" tabindex="-1"></a>      Texas <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Texas"</span>,</span>
<span id="cb30-775"><a href="#cb30-775" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb30-776"><a href="#cb30-776" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-777"><a href="#cb30-777" aria-hidden="true" tabindex="-1"></a>    <span class="at">state2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-778"><a href="#cb30-778" aria-hidden="true" tabindex="-1"></a>      Colorado <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Colorado"</span>,</span>
<span id="cb30-779"><a href="#cb30-779" aria-hidden="true" tabindex="-1"></a>      Massachusetts <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Massachusetts"</span>,</span>
<span id="cb30-780"><a href="#cb30-780" aria-hidden="true" tabindex="-1"></a>      California <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"California"</span>,</span>
<span id="cb30-781"><a href="#cb30-781" aria-hidden="true" tabindex="-1"></a>      Texas <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Texas"</span>,</span>
<span id="cb30-782"><a href="#cb30-782" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb30-783"><a href="#cb30-783" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-784"><a href="#cb30-784" aria-hidden="true" tabindex="-1"></a>    <span class="at">refClass =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-785"><a href="#cb30-785" aria-hidden="true" tabindex="-1"></a>      ReferenceClass <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"USD"</span>,</span>
<span id="cb30-786"><a href="#cb30-786" aria-hidden="true" tabindex="-1"></a>      ReferenceClass <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"kWh"</span>,</span>
<span id="cb30-787"><a href="#cb30-787" aria-hidden="true" tabindex="-1"></a>      ReferenceClass <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Percentage"</span>,</span>
<span id="cb30-788"><a href="#cb30-788" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb30-789"><a href="#cb30-789" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-790"><a href="#cb30-790" aria-hidden="true" tabindex="-1"></a>    <span class="at">calc =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(<span class="fu">is.na</span>(MATH01), <span class="dv">0</span>, MATH01)),</span>
<span id="cb30-791"><a href="#cb30-791" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">row_number</span>()</span>
<span id="cb30-792"><a href="#cb30-792" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-793"><a href="#cb30-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id2 =</span> ResponseId, <span class="at">edu =</span> DEM04) <span class="sc">%&gt;%</span></span>
<span id="cb30-794"><a href="#cb30-794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-795"><a href="#cb30-795" aria-hidden="true" tabindex="-1"></a>    <span class="at">edu =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb30-796"><a href="#cb30-796" aria-hidden="true" tabindex="-1"></a>      edu <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Some schooling, but no diploma or degree"</span>,</span>
<span id="cb30-797"><a href="#cb30-797" aria-hidden="true" tabindex="-1"></a>      edu <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Highschool diploma or GED"</span>,</span>
<span id="cb30-798"><a href="#cb30-798" aria-hidden="true" tabindex="-1"></a>      edu <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Some college"</span>,</span>
<span id="cb30-799"><a href="#cb30-799" aria-hidden="true" tabindex="-1"></a>      edu <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"College degree"</span>,</span>
<span id="cb30-800"><a href="#cb30-800" aria-hidden="true" tabindex="-1"></a>      edu <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Some graduate school"</span>,</span>
<span id="cb30-801"><a href="#cb30-801" aria-hidden="true" tabindex="-1"></a>      edu <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Graduate degree"</span>,</span>
<span id="cb30-802"><a href="#cb30-802" aria-hidden="true" tabindex="-1"></a>      edu <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Choose not to answer"</span>,</span>
<span id="cb30-803"><a href="#cb30-803" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb30-804"><a href="#cb30-804" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb30-805"><a href="#cb30-805" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-806"><a href="#cb30-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(id, edu, refClass, state1, state2, calc, <span class="at">.after =</span> id2)</span>
<span id="cb30-807"><a href="#cb30-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-808"><a href="#cb30-808" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to trim NA and empty columns</span></span>
<span id="cb30-809"><a href="#cb30-809" aria-hidden="true" tabindex="-1"></a>trim_na_and_empty_columns <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb30-810"><a href="#cb30-810" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb30-811"><a href="#cb30-811" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="sc">!</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(.)) <span class="sc">|</span> (<span class="fu">is.character</span>(.) <span class="sc">&amp;&amp;</span> <span class="fu">all</span>(<span class="fu">trimws</span>(.) <span class="sc">==</span> <span class="st">""</span>))))) <span class="sc">%&gt;%</span> </span>
<span id="cb30-812"><a href="#cb30-812" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"AIND"</span>))</span>
<span id="cb30-813"><a href="#cb30-813" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-814"><a href="#cb30-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-815"><a href="#cb30-815" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of trimmed datasets for each unique ID</span></span>
<span id="cb30-816"><a href="#cb30-816" aria-hidden="true" tabindex="-1"></a>dAll <span class="ot">&lt;-</span> s1 <span class="sc">%&gt;%</span></span>
<span id="cb30-817"><a href="#cb30-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb30-818"><a href="#cb30-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-819"><a href="#cb30-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(trim_na_and_empty_columns) <span class="sc">%&gt;%</span></span>
<span id="cb30-820"><a href="#cb30-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">unique</span>(s1<span class="sc">$</span>id))</span>
<span id="cb30-821"><a href="#cb30-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-822"><a href="#cb30-822" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the revised parse_action_plan function to all participants</span></span>
<span id="cb30-823"><a href="#cb30-823" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> dAll <span class="sc">%&gt;%</span></span>
<span id="cb30-824"><a href="#cb30-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(parse_action_plan)</span>
<span id="cb30-825"><a href="#cb30-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-826"><a href="#cb30-826" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all parsed data</span></span>
<span id="cb30-827"><a href="#cb30-827" aria-hidden="true" tabindex="-1"></a>s1_processed <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(test)</span>
<span id="cb30-828"><a href="#cb30-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-829"><a href="#cb30-829" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle specific data corrections (e.g., participant "R_1kFwgoKAmNTwCs3")</span></span>
<span id="cb30-830"><a href="#cb30-830" aria-hidden="true" tabindex="-1"></a>s1_processed <span class="ot">&lt;-</span> s1_processed <span class="sc">%&gt;%</span></span>
<span id="cb30-831"><a href="#cb30-831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-832"><a href="#cb30-832" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">if_else</span>(id2 <span class="sc">==</span> <span class="st">"R_1kFwgoKAmNTwCs3"</span> <span class="sc">&amp;</span> state_assigned <span class="sc">==</span> <span class="st">"Texas"</span> <span class="sc">&amp;</span> appliance <span class="sc">==</span> <span class="st">"Heating"</span>, <span class="dv">6118</span>, family)</span>
<span id="cb30-833"><a href="#cb30-833" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-834"><a href="#cb30-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-835"><a href="#cb30-835" aria-hidden="true" tabindex="-1"></a><span class="co"># Final mutations and calculations</span></span>
<span id="cb30-836"><a href="#cb30-836" aria-hidden="true" tabindex="-1"></a>s1_processed <span class="ot">&lt;-</span> s1_processed <span class="sc">%&gt;%</span></span>
<span id="cb30-837"><a href="#cb30-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-838"><a href="#cb30-838" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value),</span>
<span id="cb30-839"><a href="#cb30-839" aria-hidden="true" tabindex="-1"></a>    <span class="at">change =</span> value <span class="sc">-</span> family,</span>
<span id="cb30-840"><a href="#cb30-840" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_p_dif =</span> value <span class="sc">-</span> <span class="fu">as.numeric</span>(state_avg),</span>
<span id="cb30-841"><a href="#cb30-841" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_f_dif =</span> family <span class="sc">-</span> <span class="fu">as.numeric</span>(state_avg),</span>
<span id="cb30-842"><a href="#cb30-842" aria-hidden="true" tabindex="-1"></a>    <span class="at">less_avg =</span> value <span class="sc">&lt;</span> <span class="fu">as.numeric</span>(state_avg),</span>
<span id="cb30-843"><a href="#cb30-843" aria-hidden="true" tabindex="-1"></a>    <span class="at">calc =</span> <span class="fu">if_else</span>(calc <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"No Calculator"</span>, <span class="st">"Used Calculator"</span>)</span>
<span id="cb30-844"><a href="#cb30-844" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-845"><a href="#cb30-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-846"><a href="#cb30-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-847"><a href="#cb30-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-848"><a href="#cb30-848" aria-hidden="true" tabindex="-1"></a>s1_processed <span class="sc">|&gt;</span> <span class="fu">group_by</span>(state_assigned,appliance) <span class="sc">|&gt;</span> </span>
<span id="cb30-849"><a href="#cb30-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_avg=</span><span class="fu">as.numeric</span>(state_avg)) <span class="sc">|&gt;</span> </span>
<span id="cb30-850"><a href="#cb30-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_distinct_family=</span><span class="fu">n_distinct</span>(family),</span>
<span id="cb30-851"><a href="#cb30-851" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_distinct_state_avg=</span><span class="fu">n_distinct</span>(state_avg), </span>
<span id="cb30-852"><a href="#cb30-852" aria-hidden="true" tabindex="-1"></a>            <span class="co"># paste a string of each distinct value, separated by a comma</span></span>
<span id="cb30-853"><a href="#cb30-853" aria-hidden="true" tabindex="-1"></a>            <span class="at">distinct_family=</span><span class="fu">paste</span>(<span class="fu">unique</span>(family),<span class="at">collapse=</span><span class="st">","</span>),</span>
<span id="cb30-854"><a href="#cb30-854" aria-hidden="true" tabindex="-1"></a>            <span class="at">distinct_state_avg=</span><span class="fu">paste</span>(<span class="fu">unique</span>(state_avg),<span class="at">collapse=</span><span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-855"><a href="#cb30-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_distinct_family<span class="sc">&gt;</span><span class="dv">1</span> <span class="sc">|</span> n_distinct_state_avg<span class="sc">&gt;</span><span class="dv">1</span>) </span>
<span id="cb30-856"><a href="#cb30-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-857"><a href="#cb30-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-858"><a href="#cb30-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-859"><a href="#cb30-859" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert family and state_avg to numeric</span></span>
<span id="cb30-860"><a href="#cb30-860" aria-hidden="true" tabindex="-1"></a>s1_processed <span class="ot">&lt;-</span> s1_processed <span class="sc">%&gt;%</span></span>
<span id="cb30-861"><a href="#cb30-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-862"><a href="#cb30-862" aria-hidden="true" tabindex="-1"></a>    <span class="at">family_value =</span> <span class="fu">as.numeric</span>(family),</span>
<span id="cb30-863"><a href="#cb30-863" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_avg_value =</span> <span class="fu">as.numeric</span>(state_avg)</span>
<span id="cb30-864"><a href="#cb30-864" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-865"><a href="#cb30-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-866"><a href="#cb30-866" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify discrepancies and include participant IDs</span></span>
<span id="cb30-867"><a href="#cb30-867" aria-hidden="true" tabindex="-1"></a>duplicate_checks <span class="ot">&lt;-</span> s1_processed <span class="sc">%&gt;%</span></span>
<span id="cb30-868"><a href="#cb30-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_assigned, appliance, refClass) <span class="sc">%&gt;%</span></span>
<span id="cb30-869"><a href="#cb30-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-870"><a href="#cb30-870" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_unique_family =</span> <span class="fu">n_distinct</span>(family_value),</span>
<span id="cb30-871"><a href="#cb30-871" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_unique_state_avg =</span> <span class="fu">n_distinct</span>(state_avg_value),</span>
<span id="cb30-872"><a href="#cb30-872" aria-hidden="true" tabindex="-1"></a>    <span class="at">families =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(family_value), <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb30-873"><a href="#cb30-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_avgs =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(state_avg_value), <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb30-874"><a href="#cb30-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">participant_ids =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(id[<span class="fu">duplicated</span>(family_value) <span class="sc">|</span> <span class="fu">duplicated</span>(state_avg_value)]), <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb30-875"><a href="#cb30-875" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb30-876"><a href="#cb30-876" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-877"><a href="#cb30-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_unique_family <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> n_unique_state_avg <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb30-878"><a href="#cb30-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-879"><a href="#cb30-879" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(duplicate_checks) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb30-880"><a href="#cb30-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Found inconsistencies in family or state_avg values:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-881"><a href="#cb30-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(duplicate_checks)</span>
<span id="cb30-882"><a href="#cb30-882" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb30-883"><a href="#cb30-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No inconsistencies found in family or state_avg values.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-884"><a href="#cb30-884" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-885"><a href="#cb30-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-886"><a href="#cb30-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-887"><a href="#cb30-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-890"><a href="#cb30-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-891"><a href="#cb30-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: s1_check</span></span>
<span id="cb30-892"><a href="#cb30-892" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb30-893"><a href="#cb30-893" aria-hidden="true" tabindex="-1"></a>s1_processed <span class="ot">&lt;-</span> s1 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">state_assigned=</span>state)</span>
<span id="cb30-894"><a href="#cb30-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-895"><a href="#cb30-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-896"><a href="#cb30-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-897"><a href="#cb30-897" aria-hidden="true" tabindex="-1"></a>s1_check <span class="ot">&lt;-</span> s1_processed <span class="sc">%&gt;%</span> </span>
<span id="cb30-898"><a href="#cb30-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-899"><a href="#cb30-899" aria-hidden="true" tabindex="-1"></a>    <span class="at">family_value =</span> <span class="fu">as.numeric</span>(family),</span>
<span id="cb30-900"><a href="#cb30-900" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_avg_value =</span> <span class="fu">as.numeric</span>(state_avg)</span>
<span id="cb30-901"><a href="#cb30-901" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-902"><a href="#cb30-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, id2, state_assigned, appliance, family_value, state_avg_value, refClass,state)</span>
<span id="cb30-903"><a href="#cb30-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-904"><a href="#cb30-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-905"><a href="#cb30-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns in correct_values</span></span>
<span id="cb30-906"><a href="#cb30-906" aria-hidden="true" tabindex="-1"></a>correct_values <span class="ot">&lt;-</span> correct_values <span class="sc">%&gt;%</span></span>
<span id="cb30-907"><a href="#cb30-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb30-908"><a href="#cb30-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">family_correct =</span> family,</span>
<span id="cb30-909"><a href="#cb30-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_avg_correct =</span> state_avg</span>
<span id="cb30-910"><a href="#cb30-910" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-911"><a href="#cb30-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-912"><a href="#cb30-912" aria-hidden="true" tabindex="-1"></a><span class="co"># Join participant data with correct values</span></span>
<span id="cb30-913"><a href="#cb30-913" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">left_join</span>(s1_check, correct_values, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"appliance"</span>))</span>
<span id="cb30-914"><a href="#cb30-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-915"><a href="#cb30-915" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute differences between participant values and correct values</span></span>
<span id="cb30-916"><a href="#cb30-916" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> comparison <span class="sc">%&gt;%</span></span>
<span id="cb30-917"><a href="#cb30-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-918"><a href="#cb30-918" aria-hidden="true" tabindex="-1"></a>    <span class="at">family_diff =</span> family_value <span class="sc">-</span> family_correct,</span>
<span id="cb30-919"><a href="#cb30-919" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_avg_diff =</span> state_avg_value <span class="sc">-</span> state_avg_correct</span>
<span id="cb30-920"><a href="#cb30-920" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-921"><a href="#cb30-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-922"><a href="#cb30-922" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify discrepancies</span></span>
<span id="cb30-923"><a href="#cb30-923" aria-hidden="true" tabindex="-1"></a>discrepancies <span class="ot">&lt;-</span> comparison <span class="sc">%&gt;%</span></span>
<span id="cb30-924"><a href="#cb30-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(family_diff <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">|</span> state_avg_diff <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb30-925"><a href="#cb30-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-926"><a href="#cb30-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-927"><a href="#cb30-927" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(discrepancies) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb30-928"><a href="#cb30-928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Participants with discrepancies in family or state_avg values:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-929"><a href="#cb30-929" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(</span>
<span id="cb30-930"><a href="#cb30-930" aria-hidden="true" tabindex="-1"></a>    discrepancies <span class="sc">%&gt;%</span></span>
<span id="cb30-931"><a href="#cb30-931" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(</span>
<span id="cb30-932"><a href="#cb30-932" aria-hidden="true" tabindex="-1"></a>        id,</span>
<span id="cb30-933"><a href="#cb30-933" aria-hidden="true" tabindex="-1"></a>        id2,</span>
<span id="cb30-934"><a href="#cb30-934" aria-hidden="true" tabindex="-1"></a>        state,</span>
<span id="cb30-935"><a href="#cb30-935" aria-hidden="true" tabindex="-1"></a>        appliance,</span>
<span id="cb30-936"><a href="#cb30-936" aria-hidden="true" tabindex="-1"></a>        refClass,</span>
<span id="cb30-937"><a href="#cb30-937" aria-hidden="true" tabindex="-1"></a>        family_value,</span>
<span id="cb30-938"><a href="#cb30-938" aria-hidden="true" tabindex="-1"></a>        family_correct,</span>
<span id="cb30-939"><a href="#cb30-939" aria-hidden="true" tabindex="-1"></a>        family_diff,</span>
<span id="cb30-940"><a href="#cb30-940" aria-hidden="true" tabindex="-1"></a>        state_avg_value,</span>
<span id="cb30-941"><a href="#cb30-941" aria-hidden="true" tabindex="-1"></a>        state_avg_correct,</span>
<span id="cb30-942"><a href="#cb30-942" aria-hidden="true" tabindex="-1"></a>        state_avg_diff</span>
<span id="cb30-943"><a href="#cb30-943" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb30-944"><a href="#cb30-944" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-945"><a href="#cb30-945" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb30-946"><a href="#cb30-946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No discrepancies found between participant values and correct values.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-947"><a href="#cb30-947" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-948"><a href="#cb30-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-949"><a href="#cb30-949" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to inspect a participant's data</span></span>
<span id="cb30-950"><a href="#cb30-950" aria-hidden="true" tabindex="-1"></a>inspect_participant <span class="ot">&lt;-</span> <span class="cf">function</span>(participant_id) {</span>
<span id="cb30-951"><a href="#cb30-951" aria-hidden="true" tabindex="-1"></a>  participant_data <span class="ot">&lt;-</span> comparison <span class="sc">%&gt;%</span></span>
<span id="cb30-952"><a href="#cb30-952" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(id <span class="sc">==</span> participant_id) <span class="sc">%&gt;%</span></span>
<span id="cb30-953"><a href="#cb30-953" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb30-954"><a href="#cb30-954" aria-hidden="true" tabindex="-1"></a>      id,</span>
<span id="cb30-955"><a href="#cb30-955" aria-hidden="true" tabindex="-1"></a>      id2,</span>
<span id="cb30-956"><a href="#cb30-956" aria-hidden="true" tabindex="-1"></a>      state,</span>
<span id="cb30-957"><a href="#cb30-957" aria-hidden="true" tabindex="-1"></a>      appliance,</span>
<span id="cb30-958"><a href="#cb30-958" aria-hidden="true" tabindex="-1"></a>      refClass,</span>
<span id="cb30-959"><a href="#cb30-959" aria-hidden="true" tabindex="-1"></a>        family_value,</span>
<span id="cb30-960"><a href="#cb30-960" aria-hidden="true" tabindex="-1"></a>        family_correct,</span>
<span id="cb30-961"><a href="#cb30-961" aria-hidden="true" tabindex="-1"></a>        family_diff,</span>
<span id="cb30-962"><a href="#cb30-962" aria-hidden="true" tabindex="-1"></a>        state_avg_value,</span>
<span id="cb30-963"><a href="#cb30-963" aria-hidden="true" tabindex="-1"></a>        state_avg_correct,</span>
<span id="cb30-964"><a href="#cb30-964" aria-hidden="true" tabindex="-1"></a>        state_avg_diff</span>
<span id="cb30-965"><a href="#cb30-965" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-966"><a href="#cb30-966" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-967"><a href="#cb30-967" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(participant_data, <span class="at">n=</span><span class="dv">24</span>)</span>
<span id="cb30-968"><a href="#cb30-968" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-969"><a href="#cb30-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-970"><a href="#cb30-970" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb30-971"><a href="#cb30-971" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect_participant</span>(<span class="dv">1</span>)   <span class="co"># Replace with the participant ID you want to investigate</span></span>
<span id="cb30-972"><a href="#cb30-972" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect_participant</span>(<span class="dv">11</span>) </span>
<span id="cb30-973"><a href="#cb30-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-974"><a href="#cb30-974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-975"><a href="#cb30-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-976"><a href="#cb30-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-979"><a href="#cb30-979" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-980"><a href="#cb30-980" aria-hidden="true" tabindex="-1"></a>correct_values <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb30-981"><a href="#cb30-981" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>state, <span class="sc">~</span>appliance, <span class="sc">~</span>family, <span class="sc">~</span>state_avg,</span>
<span id="cb30-982"><a href="#cb30-982" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Texas values</span></span>
<span id="cb30-983"><a href="#cb30-983" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Cooling"</span>, <span class="dv">6573</span>, <span class="dv">4249</span>,</span>
<span id="cb30-984"><a href="#cb30-984" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Heating"</span>, <span class="dv">6118</span>, <span class="dv">5099</span>,</span>
<span id="cb30-985"><a href="#cb30-985" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span>, <span class="dv">5257</span>, <span class="dv">4396</span>,</span>
<span id="cb30-986"><a href="#cb30-986" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Refrigerator"</span>, <span class="dv">2639</span>, <span class="dv">1318</span>,</span>
<span id="cb30-987"><a href="#cb30-987" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Other Appliance"</span>, <span class="dv">8459</span>, <span class="dv">7883</span>,</span>
<span id="cb30-988"><a href="#cb30-988" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span>, <span class="st">"Total kWh"</span>, <span class="dv">29046</span>, <span class="dv">22945</span>,</span>
<span id="cb30-989"><a href="#cb30-989" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-990"><a href="#cb30-990" aria-hidden="true" tabindex="-1"></a>  <span class="co"># California values</span></span>
<span id="cb30-991"><a href="#cb30-991" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Cooling"</span>, <span class="dv">2581</span>, <span class="dv">1289</span>,</span>
<span id="cb30-992"><a href="#cb30-992" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Heating"</span>, <span class="dv">6157</span>, <span class="dv">5597</span>,</span>
<span id="cb30-993"><a href="#cb30-993" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Water Heating"</span>, <span class="dv">5061</span>, <span class="dv">4601</span>,</span>
<span id="cb30-994"><a href="#cb30-994" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Refrigerator"</span>, <span class="dv">1266</span>, <span class="dv">1055</span>,</span>
<span id="cb30-995"><a href="#cb30-995" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Other Appliance"</span>, <span class="dv">7608</span>, <span class="dv">6916</span>,</span>
<span id="cb30-996"><a href="#cb30-996" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span>, <span class="st">"Total kWh"</span>, <span class="dv">22673</span>, <span class="dv">19458</span>,</span>
<span id="cb30-997"><a href="#cb30-997" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-998"><a href="#cb30-998" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Colorado values</span></span>
<span id="cb30-999"><a href="#cb30-999" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Cooling"</span>, <span class="dv">697</span>, <span class="dv">498</span>,</span>
<span id="cb30-1000"><a href="#cb30-1000" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Heating"</span>, <span class="dv">18052</span>, <span class="dv">16411</span>,</span>
<span id="cb30-1001"><a href="#cb30-1001" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Water Heating"</span>, <span class="dv">11667</span>, <span class="dv">5832</span>,</span>
<span id="cb30-1002"><a href="#cb30-1002" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Refrigerator"</span>, <span class="dv">1370</span>, <span class="dv">1142</span>,</span>
<span id="cb30-1003"><a href="#cb30-1003" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Other Appliance"</span>, <span class="dv">7882</span>, <span class="dv">6652</span>,</span>
<span id="cb30-1004"><a href="#cb30-1004" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Total kWh"</span>, <span class="dv">39768</span>, <span class="dv">30535</span>,</span>
<span id="cb30-1005"><a href="#cb30-1005" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1006"><a href="#cb30-1006" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Massachusetts values</span></span>
<span id="cb30-1007"><a href="#cb30-1007" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Cooling"</span>, <span class="dv">419</span>, <span class="dv">322</span>,</span>
<span id="cb30-1008"><a href="#cb30-1008" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Heating"</span>, <span class="dv">26751</span>, <span class="dv">19108</span>,</span>
<span id="cb30-1009"><a href="#cb30-1009" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Water Heating"</span>, <span class="dv">10543</span>, <span class="dv">5070</span>,</span>
<span id="cb30-1010"><a href="#cb30-1010" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Refrigerator"</span>, <span class="dv">1230</span>, <span class="dv">1025</span>,</span>
<span id="cb30-1011"><a href="#cb30-1011" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Other Appliance"</span>, <span class="dv">7350</span>, <span class="dv">6682</span>,</span>
<span id="cb30-1012"><a href="#cb30-1012" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Total kWh"</span>, <span class="dv">46293</span>, <span class="dv">32207</span></span>
<span id="cb30-1013"><a href="#cb30-1013" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-1014"><a href="#cb30-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1015"><a href="#cb30-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1016"><a href="#cb30-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1017"><a href="#cb30-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1018"><a href="#cb30-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1021"><a href="#cb30-1021" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-1022"><a href="#cb30-1022" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb30-1023"><a href="#cb30-1023" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb30-1024"><a href="#cb30-1024" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to inspect raw data for a specific participant and state</span></span>
<span id="cb30-1025"><a href="#cb30-1025" aria-hidden="true" tabindex="-1"></a>inspect_raw_values <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_data, response_id, state_code) {</span>
<span id="cb30-1026"><a href="#cb30-1026" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get participant's raw data</span></span>
<span id="cb30-1027"><a href="#cb30-1027" aria-hidden="true" tabindex="-1"></a>  participant_data <span class="ot">&lt;-</span> raw_data <span class="sc">%&gt;%</span></span>
<span id="cb30-1028"><a href="#cb30-1028" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ResponseId <span class="sc">==</span> response_id)</span>
<span id="cb30-1029"><a href="#cb30-1029" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1030"><a href="#cb30-1030" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get relevant columns for the state</span></span>
<span id="cb30-1031"><a href="#cb30-1031" aria-hidden="true" tabindex="-1"></a>  relevant_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(participant_data)[<span class="fu">str_detect</span>(<span class="fu">names</span>(participant_data), </span>
<span id="cb30-1032"><a href="#cb30-1032" aria-hidden="true" tabindex="-1"></a>                                                    <span class="fu">paste0</span>(<span class="st">"^[ADP]</span><span class="sc">\\</span><span class="st">d+"</span>, state_code))]</span>
<span id="cb30-1033"><a href="#cb30-1033" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1034"><a href="#cb30-1034" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a mapping for item numbers to appliance types</span></span>
<span id="cb30-1035"><a href="#cb30-1035" aria-hidden="true" tabindex="-1"></a>  appliance_map <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb30-1036"><a href="#cb30-1036" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>item_nums, <span class="sc">~</span>appliance,</span>
<span id="cb30-1037"><a href="#cb30-1037" aria-hidden="true" tabindex="-1"></a>    <span class="st">"07|08"</span>, <span class="st">"Cooling"</span>,</span>
<span id="cb30-1038"><a href="#cb30-1038" aria-hidden="true" tabindex="-1"></a>    <span class="st">"11|12"</span>, <span class="st">"Heating"</span>,</span>
<span id="cb30-1039"><a href="#cb30-1039" aria-hidden="true" tabindex="-1"></a>    <span class="st">"15|16"</span>, <span class="st">"Water Heating"</span>,</span>
<span id="cb30-1040"><a href="#cb30-1040" aria-hidden="true" tabindex="-1"></a>    <span class="st">"19|20"</span>, <span class="st">"Refrigerator"</span>,</span>
<span id="cb30-1041"><a href="#cb30-1041" aria-hidden="true" tabindex="-1"></a>    <span class="st">"23|24"</span>, <span class="st">"Other Appliance"</span>,</span>
<span id="cb30-1042"><a href="#cb30-1042" aria-hidden="true" tabindex="-1"></a>    <span class="st">"27|28"</span>, <span class="st">"Total kWh"</span></span>
<span id="cb30-1043"><a href="#cb30-1043" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-1044"><a href="#cb30-1044" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1045"><a href="#cb30-1045" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract and organize values</span></span>
<span id="cb30-1046"><a href="#cb30-1046" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(appliance_map<span class="sc">$</span>item_nums, <span class="cf">function</span>(nums) {</span>
<span id="cb30-1047"><a href="#cb30-1047" aria-hidden="true" tabindex="-1"></a>    cols <span class="ot">&lt;-</span> relevant_cols[<span class="fu">str_detect</span>(relevant_cols, <span class="fu">paste0</span>(<span class="st">"("</span>, nums, <span class="st">")$"</span>))]</span>
<span id="cb30-1048"><a href="#cb30-1048" aria-hidden="true" tabindex="-1"></a>    values <span class="ot">&lt;-</span> participant_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(cols)) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span>
<span id="cb30-1049"><a href="#cb30-1049" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1050"><a href="#cb30-1050" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb30-1051"><a href="#cb30-1051" aria-hidden="true" tabindex="-1"></a>      <span class="at">column =</span> <span class="fu">names</span>(values),</span>
<span id="cb30-1052"><a href="#cb30-1052" aria-hidden="true" tabindex="-1"></a>      <span class="at">value =</span> <span class="fu">as.numeric</span>(values),</span>
<span id="cb30-1053"><a href="#cb30-1053" aria-hidden="true" tabindex="-1"></a>      <span class="at">appliance =</span> appliance_map<span class="sc">$</span>appliance[appliance_map<span class="sc">$</span>item_nums <span class="sc">==</span> nums]</span>
<span id="cb30-1054"><a href="#cb30-1054" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-1055"><a href="#cb30-1055" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb30-1056"><a href="#cb30-1056" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1057"><a href="#cb30-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb30-1058"><a href="#cb30-1058" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-1059"><a href="#cb30-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1060"><a href="#cb30-1060" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's check participant 1's Texas Water Heating issue</span></span>
<span id="cb30-1061"><a href="#cb30-1061" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/Frequency &amp; Probability Study 1 - 3-24-19.sav"</span>))</span>
<span id="cb30-1062"><a href="#cb30-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1063"><a href="#cb30-1063" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Participant 1 (R_2QMsYuHS385pTj1)</span></span>
<span id="cb30-1064"><a href="#cb30-1064" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Participant 1 - Texas Water Heating Values:"</span>)</span>
<span id="cb30-1065"><a href="#cb30-1065" aria-hidden="true" tabindex="-1"></a>p1_tex <span class="ot">&lt;-</span> <span class="fu">inspect_raw_values</span>(raw_data, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"TEX"</span>)</span>
<span id="cb30-1066"><a href="#cb30-1066" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1_tex <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(appliance, <span class="st">"Water"</span>)),<span class="at">n=</span><span class="dv">24</span>) </span>
<span id="cb30-1067"><a href="#cb30-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1068"><a href="#cb30-1068" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Participant 11 (R_263zmNZDB4Pqn9h)</span></span>
<span id="cb30-1069"><a href="#cb30-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Participant 11 - Colorado Heating Values:"</span>)</span>
<span id="cb30-1070"><a href="#cb30-1070" aria-hidden="true" tabindex="-1"></a>p11_col <span class="ot">&lt;-</span> <span class="fu">inspect_raw_values</span>(raw_data, <span class="st">"R_263zmNZDB4Pqn9h"</span>, <span class="st">"COL"</span>)</span>
<span id="cb30-1071"><a href="#cb30-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p11_col <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(appliance, <span class="st">"Heating"</span>)))</span>
<span id="cb30-1072"><a href="#cb30-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1073"><a href="#cb30-1073" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compare raw vs processed values</span></span>
<span id="cb30-1074"><a href="#cb30-1074" aria-hidden="true" tabindex="-1"></a>compare_values <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_data, processed_data, response_id, state, appliance_type) {</span>
<span id="cb30-1075"><a href="#cb30-1075" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get raw values</span></span>
<span id="cb30-1076"><a href="#cb30-1076" aria-hidden="true" tabindex="-1"></a>  raw_vals <span class="ot">&lt;-</span> <span class="fu">inspect_raw_values</span>(raw_data, response_id, </span>
<span id="cb30-1077"><a href="#cb30-1077" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">case_when</span>(</span>
<span id="cb30-1078"><a href="#cb30-1078" aria-hidden="true" tabindex="-1"></a>                                  state <span class="sc">==</span> <span class="st">"Texas"</span> <span class="sc">~</span> <span class="st">"TEX"</span>,</span>
<span id="cb30-1079"><a href="#cb30-1079" aria-hidden="true" tabindex="-1"></a>                                  state <span class="sc">==</span> <span class="st">"Colorado"</span> <span class="sc">~</span> <span class="st">"COL"</span>,</span>
<span id="cb30-1080"><a href="#cb30-1080" aria-hidden="true" tabindex="-1"></a>                                  state <span class="sc">==</span> <span class="st">"California"</span> <span class="sc">~</span> <span class="st">"CAL"</span>,</span>
<span id="cb30-1081"><a href="#cb30-1081" aria-hidden="true" tabindex="-1"></a>                                  state <span class="sc">==</span> <span class="st">"Massachusetts"</span> <span class="sc">~</span> <span class="st">"MASS"</span></span>
<span id="cb30-1082"><a href="#cb30-1082" aria-hidden="true" tabindex="-1"></a>                                )) <span class="sc">%&gt;%</span></span>
<span id="cb30-1083"><a href="#cb30-1083" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(appliance <span class="sc">==</span> appliance_type)</span>
<span id="cb30-1084"><a href="#cb30-1084" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1085"><a href="#cb30-1085" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get processed values</span></span>
<span id="cb30-1086"><a href="#cb30-1086" aria-hidden="true" tabindex="-1"></a>  proc_vals <span class="ot">&lt;-</span> processed_data <span class="sc">%&gt;%</span></span>
<span id="cb30-1087"><a href="#cb30-1087" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(id2 <span class="sc">==</span> response_id, </span>
<span id="cb30-1088"><a href="#cb30-1088" aria-hidden="true" tabindex="-1"></a>           state <span class="sc">==</span> <span class="sc">!!</span>state,</span>
<span id="cb30-1089"><a href="#cb30-1089" aria-hidden="true" tabindex="-1"></a>           appliance <span class="sc">==</span> appliance_type) <span class="sc">%&gt;%</span></span>
<span id="cb30-1090"><a href="#cb30-1090" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(family, state_avg_value)</span>
<span id="cb30-1091"><a href="#cb30-1091" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1092"><a href="#cb30-1092" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compare</span></span>
<span id="cb30-1093"><a href="#cb30-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb30-1094"><a href="#cb30-1094" aria-hidden="true" tabindex="-1"></a>    <span class="at">source =</span> <span class="st">"Raw Data"</span>,</span>
<span id="cb30-1095"><a href="#cb30-1095" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> raw_vals<span class="sc">$</span>value[<span class="fu">str_detect</span>(raw_vals<span class="sc">$</span>column, <span class="st">"07$|11$|15$|19$|23$|27$"</span>)],</span>
<span id="cb30-1096"><a href="#cb30-1096" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_avg =</span> raw_vals<span class="sc">$</span>value[<span class="fu">str_detect</span>(raw_vals<span class="sc">$</span>column, <span class="st">"08$|12$|16$|20$|24$|28$"</span>)]</span>
<span id="cb30-1097"><a href="#cb30-1097" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-1098"><a href="#cb30-1098" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb30-1099"><a href="#cb30-1099" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb30-1100"><a href="#cb30-1100" aria-hidden="true" tabindex="-1"></a>        <span class="at">source =</span> <span class="st">"Processed Data"</span>,</span>
<span id="cb30-1101"><a href="#cb30-1101" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> <span class="fu">first</span>(proc_vals<span class="sc">$</span>family),</span>
<span id="cb30-1102"><a href="#cb30-1102" aria-hidden="true" tabindex="-1"></a>        <span class="at">state_avg =</span> <span class="fu">first</span>(proc_vals<span class="sc">$</span>state_avg_value)</span>
<span id="cb30-1103"><a href="#cb30-1103" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb30-1104"><a href="#cb30-1104" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-1105"><a href="#cb30-1105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-1106"><a href="#cb30-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1107"><a href="#cb30-1107" aria-hidden="true" tabindex="-1"></a><span class="co"># Example comparisons</span></span>
<span id="cb30-1108"><a href="#cb30-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Comparison for Participant 1 - Texas Water Heating:"</span>)</span>
<span id="cb30-1109"><a href="#cb30-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_values</span>(raw_data, s1_processed, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"Texas"</span>, <span class="st">"Water Heating"</span>)</span>
<span id="cb30-1110"><a href="#cb30-1110" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(raw_data<span class="sc">$</span>P3TEX15)</span>
<span id="cb30-1111"><a href="#cb30-1111" aria-hidden="true" tabindex="-1"></a>s1_processed <span class="sc">|&gt;</span> <span class="fu">filter</span>(state2<span class="sc">==</span><span class="st">"Texas"</span>,appliance<span class="sc">==</span><span class="st">"Water Heating"</span>,state_assigned<span class="sc">==</span><span class="st">"Texas"</span>,plan<span class="sc">==</span><span class="st">"plan1"</span>)</span>
<span id="cb30-1112"><a href="#cb30-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1113"><a href="#cb30-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1114"><a href="#cb30-1114" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Comparison for Participant 11 - Colorado Heating:"</span>)</span>
<span id="cb30-1115"><a href="#cb30-1115" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_values</span>(raw_data, s1_processed, <span class="st">"R_263zmNZDB4Pqn9h"</span>, <span class="st">"Colorado"</span>, <span class="st">"Heating"</span>)</span>
<span id="cb30-1116"><a href="#cb30-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1117"><a href="#cb30-1117" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the discrepancy is consistent across different blocks/presentations</span></span>
<span id="cb30-1118"><a href="#cb30-1118" aria-hidden="true" tabindex="-1"></a>check_all_presentations <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_data, response_id, state_code, appliance_pattern) {</span>
<span id="cb30-1119"><a href="#cb30-1119" aria-hidden="true" tabindex="-1"></a>  participant_data <span class="ot">&lt;-</span> raw_data <span class="sc">%&gt;%</span></span>
<span id="cb30-1120"><a href="#cb30-1120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ResponseId <span class="sc">==</span> response_id)</span>
<span id="cb30-1121"><a href="#cb30-1121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1122"><a href="#cb30-1122" aria-hidden="true" tabindex="-1"></a>  all_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(participant_data)[<span class="fu">str_detect</span>(<span class="fu">names</span>(participant_data), </span>
<span id="cb30-1123"><a href="#cb30-1123" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">paste0</span>(<span class="st">"^[ADP]</span><span class="sc">\\</span><span class="st">d+"</span>, state_code)) <span class="sc">&amp;</span></span>
<span id="cb30-1124"><a href="#cb30-1124" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">str_detect</span>(<span class="fu">names</span>(participant_data), appliance_pattern)]</span>
<span id="cb30-1125"><a href="#cb30-1125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-1126"><a href="#cb30-1126" aria-hidden="true" tabindex="-1"></a>  participant_data <span class="sc">%&gt;%</span></span>
<span id="cb30-1127"><a href="#cb30-1127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(all_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb30-1128"><a href="#cb30-1128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"column"</span>, <span class="at">value =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-1129"><a href="#cb30-1129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(column)</span>
<span id="cb30-1130"><a href="#cb30-1130" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-1131"><a href="#cb30-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1132"><a href="#cb30-1132" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Check all presentations of water heating for participant 1</span></span>
<span id="cb30-1133"><a href="#cb30-1133" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">All presentations of water heating for Participant 1:"</span>)</span>
<span id="cb30-1134"><a href="#cb30-1134" aria-hidden="true" tabindex="-1"></a><span class="fu">check_all_presentations</span>(raw_data, <span class="st">"R_2QMsYuHS385pTj1"</span>, <span class="st">"TEX"</span>, <span class="st">"15|16"</span>)</span>
<span id="cb30-1135"><a href="#cb30-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1136"><a href="#cb30-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1137"><a href="#cb30-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1138"><a href="#cb30-1138" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(raw_data<span class="sc">$</span>P3TEX15)</span>
<span id="cb30-1139"><a href="#cb30-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1140"><a href="#cb30-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1141"><a href="#cb30-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1142"><a href="#cb30-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1143"><a href="#cb30-1143" aria-hidden="true" tabindex="-1"></a><span class="fu">## Just refClass Percentage and state 2 Texas have the issues with family water heating = 5.26</span></span>
<span id="cb30-1144"><a href="#cb30-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1145"><a href="#cb30-1145" aria-hidden="true" tabindex="-1"></a>r$&gt; s1_processed |&gt; filter(state2=="Texas",appliance=="Water Heating",state_assigned=="Texas",plan=="plan1") |&gt; head(15)</span>
<span id="cb30-1146"><a href="#cb30-1146" aria-hidden="true" tabindex="-1"></a><span class="fu"># A tibble: 15 × 17</span></span>
<span id="cb30-1147"><a href="#cb30-1147" aria-hidden="true" tabindex="-1"></a>      id state1        state2 refClass   calc  edu             modality state_assigned id2               Duration__in_seconds_ appliance     family    state_avg plan  value     family_value state_avg_value</span>
<span id="cb30-1148"><a href="#cb30-1148" aria-hidden="true" tabindex="-1"></a>   &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;      &lt;fct&gt; &lt;fct&gt;           &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;                             &lt;dbl&gt; &lt;chr&gt;         &lt;dbl+lbl&gt; &lt;dbl+lbl&gt; &lt;chr&gt; &lt;dbl+lbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;</span>
<span id="cb30-1149"><a href="#cb30-1149" aria-hidden="true" tabindex="-1"></a> 1     1 Colorado      Texas  Percentage 1     Graduate degree P        Texas          R_2QMsYuHS385pTj1                  1008 Water Heating    5.26   4396      plan1  700              5.26            4396</span>
<span id="cb30-1150"><a href="#cb30-1150" aria-hidden="true" tabindex="-1"></a> 2     2 Colorado      Texas  Percentage 1     College degree  P        Texas          R_2tzIyZavpl1RZBY                  1126 Water Heating    5.26   4396      plan1 4396              5.26            4396</span>
<span id="cb30-1151"><a href="#cb30-1151" aria-hidden="true" tabindex="-1"></a> 3     3 Colorado      Texas  Percentage 1     College degree  P        Texas          R_3Gm1Y4QzSlyrEWo                   870 Water Heating    5.26   4396      plan1 4468              5.26            4396</span>
<span id="cb30-1152"><a href="#cb30-1152" aria-hidden="true" tabindex="-1"></a> 4     4 Colorado      Texas  Percentage 1     College degree  P        Texas          R_Djh2q728ibyNWjD                  2763 Water Heating    5.26   4396      plan1 1000              5.26            4396</span>
<span id="cb30-1153"><a href="#cb30-1153" aria-hidden="true" tabindex="-1"></a> 5     5 Colorado      Texas  Percentage 0     Graduate degree P        Texas          R_3fAXNbIZ7kFieSu                   920 Water Heating    5.26   4396      plan1 3756              5.26            4396</span>
<span id="cb30-1154"><a href="#cb30-1154" aria-hidden="true" tabindex="-1"></a> 6     6 Colorado      Texas  Percentage 0     Graduate degree P        Texas          R_1JECzl10KgckJXg                   878 Water Heating    5.26   4396      plan1 5200              5.26            4396</span>
<span id="cb30-1155"><a href="#cb30-1155" aria-hidden="true" tabindex="-1"></a> 7     7 Colorado      Texas  Percentage 1     Graduate degree P        Texas          R_C2IQAZim25sij4d                  2680 Water Heating    5.26   4396      plan1 4257              5.26            4396</span>
<span id="cb30-1156"><a href="#cb30-1156" aria-hidden="true" tabindex="-1"></a> 8     8 Colorado      Texas  Percentage 1     Some college    P        Texas          R_5bbi3tpMOhuGBIR                  1628 Water Heating    5.26   4396      plan1 5100              5.26            4396</span>
<span id="cb30-1157"><a href="#cb30-1157" aria-hidden="true" tabindex="-1"></a> 9     9 Colorado      Texas  Percentage 1     Graduate degree P        Texas          R_2BsVSAOpehXW9Cr                   724 Water Heating    5.26   4396      plan1 5217              5.26            4396</span>
<span id="cb30-1158"><a href="#cb30-1158" aria-hidden="true" tabindex="-1"></a>10    10 Colorado      Texas  Percentage 1     Some college    P        Texas          R_325F8wRln52w1QN                   913 Water Heating    5.26   4396      plan1 4468              5.26            4396</span>
<span id="cb30-1159"><a href="#cb30-1159" aria-hidden="true" tabindex="-1"></a>11    12 Colorado      Texas  kWh        1     Graduate degree A        Texas          R_abEpO6g4xKOlwwF                   644 Water Heating 5257      4396      plan1 8459           5257               4396</span>
<span id="cb30-1160"><a href="#cb30-1160" aria-hidden="true" tabindex="-1"></a>12    14 Colorado      Texas  USD        0     College degree  D        Texas          R_2VsaxwvgHXasQx3                   625 Water Heating 5257       400      plan1 4000           5257                400</span>
<span id="cb30-1161"><a href="#cb30-1161" aria-hidden="true" tabindex="-1"></a>13    24 Massachusetts Texas  USD        1     College degree  D        Texas          R_AEvC2EEL0GltodP                  1047 Water Heating 5257      4396      plan1 4000           5257               4396</span>
<span id="cb30-1162"><a href="#cb30-1162" aria-hidden="true" tabindex="-1"></a>14    36 Colorado      Texas  USD        0     Graduate degree D        Texas          R_1nO7uu36tUOSbfw                   390 Water Heating 5257      4396      plan1 4500           5257               4396</span>
<span id="cb30-1163"><a href="#cb30-1163" aria-hidden="true" tabindex="-1"></a>15    38 Massachusetts Texas  kWh        1     College degree  A        Texas          R_6f13I34krdFacjT                   973 Water Heating 5257      4396      plan1 4500           5257               4396</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024 <a href="https://tegorman13.github.io">Thomas Gorman</a></p>
</div>   
    <div class="nav-footer-center">
<p>site created with <a href="https://cran.r-project.org/">R</a> and <a href="https://quarto.org">quarto</a></p>
<div class="toc-actions"><ul><li><a href="https://github.com/tegorman13/Representation_Study/blob/main/misc/outlier.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link active" href="https://github.com/tegorman13/Representation_Study" target="_blank" aria-current="page">
<p><i class="fa-brands fa-github fa-2.0x" aria-label="github"></i></p>
</a>
  </li>  
</ul>
</div>
  </div>
</footer>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>